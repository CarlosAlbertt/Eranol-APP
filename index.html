<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercado Arcano de Eranol</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fallback if CDN fails or for local overrides -->
    <link rel="stylesheet" href="src/css/index.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Roboto:wght@300;400;500;700&family=Orbitron:wght@500&display=swap"
        rel="stylesheet">



    <link rel="stylesheet" href="src/css/medieval-sheet.css?v=7.1">
</head>

<body
    class="bg-black text-white min-h-screen overflow-x-hidden font-sans selection:bg-red-900 selection:text-white select-none">
    <!-- Background Effects -->
    <div class="fixed inset-0 z-0 pointer-events-none"></div>

    <!-- === GLOBAL USER UI (Top Right) === -->
    <div id="global-user-ui"
        class="fixed top-6 right-6 z-[100] flex items-center gap-4 hidden transition-opacity duration-500">
        <div
            class="glass-panel px-4 py-2 rounded-full border border-white/10 flex items-center gap-3 shadow-lg bg-black/40 backdrop-blur-md">
            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
            <span id="global-username"
                class="font-cinzel text-sm text-gray-200 uppercase tracking-widest">Viajero</span>
        </div>
        <button onclick="logout()"
            class="w-10 h-10 rounded-full bg-red-900/40 hover:bg-red-600 border border-red-500/30 text-red-200 hover:text-white flex items-center justify-center transition-all shadow-[0_0_15px_rgba(220,38,38,0.3)] hover:shadow-[0_0_25px_rgba(220,38,38,0.6)] group">
            <i class="fas fa-power-off text-sm group-hover:scale-110 transition-transform"></i>
        </button>
    </div>

    <!-- === 1. ADVENTURER LOGIN SCREEN === -->
    <div id="adventurer-login"
        class="fixed inset-0 z-[200] w-full h-full bg-black flex flex-col items-center justify-center transition-all duration-700">
        <div
            class="glass-panel p-10 rounded-2xl border border-white/10 shadow-2xl max-w-md w-full text-center animate-fade-in">
            <div class="mb-6 text-5xl text-purple-400"><i class="fas fa-id-card-alt"></i></div>
            <h1 class="font-cinzel text-3xl font-bold text-white mb-2 tracking-wider">Capital Eranol</h1>
            <p class="text-gray-400 text-xs uppercase tracking-[0.2em] mb-8">Introduzca ID de Cazador <span
                    class="text-[9px] opacity-30">v7.1</span></p>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="text" id="adv-name-input"
                        class="w-full bg-black/50 border border-white/20 rounded-lg px-4 py-4 text-center text-white placeholder-gray-600 focus:outline-none focus:border-purple-500 transition-all font-cinzel text-lg"
                        placeholder="Alias de Cazador">
                </div>
                <div class="relative group">
                    <input type="password" id="adv-pass-input"
                        class="w-full bg-black/50 border border-white/20 rounded-lg px-4 py-4 text-center text-white placeholder-gray-600 focus:outline-none focus:border-purple-500 transition-all font-cinzel text-lg"
                        placeholder="Contrase√±a">
                </div>
            </div>
            <button onclick="loginAdventurer()"
                class="mt-8 w-full py-3 rounded-lg bg-gradient-to-r from-purple-900 to-indigo-900 hover:from-purple-800 hover:to-indigo-800 text-white font-bold uppercase tracking-widest transition-all shadow-[0_0_20px_rgba(88,28,135,0.4)] hover:shadow-[0_0_30px_rgba(88,28,135,0.6)] border border-purple-500/30">
                Verificar Credenciales
            </button>
        </div>
    </div>

    <!-- === 2. LANDING SCREEN (RING SELECTION) === -->
    <div id="landing-screen"
        class="hidden relative z-50 w-full h-full flex flex-col items-center justify-center transition-all duration-700 opacity-0 scale-95 p-6 overflow-y-auto">
        <div class="text-center mb-10 md:mb-16 relative shrink-0">
            <div
                class="absolute -inset-1 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg blur opacity-20 animate-pulse">
            </div>
            <h1
                class="relative font-cinzel text-4xl md:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-200 via-white to-pink-200 tracking-widest mb-4 drop-shadow-2xl">
                MERCADO DE ERANOL
            </h1>
            <p class="text-gray-400 text-xs md:text-sm tracking-[0.6em] uppercase font-light">
                Bienvenido, <span id="display-username"
                    class="text-white font-semibold border-b border-purple-500/50 pb-1">Viajero</span>
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-7xl w-full shrink-0 items-stretch">

            <!-- Anillo 1 -->
            <button onclick="enterMarket(1)"
                class="select-none group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_30px_rgba(255,255,255,0.1)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-gray-400 animate-fade-in"
                style="animation-delay: 0.1s">
                <div
                    class="absolute inset-0 bg-[url('/img/hub/market.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110">
                </div>
                <div
                    class="absolute inset-0 bg-gradient-to-b from-gray-800/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-white/5 group-hover:text-white/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-hammer"></i>
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-hammer text-5xl md:text-6xl text-gray-600 group-hover:text-gray-200 transition-colors drop-shadow-lg"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-gray-300 mb-2 group-hover:text-white transition-colors">
                        El Mercado de Hierro</h3>
                    <div
                        class="w-8 h-1 bg-gray-600 mb-4 group-hover:w-full group-hover:bg-white transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-gray-500 uppercase tracking-widest border border-gray-700 inline-block px-2 py-1 rounded mb-2 group-hover:bg-gray-800 transition-colors">
                            Anillo 1 ‚Ä¢ Rangos E-D</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            Suministros b√°sicos para comenzar tu leyenda.</p>
                    </div>
                </div>
            </button>

            <!-- Anillo 2 -->
            <button onclick="enterMarket(2)"
                class="select-none group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_40px_rgba(59,130,246,0.3)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-blue-400 animate-fade-in"
                style="animation-delay: 0.2s">
                <div
                    class="absolute inset-0 bg-[url('/img/hub/library.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110">
                </div>
                <div
                    class="absolute inset-0 bg-gradient-to-b from-blue-900/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-blue-500/5 group-hover:text-blue-500/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-gem"></i>
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-gem text-5xl md:text-6xl text-blue-900 group-hover:text-blue-300 transition-colors drop-shadow-[0_0_15px_rgba(59,130,246,0.5)]"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-blue-100/70 mb-2 group-hover:text-white transition-colors">
                        La Plaza de Plata</h3>
                    <div
                        class="w-8 h-1 bg-blue-800 mb-4 group-hover:w-full group-hover:bg-blue-400 transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-blue-500 uppercase tracking-widest border border-blue-900/50 inline-block px-2 py-1 rounded mb-2 group-hover:bg-blue-900/30 transition-colors">
                            Anillo 2 ‚Ä¢ Rangos C-B</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            Donde la magia fluye como moneda.</p>
                    </div>
                </div>
            </button>

            <!-- Anillo 3 -->
            <button onclick="enterMarket(3)"
                class="select-none group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_50px_rgba(234,179,8,0.4)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-yellow-500 animate-fade-in"
                style="animation-delay: 0.3s">
                <div
                    class="absolute inset-0 bg-[url('/img/hub/guilds.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110">
                </div>
                <div
                    class="absolute inset-0 bg-gradient-to-b from-yellow-900/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-yellow-500/5 group-hover:text-yellow-500/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-crown"></i>
                </div>
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl group-hover:bg-yellow-500/20 transition-all">
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-crown text-5xl md:text-6xl text-yellow-900 group-hover:text-yellow-400 transition-colors drop-shadow-[0_0_20px_rgba(234,179,8,0.6)]"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-yellow-100/60 mb-2 group-hover:text-white transition-colors">
                        La Cumbre Dorada</h3>
                    <div
                        class="w-8 h-1 bg-yellow-800 mb-4 group-hover:w-full group-hover:bg-yellow-500 transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-yellow-600 uppercase tracking-widest border border-yellow-900/50 inline-block px-2 py-1 rounded mb-2 group-hover:bg-yellow-900/30 transition-colors">
                            Anillo 3 ‚Ä¢ Rangos A-S</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            El pin√°culo del poder. Artefactos legendarios.</p>
                    </div>
                </div>
            </button>
            <div class="mt-8 text-center shrink-0">
                <button onclick="enterCityIndex()"
                    class="px-6 py-3 rounded-lg bg-red-950/40 text-red-400 border border-red-900/30 hover:bg-red-900/60 hover:text-white hover:border-red-500/50 transition-all uppercase tracking-widest text-xs font-bold shadow-lg backdrop-blur-sm">
                    <i class="fas fa-arrow-left mr-2"></i> Volver a la Ciudad
                </button>
            </div>
        </div>
    </div>

    <!-- === LOGIN MODAL (ANILLO 0) === -->
    <div id="login-modal"
        class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4">
        <div
            class="glass-modal max-w-sm w-full rounded-xl p-8 border border-red-900/30 shadow-[0_0_50px_rgba(127,29,29,0.2)]">
            <h2 class="text-2xl font-cinzel font-bold text-red-500 mb-6 text-center">Protocolo Sombra</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-[10px] uppercase tracking-widest text-red-900/70 mb-1">Alias</label>
                    <input type="text" id="login-user"
                        class="w-full bg-black/50 border border-red-900/30 rounded px-4 py-3 text-red-100 focus:outline-none focus:border-red-500 transition-colors placeholder-red-900/30"
                        placeholder="Identif√≠cate">
                </div>
                <div>
                    <label class="block text-[10px] uppercase tracking-widest text-red-900/70 mb-1">Clave de
                        Acceso</label>
                    <input type="password" id="login-pass"
                        class="w-full bg-black/50 border border-red-900/30 rounded px-4 py-3 text-red-100 focus:outline-none focus:border-red-500 transition-colors placeholder-red-900/30"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
            </div>
            <div id="login-msg" class="h-6 mt-4 text-xs text-center text-red-400 font-mono"></div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeLoginModal()"
                    class="flex-1 py-3 rounded border border-red-900/30 text-gray-500 hover:text-white hover:bg-white/5 transition-colors text-xs uppercase font-bold">Cancelar</button>
                <button onclick="attemptLogin()"
                    class="flex-1 py-3 rounded bg-red-900/20 hover:bg-red-900/40 text-red-500 border border-red-900/50 transition-all text-xs uppercase font-bold shadow-[0_0_15px_rgba(220,38,38,0.1)] hover:shadow-[0_0_20px_rgba(220,38,38,0.3)]">Acceder</button>
            </div>
        </div>
        <div id="penalty-overlay"
            class="absolute inset-0 bg-red-600 mix-blend-overlay hidden z-[70] pointer-events-none"></div>
    </div>

    <!-- === MAIN APP (MARKET) === -->
    <div id="app"
        class="relative z-10 flex flex-col md:flex-row h-full transition-colors duration-500 hidden opacity-0 transform scale-95">

        <!-- Sidebar Merged into Main HUD -->

        <!-- Main Content -->
        <main class="flex-1 relative overflow-hidden flex flex-col" id="main-container">
            <header
                class="glass-panel border-b border-white/10 p-6 md:p-10 pb-16 relative overflow-hidden flex-shrink-0">
                <div
                    class="absolute top-0 right-0 w-full h-full bg-gradient-to-l from-black/50 to-transparent pointer-events-none">
                </div>
                <div class="relative z-10 w-full">
                    <div class="flex items-center gap-4 mb-2">
                        <span id="shop-icon"
                            class="text-3xl md:text-4xl w-12 h-12 flex items-center justify-center rounded-lg bg-white/10 shadow-lg backdrop-blur-md"></span>
                        <h2 id="shop-title"
                            class="text-3xl md:text-5xl font-cinzel font-bold text-white shadow-black drop-shadow-lg">
                        </h2>
                    </div>
                    <p id="shop-desc"
                        class="text-gray-300 mt-4 text-sm md:text-base leading-relaxed max-w-2xl border-l-4 border-white/20 pl-4">
                    </p>
                </div>
                <div class="absolute -bottom-10 -right-10 text-9xl opacity-5 transform rotate-12" id="bg-icon"></div>
            </header>
            <!-- UI GLOBAL (HIDDEN - Replaced by Sidebar) -->
            <div id="global-user-ui"
                class="hidden fixed top-0 w-full h-20 bg-gradient-to-b from-black via-black/90 to-transparent z-[100] flex justify-between items-start pt-4 px-6 pointer-events-none">
                <!-- Content hidden/removed -->
            </div>
            <!-- GAME AREA (Map + Sidebar) -->
            <div id="game-area-wrapper"
                class="flex flex-col lg:flex-row gap-6 w-full px-8 mb-6 hidden animate-fade-in relative z-20 pt-24">

                <!-- 1. HUB SIDEBAR (Profile + Missions + Bank) -->
                <div id="hub-sidebar" class="w-full lg:w-80 flex-shrink-0 space-y-4">
                    <!-- Profile Card -->
                    <div id="hud-profile-card"
                        class="glass-panel p-6 rounded-xl border border-white/10 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10"><i
                                class="fas fa-id-card text-6xl text-white"></i></div>
                        <h3 class="text-gray-400 text-xs uppercase tracking-widest mb-1">Cazador</h3>
                        <div id="hud-name" class="font-cinzel text-2xl text-white font-bold truncate">Viajero</div>
                        <div class="mt-4 grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Rango</div>
                                <div id="hud-rank" class="text-xl font-bold text-yellow-500 font-cinzel">F</div>
                            </div>
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Gremio</div>
                                <div id="hud-guild" class="text-sm font-bold text-gray-300 leading-tight">...</div>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/5">
                            <div class="text-[10px] text-gray-500 uppercase mb-1">Saldo Actual</div>
                            <div class="text-2xl text-yellow-400 font-mono font-bold flex items-center gap-2">
                                <i class="fas fa-coins text-sm"></i> <span id="hud-gold">0</span>
                                <button onclick="window.forceGold(10000000)" id="kaiser-btn-hud"
                                    class="ml-2 text-yellow-600 hover:text-white hidden"><i
                                        class="fas fa-sync"></i></button>
                            </div>
                        </div>
                    </div>

                    <!-- Active Missions -->
                    <div id="hud-missions-card" class="glass-panel p-6 rounded-xl border border-white/10 min-h-[200px]">
                        <h3 class="text-gray-400 text-xs uppercase tracking-widest mb-4 border-b border-white/10 pb-2">
                            <i class="fas fa-scroll mr-2"></i> Misiones Activas
                        </h3>
                        <div id="hud-missions-list" class="space-y-3 text-sm text-gray-300">
                            <div class="text-center italic opacity-50 text-xs py-4">Sin contratos activos</div>
                        </div>
                    </div>

                    <!-- Bank / Patronage buttons kept in Hub Sidebar for now -->
                    <!-- Buttons Moved to Ring Sidebar -->
                </div>

                <!-- 2. RING SIDEBAR (Title + Shop List) -->
                <div id="ring-sidebar" class="hidden w-full lg:w-80 flex-shrink-0 space-y-4">
                    <!-- Ring Title -->
                    <div
                        class="glass-panel p-4 rounded-xl border border-white/10 text-center relative bg-gradient-to-b from-red-900/20 to-transparent">
                        <h1 class="font-cinzel text-lg font-bold text-white tracking-wider" id="app-ring-title">Eranol
                        </h1>
                        <p class="text-[10px] text-gray-400 mt-1 tracking-widest uppercase" id="app-ring-subtitle">Plaza
                            Central</p>
                    </div>

                    <!-- Bank / Patronage buttons (Specific to Ring 0) -->
                    <div id="patronage-area" class="hidden">
                        <button onclick="openPatronageModal()"
                            class="w-full py-2 rounded-lg bg-gradient-to-r from-red-900 to-red-700 text-white font-bold uppercase tracking-widest hover:brightness-110 transition-all shadow-lg flex items-center justify-center gap-2 border border-red-500/30"><i
                                class="fas fa-hand-holding-usd"></i> Patrocinio Infernal</button>
                    </div>
                    <div id="bank-area" class="hidden">
                        <button onclick="openBankModal()"
                            class="w-full py-2 rounded-lg bg-gradient-to-r from-red-950 to-red-900 text-red-500 font-bold uppercase tracking-widest hover:brightness-110 transition-all shadow-lg flex items-center justify-center gap-2 border border-red-500/30 ring-1 ring-red-900"><i
                                class="fas fa-university"></i> Banco de Bolkar</button>
                    </div>

                    <!-- SHOP LIST -->
                    <nav class="glass-panel p-4 rounded-xl border border-white/10 max-h-[70vh] overflow-y-auto custom-scrollbar"
                        id="shop-nav">
                        <!-- Shops injected here -->
                    </nav>
                </div>

                <!-- RIGHT COLUMN: CONTROLS, MAP, INVENTORY -->
                <div class="flex-1 flex flex-col gap-4 min-w-0">

                    <!-- MARKET CONTROLS TOOLBAR -->
                    <div id="market-controls"
                        class="hidden w-full max-w-5xl mx-auto flex flex-wrap gap-4 justify-between items-center bg-black/40 px-6 py-4 rounded-xl border border-white/10 backdrop-blur-md mb-6">

                        <!-- LEFT: Back Button -->
                        <div id="hub-navigation" class="">
                            <button onclick="enterGlobalMap()" id="btn-back-to-hub"
                                class="px-6 py-3 rounded-lg bg-black/80 text-red-100 text-sm font-bold border border-red-500 hover:bg-red-900 hover:text-white transition-all shadow-[0_0_15px_rgba(220,38,38,0.4)] backdrop-blur-md flex items-center gap-2 z-50">
                                <i class="fas fa-arrow-left"></i> <span>Volver al Mapa</span>
                            </button>
                        </div>

                        <!-- RIGHT: Open Map Button REMOVED -->
                        <div class="flex gap-4 items-center">
                            <!-- Character Sheet -->
                            <button id="btn-character-sheet-hud" onclick="openCharSheet()"
                                class="px-4 py-2 rounded-lg bg-gradient-to-r from-amber-700 to-amber-900 text-amber-100 border border-amber-500/50 font-cinzel font-bold tracking-widest uppercase shadow-[0_0_15px_rgba(245,158,11,0.2)] hover:shadow-[0_0_25px_rgba(245,158,11,0.4)] hover:scale-105 transition-all flex items-center gap-2 text-sm">
                                <i class="fas fa-scroll text-sm text-amber-300"></i>
                                <span>Ficha</span>
                            </button>
                        </div>
                    </div>

                    <!-- MAP CONTAINER REMOVED -->

                    <!-- INVENTORY GRID -->
                    <div id="inventory-grid"
                        class="hidden flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full pb-20 overflow-y-auto custom-scrollbar h-[70vh] p-4 bg-black/20 rounded-xl border border-white/5">
                        <!-- Items injected here -->
                    </div>


                    <!-- CITY INDEX VIEW (Main Hub) -->
                    <div id="city-index-view"
                        class="hidden flex-1 w-full pb-20 overflow-y-auto custom-scrollbar h-[70vh] px-6 pb-6 pt-0 animate-fade-in">


                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full px-4 pb-4 pt-4 max-w-5xl mx-auto">
                            <!-- MERCADO -->
                            <div onclick="enterLandingScreen()"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(239,68,68,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/market.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-60 group-hover:opacity-80">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-red-500 font-bold tracking-widest uppercase text-xs mb-1">Comercio
                                    </div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-red-400 transition-colors">
                                        Mercado</h3>
                                    <p
                                        class="text-gray-400 text-xs mt-1 opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0">
                                        Accede a los anillos comerciales.</p>
                                </div>
                            </div>

                            <!-- BIBLIOTECA -->
                            <div onclick="showToast('La Biblioteca est√° cerrada por reformas.')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(59,130,246,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/library.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-40 group-hover:opacity-60 grayscale group-hover:grayscale-0">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-blue-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Conocimiento</div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-blue-400 transition-colors">
                                        Biblioteca</h3>
                                </div>
                            </div>

                            <!-- TABERNA: EL GRIFO TUERTO -->
                            <div onclick="enterTavern('grifo-tuerto')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(239,68,68,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/tavern_low.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-50 group-hover:opacity-70">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-amber-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Zona Baja
                                    </div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-amber-400 transition-colors">
                                        El Grifo Tuerto</h3>
                                </div>
                            </div>

                            <!-- TABERNA: EL C√ÅLIZ DE MAN√Å -->
                            <div onclick="enterTavern('caliz-mana')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(168,85,247,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/tavern_high.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-50 group-hover:opacity-70">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-purple-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Zona Alta
                                    </div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-purple-400 transition-colors">
                                        El C√°liz de Man√°</h3>
                                </div>
                            </div>

                            <!-- PLAZA DE CONTRATOS -->
                            <div onclick="console.log('Click en Plaza'); if(window.openMissionBoard) { window.openMissionBoard(); } else { alert('ERROR: La funci√≥n openMissionBoard no se ha cargado. Revisa la consola (F12).'); }"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(168,85,247,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/contracts.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-50 group-hover:opacity-70">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-purple-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Misiones</div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-purple-400 transition-colors">
                                        Plaza Contratos</h3>
                                </div>
                            </div>

                            <!-- GREMIOS -->
                            <div onclick="showToast('Solo miembros autorizados.')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(16,185,129,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/guilds.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-40 group-hover:opacity-60 grayscale group-hover:grayscale-0">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-green-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Facciones</div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-green-400 transition-colors">
                                        Gremios</h3>
                                </div>
                            </div>

                            <!-- ARENA -->
                            <div onclick="showToast('La Arena est√° cerrada por mantenimiento (sangre en la pista).')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(220,38,38,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/arena.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-40 group-hover:opacity-60 grayscale group-hover:grayscale-0">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-red-700 font-bold tracking-widest uppercase text-xs mb-1">
                                        Combate
                                    </div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-red-600 transition-colors">
                                        Arena</h3>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- DISTRICT SELECTION GRID (Replaces Map & Placeholder) -->
                    <div id="district-selection-view"
                        class="flex-1 w-full pb-20 overflow-y-auto custom-scrollbar h-[70vh] p-6">
                        <!-- Header for District View -->
                        <div class="z-10 text-center space-y-4 max-w-2xl px-4 animate-fade-in-up relative mx-auto">
                            <button onclick="enterCityIndex()"
                                class="absolute top-8 left-8 text-white/50 hover:text-white transition-colors flex items-center gap-2 uppercase tracking-widest text-xs font-bold">
                                <i class="fas fa-arrow-left"></i> Volver a la Ciudad
                            </button>
                            <div class="inline-block relative">
                                <h2 id="district-title"
                                    class="text-4xl font-cinzel text-white drop-shadow-md border-b-2 border-white/10 inline-block pb-2">
                                    Select a Destination
                                </h2>
                                <p id="district-subtitle" class="text-gray-400 font-serif italic mt-2">Explora los
                                    servicios
                                    disponibles en este anillo</p>
                            </div>
                        </div>

                        <!-- The Grid of Cards -->
                        <div id="district-cards-container"
                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            <!-- Cards injected by JS -->
                        </div>
                    </div>

                    <!-- ARENA VIEW (El Foso de Arena) - MODAL OVERLAY -->
                    <div id="arena-view"
                        class="hidden fixed inset-0 z-[60] bg-black/95 backdrop-blur-md flex items-center justify-center p-4">
                        <div
                            class="relative w-full max-w-7xl h-full max-h-[90vh] overflow-y-auto custom-scrollbar rounded-2xl border border-red-900/30 bg-black/50 shadow-2xl shadow-red-900/10">
                            <!-- Close Button -->
                            <button onclick="exitArena()"
                                class="absolute top-6 right-6 text-gray-500 hover:text-white transition-colors z-50">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                            <div id="arena-content" class="min-h-full p-8 flex flex-col items-center justify-center">
                                <!-- Dynamic Arena Content -->
                            </div>
                        </div>
                    </div>

                    <!-- CASINO VIEW (Allocated in Right Column) -->
                    <div id="casino-view"
                        class="hidden flex-1 p-4 relative overflow-y-auto custom-scrollbar h-[70vh] w-full">
                        <div id="casino-menu" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-5xl mx-auto mt-4">
                            <button onclick="loadGame('slots')"
                                class="group ring0-card bg-black/80 p-6 rounded-xl border border-red-900/30 flex flex-col items-center justify-center gap-2 hover:bg-red-900/10 transition-all">
                                <i
                                    class="fas fa-slot-machine text-4xl text-red-500 group-hover:text-white transition-colors"></i>
                                <h3 class="font-cinzel text-xl font-bold text-red-100">Tragaperras</h3>
                            </button>
                            <button onclick="loadGame('blackjack')"
                                class="group ring0-card bg-black/80 p-6 rounded-xl border border-red-900/30 flex flex-col items-center justify-center gap-2 hover:bg-red-900/10 transition-all">
                                <i
                                    class="fas fa-heart-broken text-4xl text-red-500 group-hover:text-white transition-colors"></i>
                                <h3 class="font-cinzel text-xl font-bold text-red-100">Blackjack</h3>
                            </button>
                            <button onclick="loadGame('roulette')"
                                class="group ring0-card bg-black/80 p-6 rounded-xl border border-red-900/30 flex flex-col items-center justify-center gap-2 hover:bg-red-900/10 transition-all">
                                <i
                                    class="fas fa-dot-circle text-4xl text-red-500 group-hover:text-white transition-colors"></i>
                                <h3 class="font-cinzel text-xl font-bold text-red-100">Ruleta Rusa</h3>
                            </button>
                        </div>

                        <!-- SLOTS -->
                        <div id="game-slots"
                            class="hidden max-w-md mx-auto mt-4 text-center glass-panel p-6 rounded-xl border border-yellow-600/30">
                            <h3 class="font-cinzel text-2xl text-yellow-500 mb-4">TRAGAPERRAS</h3>
                            <div
                                class="flex justify-center gap-4 mb-4 text-4xl bg-black/50 p-4 rounded-lg border border-white/10 shadow-inner">
                                <div id="slot1">üçí</div>
                                <div id="slot2">üçí</div>
                                <div id="slot3">üçí</div>
                            </div>
                            <button onclick="spinSlots()" id="btn-slots"
                                class="w-full py-3 bg-red-700 hover:bg-red-600 text-white font-bold rounded shadow-lg uppercase tracking-widest transition-all">Tirar
                                (50 mo)</button>
                            <p id="slot-msg" class="mt-2 text-yellow-300 font-mono h-6"></p>
                            <button onclick="exitGame()"
                                class="mt-4 text-gray-500 hover:text-white text-xs underline">Volver</button>
                        </div>

                        <!-- BLACKJACK -->
                        <div id="game-blackjack"
                            class="hidden max-w-2xl mx-auto mt-4 text-center glass-panel p-6 rounded-xl border border-green-900/30 bg-green-900/5">
                            <h3 class="font-cinzel text-2xl text-green-500 mb-2">BLACKJACK</h3>
                            <div class="flex justify-center gap-8 mb-4">
                                <div>
                                    <div class="text-[10px] uppercase text-gray-500 mb-1">Crupier</div>
                                    <div id="dealer-hand" class="flex justify-center gap-2 min-h-[40px]"></div>
                                    <div id="dealer-score" class="mt-1 text-red-500 font-mono text-sm"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] uppercase text-gray-500 mb-1">Tu Mano</div>
                                    <div id="player-hand" class="flex justify-center gap-2 min-h-[40px]"></div>
                                    <div id="player-score" class="mt-1 text-green-400 font-mono text-sm"></div>
                                </div>
                            </div>
                            <div id="bj-controls" class="space-x-2">
                                <button onclick="hit()"
                                    class="px-4 py-1 bg-green-900 hover:bg-green-700 text-white rounded border border-green-500/30">Pedir</button>
                                <button onclick="stand()"
                                    class="px-4 py-1 bg-gray-800 hover:bg-gray-700 text-white rounded border border-gray-600">Plantarse</button>
                            </div>
                            <div id="bj-msg" class="mt-4 font-bold text-lg min-h-[28px]"></div>
                            <button onclick="deal()" id="btn-deal"
                                class="mt-2 px-6 py-2 bg-red-900 hover:bg-red-700 text-white rounded uppercase font-bold tracking-widest shadow-lg">Repartir
                                (100 mo)</button>
                            <button onclick="exitGame()"
                                class="block mx-auto mt-4 text-gray-500 hover:text-white text-xs underline">Volver</button>
                        </div>

                        <!-- ROULETTE -->
                        <div id="game-roulette" class="hidden text-center mt-4 max-w-4xl mx-auto">
                            <h3 class="font-cinzel text-2xl text-red-500 mb-2">RULETA RUSA</h3>
                            <div class="flex flex-col md:flex-row gap-4">
                                <div class="flex-1 flex flex-col items-center justify-center">
                                    <div class="relative w-[200px] h-[200px]">
                                        <canvas id="roulette-canvas" width="200" height="200"
                                            class="rounded-full shadow-2xl"></canvas>
                                    </div>
                                </div>
                                <div class="flex-1 glass-panel p-4 rounded-xl border border-red-900/30">
                                    <div class="grid grid-cols-3 gap-2 mb-4">
                                        <button onclick="selectRouletteBet('red')" id="bet-red"
                                            class="p-2 bg-red-900/40 border border-red-500/30 text-red-300 text-xs">ROJO
                                            (x2)</button>
                                        <button onclick="selectRouletteBet('black')" id="bet-black"
                                            class="p-2 bg-gray-900/80 border border-gray-600/30 text-gray-300 text-xs">NEGRO
                                            (x2)</button>
                                        <button onclick="selectRouletteBet('green')" id="bet-green"
                                            class="p-2 bg-green-900/40 border border-green-500/30 text-green-300 text-xs">VERDE
                                            (x14)</button>
                                    </div>
                                    <input type="number" id="roulette-number" min="0" max="36" placeholder="#"
                                        class="w-full bg-black/50 border border-white/10 rounded px-2 py-1 text-white text-center mb-2">
                                    <button onclick="spinRoulette()" id="btn-spin-roulette"
                                        class="w-full py-2 bg-red-800 text-white font-bold uppercase rounded">Jugar
                                        (100
                                        mo)</button>
                                    <button onclick="exitGame()"
                                        class="block mx-auto mt-2 text-gray-500 hover:text-white text-xs underline">Volver</button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

            <!-- Removed old inventory grid location -->
            <div id="empty-ring-msg"
                class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center text-gray-500 w-full">
                <i class="fas fa-store-slash text-6xl mb-4 opacity-50 block"></i>
                <h3 class="text-xl font-cinzel font-bold">Acceso Denegado / Sin Stock</h3>
                <p class="text-sm mt-2">No hay tiendas disponibles en este anillo actualmente.</p>
            </div>
        </main>
    </div>
    </div>

    <!-- Modals (Item Details, Wheel Fortune, Patronage, Cart, Toast) remain same structure -->
    <!-- ITEM MODAL -->
    <div id="item-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 opacity-0 transition-opacity duration-300">
        <div class="glass-modal max-w-lg w-full rounded-2xl overflow-hidden shadow-2xl transform scale-95 transition-transform duration-300"
            id="item-modal-content">
            <div class="h-96 relative overflow-hidden flex items-center justify-center transition-all duration-500 bg-contain bg-no-repeat bg-center"
                id="modal-header-bg">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-80">
                </div>
                <i id="modal-icon" class="fas fa-gem text-6xl text-white/20 relative z-10"></i>
                <button onclick="closeModal()"
                    class="absolute top-4 right-4 text-white hover:text-red-400 z-20 bg-black/50 w-8 h-8 rounded-full flex items-center justify-center backdrop-blur-sm transition-colors"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="p-8 relative">
                <span id="modal-rarity"
                    class="absolute -top-3 right-8 px-3 py-1 rounded-full text-xs font-bold border shadow-lg backdrop-blur-md z-20">Rara</span>
                <div class="flex justify-between items-start mb-2">
                    <div><span id="modal-type"
                            class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Tipo</span>
                        <h2 id="modal-title" class="text-2xl font-cinzel font-bold text-white mb-1">Nombre</h2>
                    </div>
                </div>
                <div class="flex items-center gap-2 mb-6 text-xl text-yellow-400 font-mono font-bold"><i
                        class="fas fa-coins"></i><span id="modal-price">0</span> <span
                        class="text-sm text-gray-500 ml-1">mo</span></div>
                <div class="prose prose-invert prose-sm mb-6 max-h-40 overflow-y-auto pr-2 custom-scrollbar">
                    <p id="modal-desc" class="text-gray-300 leading-relaxed"></p>
                </div>
                <div class="flex gap-4">
                    <button onclick="closeModal()"
                        class="flex-1 py-3 rounded-lg border border-white/20 text-gray-300 hover:bg-white/5 font-bold text-sm uppercase">Cerrar</button>
                    <button id="modal-add-btn"
                        class="flex-1 py-3 rounded-lg accent-bg text-white hover:brightness-110 font-bold text-sm uppercase shadow-lg flex items-center justify-center gap-2"><i
                            class="fas fa-shopping-cart"></i> A√±adir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Legacy Wheel Modal Removed -->

    <!-- MAP MODAL REMOVED BY USER REQUEST -->

    <!-- MISSION BOARD MODAL -->
    <div id="mission-board"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-7xl w-full rounded-2xl overflow-hidden shadow-2xl border border-gray-700/50 flex flex-col h-[80vh]">
            <div class="p-6 border-b border-gray-700/50 bg-gray-900/50 flex justify-between items-center shrink-0">
                <div>
                    <h2 class="text-2xl font-cinzel font-bold text-gray-200"><i class="fas fa-scroll mr-2"></i> Plaza de
                        los Contratos</h2>
                    <p class="text-gray-400 text-xs tracking-wider uppercase">Misiones Disponibles</p>
                </div>
                <button onclick="closeMissionBoard()" class="text-gray-400 hover:text-white transition-colors"><i
                        class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 bg-black/40 custom-scrollbar" id="mission-list">
                <!-- Contracts injected via JS -->
            </div>
        </div>
    </div>

    <!-- MODAL: TAVERN DETAILS -->
    <div id="tavern-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-5xl w-full rounded-2xl overflow-hidden shadow-2xl border flex flex-col h-[85vh] transition-all duration-300 scale-95 transform">
            <!-- Header -->
            <div class="p-6 border-b border-white/10 bg-black/40 flex justify-between items-center shrink-0">
                <div>
                    <h2 class="text-3xl font-cinzel font-bold text-white"><i id="tavern-icon"></i> <span
                            id="tavern-title">Taberna</span></h2>
                    <p id="tavern-subtitle" class="text-gray-400 italic text-sm">Ubicaci√≥n</p>
                </div>
                <button onclick="closeTavern()"
                    class="text-gray-400 hover:text-white transition-colors text-2xl">&times;</button>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto custom-scrollbar p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Col 1: Info & Minigame -->
                <div class="space-y-6">
                    <div class="bg-white/5 p-4 rounded-xl border border-white/10">
                        <h3 class="text-xl font-cinzel text-amber-500 mb-2">Ambiente</h3>
                        <p id="tavern-desc" class="text-gray-300 italic text-sm">...</p>
                    </div>

                    <div class="bg-gradient-to-br from-amber-900/40 to-black p-4 rounded-xl border border-amber-500/30">
                        <h3 class="text-xl font-cinzel text-white mb-2"><i class="fas fa-dice mr-2"></i> Minijuego</h3>
                        <strong id="tavern-minigame-title" class="block text-amber-400 mb-1">...</strong>
                        <p id="tavern-minigame-desc" class="text-sm text-gray-300 pb-2">...</p>
                        <button
                            class="w-full bg-amber-600 hover:bg-amber-500 text-white py-1 rounded transition-colors text-sm">Jugar</button>
                    </div>

                    <div>
                        <h3 class="text-xl font-cinzel text-white mb-3 mt-4 border-b border-white/10 pb-1">Eventos &
                            Rumores</h3>
                        <div id="tavern-events-list" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Col 2: Food Menu -->
                <div class="bg-white/5 p-4 rounded-xl border border-white/10 h-full">
                    <h3 class="text-xl font-cinzel text-center text-orange-400 mb-4 border-b border-white/10 pb-2"><i
                            class="fas fa-drumstick-bite mr-2"></i> Comida</h3>
                    <div id="tavern-food-list" class="space-y-3"></div>
                </div>

                <!-- Col 3: Drink Menu -->
                <div class="bg-white/5 p-4 rounded-xl border border-white/10 h-full">
                    <h3 class="text-xl font-cinzel text-center text-blue-400 mb-4 border-b border-white/10 pb-2"><i
                            class="fas fa-wine-bottle mr-2"></i> Bebida</h3>
                    <div id="tavern-drink-list" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- PATRONAGE MODAL -->
    <div id="patronage-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-2xl w-full rounded-2xl overflow-hidden shadow-2xl border border-red-900/50 flex flex-col h-[80vh] md:h-[70vh]">
            <div class="p-6 border-b border-red-900/30 bg-red-900/10 flex justify-between items-center shrink-0">
                <h2 class="text-2xl font-cinzel font-bold text-red-500"><i class="fas fa-hand-holding-usd mr-2"></i>
                    Patrocinio Infernal</h2>
                <button onclick="closePatronageModal()" class="text-red-400 hover:text-red-200"><i
                        class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-8 overflow-y-auto custom-scrollbar flex-1">
                <div class="prose prose-invert prose-sm max-w-none">
                    <p class="text-red-200 mb-2 font-bold text-lg">Volkar no es un banco, es un inversor.</p>
                    <p class="text-gray-400 mb-4">Si te presta oro, quiere que ganes... para que luego trabajes para √©l.
                    </p>
                    <h3 class="text-yellow-500 font-bold mb-2">‚úÖ La Ventaja (Socio Preferente):</h3>
                    <ul class="list-disc pl-5 space-y-2 text-gray-400 mb-4">
                        <li><strong class="text-white">Suerte del Diablo:</strong> 1/d√≠a, convierte cualquier tirada en
                            un 20 natural.</li>
                    </ul>
                    <h3 class="text-red-500 font-bold mb-2">‚ùå El Precio (La Trampa):</h3>
                    <ul class="list-disc pl-5 space-y-2 text-gray-400 mb-6">
                        <li>Volkar aparecer√° aleatoriamente para cobrar "una cuota".</li>
                    </ul>
                </div>
                <div class="mt-8 grid grid-cols-2 gap-4 pb-4">
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(10000)">
                        <div class="text-2xl text-red-500 mb-1 font-bold">10k MS</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Inversi√≥n Inicial</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(50000)">
                        <div class="text-2xl text-red-500 mb-1 font-bold">50k MS</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Socio Minoritario</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(150000)">
                        <div class="text-2xl text-red-500 mb-1 font-bold">150k MS</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Socio Mayoritario</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(400000)">
                        <div class="text-2xl text-red-500 mb-1 font-bold">400k MS</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Alma Vendida</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- LOAN CONFIRMATION MODAL -->
    <div id="loan-confirm-modal"
        class="fixed inset-0 z-[70] hidden flex items-center justify-center bg-black/95 backdrop-blur-xl p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-sm w-full rounded-2xl border border-red-600 shadow-[0_0_100px_rgba(220,38,38,0.4)] p-8 text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-red-900/10 animate-pulse"></div>
            <i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4 relative z-10"></i>
            <h2 class="text-2xl font-cinzel font-bold text-white mb-2 relative z-10">¬øAceptar el Pacto?</h2>
            <p class="text-gray-400 text-sm mb-6 relative z-10">Recibir√°s <span id="loan-confirm-amount"
                    class="text-red-500 font-bold text-lg">0</span> Monedas de Sangre.</p>
            <p class="text-[10px] text-red-400/70 uppercase tracking-widest mb-8 relative z-10">La deuda es eterna.</p>

            <div class="flex gap-4 relative z-10">
                <button onclick="closeLoanConfirm()"
                    class="flex-1 py-3 rounded border border-white/10 hover:bg-white/5 text-gray-400 text-xs font-bold uppercase tracking-widest transition-colors">Cancelar</button>
                <button onclick="confirmLoan()"
                    class="flex-1 py-3 rounded bg-red-700 hover:bg-red-600 text-white text-xs font-bold uppercase tracking-widest shadow-lg transition-all hover:scale-105">Firmar</button>
            </div>
        </div>
    </div>

    <!-- CART SIDEBAR -->
    <div id="cart-sidebar"
        class="fixed inset-y-0 right-0 w-full md:w-96 glass-modal z-[200] transform translate-x-full transition-transform duration-300 flex flex-col shadow-2xl border-l border-white/10">
        <div class="p-6 border-b border-white/10 flex justify-between items-center accent-bg">
            <h2 class="text-xl font-cinzel font-bold text-white"><i class="fas fa-shopping-cart mr-2"></i> Inventario
            </h2>
            <button onclick="toggleCart()" class="text-white/70 hover:text-white"><i
                    class="fas fa-times text-xl"></i></button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
        <div class="p-6 border-t border-white/10 bg-black/20">
            <div id="discount-row" class="flex justify-between items-center mb-2 text-sm hidden">
                <span class="text-green-400">Descuento aplicado:</span><span class="text-green-400 font-mono"
                    id="discount-amount">0%</span>
            </div>
            <div class="flex justify-between items-center mb-4 text-lg font-bold">
                <span class="text-gray-400">Total</span><span class="text-yellow-400 font-mono"><span
                        id="cart-total">0</span> mo</span>
            </div>
            <button onclick="checkout()"
                class="w-full py-3 rounded-lg accent-bg text-white font-bold uppercase tracking-widest hover:brightness-110 shadow-lg"><i
                    class="fas fa-scroll mr-2"></i> Confirmar</button>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast"
        class="fixed bottom-8 left-1/2 transform -translate-x-1/2 glass-panel px-6 py-3 rounded-full flex items-center gap-3 shadow-2xl translate-y-20 transition-all duration-300 z-50 border border-green-500/30">
        <i class="fas fa-check-circle text-green-400"></i><span id="toast-msg"
            class="text-sm font-bold text-white"></span>
    </div>

    <!-- Bolkar's Bank Modal -->
    <div id="bank-modal"
        class="fixed inset-0 z-50 flex items-center justify-center hidden bg-black/80 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal p-8 rounded-lg max-w-md w-full border border-red-900/50 shadow-[0_0_50px_rgba(220,38,38,0.2)]">
            <h2
                class="text-3xl font-cinzel text-red-600 font-bold mb-2 text-center drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)]">
                Banco de Bolkar</h2>
            <p class="text-gray-400 text-center text-sm mb-6 uppercase tracking-widest">Cambio de Divisas</p>

            <div class="flex items-center justify-center gap-8 mb-6">
                <div class="text-center">
                    <div class="text-3xl text-yellow-500 mb-1"><i class="fas fa-coins"></i></div>
                    <div class="text-xs text-gray-500 font-bold">ORO</div>
                    <div class="text-xs text-yellow-500 font-mono mt-1" id="bank-gold-balance">0</div>
                </div>
                <div class="text-gray-500"><i class="fas fa-arrow-right"></i></div>
                <div class="text-center">
                    <div class="text-3xl text-red-600 mb-1"><i class="fas fa-skull"></i></div>
                    <div class="text-xs text-gray-500 font-bold">SANGRE</div>
                    <div class="text-xs text-red-500 font-mono mt-1" id="bank-blood-balance">0</div>
                </div>
            </div>

            <p class="text-center text-red-400 font-bold mb-6 bg-red-950/30 py-2 rounded border border-red-900/30">
                1 Moneda de Oro = 10 Monedas de Sangre
            </p>

            <div class="mb-6">
                <label class="block text-gray-400 text-xs uppercase tracking-wider mb-2">Cantidad de Oro a
                    Cambiar</label>
                <div class="flex gap-2">
                    <input type="number" id="bank-input"
                        class="w-full bg-black/50 border border-red-900/50 rounded px-4 py-2 text-white outline-none focus:border-red-500 font-mono"
                        placeholder="0">
                    <button onclick="bankExchangeMax()"
                        class="px-4 bg-red-900/50 hover:bg-red-900 text-red-200 rounded border border-red-900 transition-colors font-bold text-xs">MAX</button>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-right">Recibir√°s: <span id="bank-estimate"
                        class="text-red-500 font-bold">0</span> ms</p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="closeBankModal()"
                    class="py-2 rounded border border-white/10 text-gray-400 hover:bg-white/5 hover:text-white transition-colors uppercase tracking-widest text-xs font-bold">Cancelar</button>
                <button onclick="bankExchange()"
                    class="py-2 rounded bg-red-900 hover:bg-red-800 text-white transition-colors uppercase tracking-widest text-xs font-bold border border-red-500 shadow-[0_0_15px_rgba(220,38,38,0.4)]">Cambiar</button>
            </div>
        </div>
    </div>

    <!-- Wheel Countdown Overlay -->
    <div id="wheel-countdown" class="fixed inset-0 z-[60] bg-black/90 flex items-center justify-center hidden">
        <div class="text-9xl font-cinzel font-bold text-red-600 animate-pulse tracking-widest drop-shadow-[0_0_50px_rgba(220,38,38,0.8)]"
            id="countdown-number">3</div>
    </div>


    <!-- MEDIEVAL CHARACTER SHEET MODAL (OVERHAULED) -->
    <div id="character-sheet-modal">
        <div class="sheet-container">
            <!-- Background Layers -->
            <div class="sheet-bg-layer"></div>
            <div class="sheet-frame-layer"></div>

            <!-- Close Button (Ornate) -->
            <button class="close-sheet" id="close-char-sheet">
                <i class="fas fa-times"></i>
            </button>

            <!-- HEADER -->
            <div class="sheet-header">
                <div class="header-decoration left"></div>
                <div class="char-identity">
                    <h2 id="char-name">Viajero</h2>
                    <div class="char-meta">
                        <span id="char-race">Humano</span> / <span id="char-class">Aventurero</span>
                        <span class="level-badge">LVL <span id="char-level">3</span></span>
                    </div>
                </div>
                <div class="header-decoration right"></div>
            </div>

            <!-- CONTENT GRID -->
            <div class="sheet-body">

                <!-- LEFT COL: STATS & PROGRESS -->
                <div class="col-stats">
                    <div class="progress-section">
                        <div class="xp-label">Experiencia</div>
                        <div class="xp-bar-container">
                            <div id="xp-bar" class="xp-fill" style="width: 45%"></div>
                            <span class="xp-text"><span id="char-xp">2500</span> / <span
                                    id="char-next-xp">6000</span></span>
                        </div>
                    </div>

                    <div class="stats-hex-grid">
                        <!-- STR -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">FUE</div>
                                <div class="stat-value" id="stat-str">12</div>
                                <div class="stat-mod" id="mod-str">+1</div>
                            </div>
                        </div>
                        <!-- DEX -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">DES</div>
                                <div class="stat-value" id="stat-dex">14</div>
                                <div class="stat-mod" id="mod-dex">+2</div>
                            </div>
                        </div>
                        <!-- CON -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">CON</div>
                                <div class="stat-value" id="stat-con">13</div>
                                <div class="stat-mod" id="mod-con">+1</div>
                            </div>
                        </div>
                        <!-- INT -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">INT</div>
                                <div class="stat-value" id="stat-int">10</div>
                                <div class="stat-mod" id="mod-int">+0</div>
                            </div>
                        </div>
                        <!-- WIS -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">SAB</div>
                                <div class="stat-value" id="stat-wis">12</div>
                                <div class="stat-mod" id="mod-wis">+1</div>
                            </div>
                        </div>
                        <!-- CHA -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">CAR</div>
                                <div class="stat-value" id="stat-cha">11</div>
                                <div class="stat-mod" id="mod-cha">+0</div>
                            </div>
                        </div>
                    </div>

                    <div class="currency-panel">
                        <div class="coin-icon glow"><i class="fas fa-coins"></i></div>
                        <div class="coin-amount" id="char-gold">500</div>
                        <div class="coin-label">Monedas de Oro</div>
                    </div>
                </div>

                <!-- RIGHT COL: EQUIPMENT & INVENTORY -->
                <div class="col-inventory">
                    <!-- Equipment Mannequin (Simplified Visuals for now) -->
                    <div class="equipment-row">
                        <div class="equip-slot head" title="Cabeza"><i class="fas fa-helmet-safety"></i></div>
                        <div class="equip-slot chest" title="Cuerpo"><i class="fas fa-shirt"></i></div>
                        <div class="equip-slot main-hand" title="Mano Principal"><i class="fas fa-khanda"></i></div>
                        <div class="equip-slot off-hand" title="Mano Secundaria"><i class="fas fa-shield"></i></div>
                        <div class="equip-slot acc" title="Accesorio"><i class="fas fa-ring"></i></div>
                    </div>

                    <div class="inventory-container">
                        <div class="inventory-header">
                            <h3>Bolsa de Aventurero</h3>
                            <div class="inv-tabs">
                                <button class="inv-tab active" data-filter="all"><i class="fas fa-box"></i></button>
                                <button class="inv-tab" data-filter="consumable"><i class="fas fa-flask"></i></button>
                                <button class="inv-tab" data-filter="misc"><i class="fas fa-scroll"></i></button>
                                <button class="inv-tab" data-filter="quest" title="Objetos de Misi√≥n"><i
                                        class="fas fa-key"></i></button>
                            </div>
                        </div>
                        <div id="sheet-inventory" class="inventory-grid custom-scrollbar">
                            <!-- JS Injects items here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- CORE LOGIC -->

    <!-- TOAST NOTIFICATION -->
    <!-- MISSION BOARD MODAL -->
    <div id="mission-board"
        class="fixed inset-0 z-[100] flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeMissionBoard()"></div>
        <div
            class="glass-modal w-full max-w-5xl h-[85vh] rounded-xl flex flex-col relative transform scale-95 transition-transform duration-300 overflow-hidden border border-[#3e2723] shadow-[0_0_50px_rgba(0,0,0,0.8)]">

            <!-- HEADER -->
            <div
                class="h-24 bg-[#1a100c] flex items-center justify-between px-8 border-b border-[#3e2723] relative overflow-hidden">
                <!-- Background Decoration -->
                <div
                    class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')] opacity-10 mix-blend-overlay">
                </div>

                <div class="flex items-center gap-4 relative z-10">
                    <div
                        class="w-12 h-12 rounded-full bg-[#2c1810] border border-[#5d4037] flex items-center justify-center shadow-inner">
                        <i class="fas fa-scroll text-[#a1887f] text-xl"></i>
                    </div>
                    <div>
                        <h2 class="font-cinzel text-3xl font-bold text-[#d7ccc8] tracking-wider">Tabl√≥n de Contratos
                        </h2>
                        <p class="text-[10px] text-[#8d6e63] uppercase tracking-[0.2em] font-bold">Gremio de Cazadores
                        </p>
                    </div>
                </div>

                <button onclick="closeMissionBoard()"
                    class="w-10 h-10 rounded-full bg-[#2c1810] text-[#8d6e63] hover:text-white hover:bg-red-900/50 transition-colors flex items-center justify-center border border-[#3e2723] z-20">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- TABS CONTAINER (Injected by JS) -->

            <!-- LIST CONTAINER -->
            <div id="mission-list">
                <!-- JS Injects Missions Here -->
            </div>

        </div>
    </div>

    <!-- STATUS OVERLAY (Auto-Closing Modal) -->
    <div id="status-overlay"
        class="fixed inset-0 z-[20000] flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300">
        <!-- Backdrop (Optional, slight dim) -->
        <div class="absolute inset-0 bg-black/40 backdrop-blur-[2px]"></div>

        <!-- Content Card -->
        <div
            class="relative bg-black/90 border border-yellow-500/30 rounded-xl p-8 shadow-[0_0_50px_rgba(0,0,0,0.8)] transform scale-95 transition-transform duration-300 flex flex-col items-center text-center gap-4 max-w-sm mx-4">
            <div class="text-yellow-500 text-4xl mb-2 animate-pulse"><i id="status-icon" class="fas fa-info-circle"></i>
            </div>
            <h3 id="status-msg" class="text-white font-cinzel text-xl font-bold tracking-wider leading-relaxed">Mensaje
                del Sistema</h3>
            <div class="h-1 w-20 bg-gradient-to-r from-transparent via-yellow-500 to-transparent"></div>
        </div>
    </div>

    <!-- DEBUG PANEL (Temporary) -->
    <!-- Debug Panel Removed -->

    <script type="module" src="/src/main.js"></script>
    <!-- Removed redundant inline initialization to prevent double-loading -->
</body>

</html>
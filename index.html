<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercado Arcano de Eranol</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fallback if CDN fails or for local overrides -->
    <link rel="stylesheet" href="src/css/index.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Roboto:wght@300;400;500;700&family=Orbitron:wght@500&display=swap"
        rel="stylesheet">



    <link rel="stylesheet" href="src/css/medieval-sheet.css?v=7.1">
</head>

<body
    class="bg-black text-white min-h-screen overflow-x-hidden font-sans selection:bg-red-900 selection:text-white select-none">
    <!-- Background Effects -->
    <div class="fixed inset-0 z-0 pointer-events-none"></div>

    <!-- === GLOBAL USER UI (Top Right) === -->
    <div id="global-user-ui"
        class="fixed top-6 right-6 z-[100] flex items-center gap-4 hidden transition-opacity duration-500">
        <div
            class="glass-panel px-4 py-2 rounded-full border border-white/10 flex items-center gap-3 shadow-lg bg-black/40 backdrop-blur-md">
            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
            <span id="global-username"
                class="font-cinzel text-sm text-gray-200 uppercase tracking-widest">Viajero</span>
        </div>
        <button onclick="logout()"
            class="w-10 h-10 rounded-full bg-red-900/40 hover:bg-red-600 border border-red-500/30 text-red-200 hover:text-white flex items-center justify-center transition-all shadow-[0_0_15px_rgba(220,38,38,0.3)] hover:shadow-[0_0_25px_rgba(220,38,38,0.6)] group">
            <i class="fas fa-power-off text-sm group-hover:scale-110 transition-transform"></i>
        </button>
    </div>

    <!-- === 1. ADVENTURER LOGIN SCREEN === -->
    <div id="adventurer-login"
        class="fixed inset-0 z-[200] w-full h-full bg-black flex flex-col items-center justify-center transition-all duration-700">
        <div
            class="glass-panel p-10 rounded-2xl border border-white/10 shadow-2xl max-w-md w-full text-center animate-fade-in">
            <div class="mb-6 text-5xl text-purple-400"><i class="fas fa-id-card-alt"></i></div>
            <h1 class="font-cinzel text-3xl font-bold text-white mb-2 tracking-wider">Capital Eranol</h1>
            <p class="text-gray-400 text-xs uppercase tracking-[0.2em] mb-8">Introduzca ID de Cazador <span
                    class="text-[9px] opacity-30">v7.1</span></p>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="text" id="adv-name-input"
                        class="w-full bg-black/50 border border-white/20 rounded-lg px-4 py-4 text-center text-white placeholder-gray-600 focus:outline-none focus:border-purple-500 transition-all font-cinzel text-lg"
                        placeholder="Alias de Cazador">
                </div>
                <div class="relative group">
                    <input type="password" id="adv-pass-input"
                        class="w-full bg-black/50 border border-white/20 rounded-lg px-4 py-4 text-center text-white placeholder-gray-600 focus:outline-none focus:border-purple-500 transition-all font-cinzel text-lg"
                        placeholder="Contraseña">
                </div>
            </div>
            <button onclick="loginAdventurer()"
                class="mt-8 w-full py-3 rounded-lg bg-gradient-to-r from-purple-900 to-indigo-900 hover:from-purple-800 hover:to-indigo-800 text-white font-bold uppercase tracking-widest transition-all shadow-[0_0_20px_rgba(88,28,135,0.4)] hover:shadow-[0_0_30px_rgba(88,28,135,0.6)] border border-purple-500/30">
                Verificar Credenciales
            </button>
        </div>
    </div>

    <!-- === 2. LANDING SCREEN (RING SELECTION) === -->
    <div id="landing-screen"
        class="hidden relative z-50 w-full h-full flex flex-col items-center justify-center transition-all duration-700 opacity-0 scale-95 p-6 overflow-y-auto">
        <div class="text-center mb-10 md:mb-16 relative shrink-0">
            <div
                class="absolute -inset-1 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg blur opacity-20 animate-pulse">
            </div>
            <h1
                class="relative font-cinzel text-4xl md:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-200 via-white to-pink-200 tracking-widest mb-4 drop-shadow-2xl">
                MERCADO DE ERANOL
            </h1>
            <p class="text-gray-400 text-xs md:text-sm tracking-[0.6em] uppercase font-light">
                Bienvenido, <span id="display-username"
                    class="text-white font-semibold border-b border-purple-500/50 pb-1">Viajero</span>
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 max-w-7xl w-full shrink-0 items-stretch">

            <!-- Anillo 0: Mercado Negro (NUEVO ACCESO DIRECTO) -->
            <button onclick="enterMarket(0)"
                class="select-none group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_40px_rgba(220,38,38,0.3)] text-left overflow-hidden bg-black/80 border border-red-900/30 hover:border-red-500 animate-fade-in"
                style="animation-delay: 0.05s">
                <div
                    class="absolute inset-0 bg-[url('/img/hub/tavern_low.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 saturate-0 group-hover:saturate-100">
                </div>
                <div
                    class="absolute inset-0 bg-gradient-to-b from-red-950/40 to-black opacity-80 group-hover:opacity-60 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-red-500/5 group-hover:text-red-500/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-skull"></i>
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-biohazard text-5xl md:text-6xl text-red-800 group-hover:text-red-500 transition-colors drop-shadow-lg"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-red-900 mb-2 group-hover:text-red-500 transition-colors">
                        Mercado Negro</h3>
                    <div
                        class="w-8 h-1 bg-red-900 mb-4 group-hover:w-full group-hover:bg-red-600 transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-red-700 uppercase tracking-widest border border-red-900/50 inline-block px-2 py-1 rounded mb-2 group-hover:bg-red-900/30 transition-colors">
                            Anillo 0 • Prohibido</p>
                        <p
                            class="text-gray-500 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            Entra bajo tu propio riesgo.</p>
                    </div>
                </div>
            </button>

            <!-- Anillo 1 -->
            <button onclick="enterMarket(1)"
                class="select-none group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_30px_rgba(255,255,255,0.1)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-gray-400 animate-fade-in"
                style="animation-delay: 0.1s">
                <div
                    class="absolute inset-0 bg-[url('/img/hub/market.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110">
                </div>
                <div
                    class="absolute inset-0 bg-gradient-to-b from-gray-800/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-white/5 group-hover:text-white/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-hammer"></i>
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-hammer text-5xl md:text-6xl text-gray-600 group-hover:text-gray-200 transition-colors drop-shadow-lg"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-gray-300 mb-2 group-hover:text-white transition-colors">
                        El Mercado de Hierro</h3>
                    <div
                        class="w-8 h-1 bg-gray-600 mb-4 group-hover:w-full group-hover:bg-white transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-gray-500 uppercase tracking-widest border border-gray-700 inline-block px-2 py-1 rounded mb-2 group-hover:bg-gray-800 transition-colors">
                            Anillo 1 • Rangos E-D</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            Suministros básicos para comenzar tu leyenda.</p>
                    </div>
                </div>
            </button>

            <!-- Anillo 2 -->
            <button onclick="enterMarket(2)"
                class="select-none group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_40px_rgba(59,130,246,0.3)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-blue-400 animate-fade-in"
                style="animation-delay: 0.2s">
                <div
                    class="absolute inset-0 bg-[url('/img/hub/library.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110">
                </div>
                <div
                    class="absolute inset-0 bg-gradient-to-b from-blue-900/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-blue-500/5 group-hover:text-blue-500/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-gem"></i>
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-gem text-5xl md:text-6xl text-blue-900 group-hover:text-blue-300 transition-colors drop-shadow-[0_0_15px_rgba(59,130,246,0.5)]"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-blue-100/70 mb-2 group-hover:text-white transition-colors">
                        La Plaza de Plata</h3>
                    <div
                        class="w-8 h-1 bg-blue-800 mb-4 group-hover:w-full group-hover:bg-blue-400 transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-blue-500 uppercase tracking-widest border border-blue-900/50 inline-block px-2 py-1 rounded mb-2 group-hover:bg-blue-900/30 transition-colors">
                            Anillo 2 • Rangos C-B</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            Donde la magia fluye como moneda.</p>
                    </div>
                </div>
            </button>

            <!-- Anillo 3 -->
            <button onclick="enterMarket(3)"
                class="select-none group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_50px_rgba(234,179,8,0.4)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-yellow-500 animate-fade-in"
                style="animation-delay: 0.3s">
                <div
                    class="absolute inset-0 bg-[url('/img/hub/guilds.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110">
                </div>
                <div
                    class="absolute inset-0 bg-gradient-to-b from-yellow-900/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-yellow-500/5 group-hover:text-yellow-500/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-crown"></i>
                </div>
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl group-hover:bg-yellow-500/20 transition-all">
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-crown text-5xl md:text-6xl text-yellow-900 group-hover:text-yellow-400 transition-colors drop-shadow-[0_0_20px_rgba(234,179,8,0.6)]"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-yellow-100/60 mb-2 group-hover:text-white transition-colors">
                        La Cumbre Dorada</h3>
                    <div
                        class="w-8 h-1 bg-yellow-800 mb-4 group-hover:w-full group-hover:bg-yellow-500 transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-yellow-600 uppercase tracking-widest border border-yellow-900/50 inline-block px-2 py-1 rounded mb-2 group-hover:bg-yellow-900/30 transition-colors">
                            Anillo 3 • Rangos A-S</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            El pináculo del poder. Artefactos legendarios.</p>
                    </div>
                </div>
            </button>
        </div>
        <div class="mt-8 text-center shrink-0 relative z-20">
            <button onclick="enterCityIndex()"
                class="px-6 py-3 rounded-lg bg-red-950/40 text-red-400 border border-red-900/30 hover:bg-red-900/60 hover:text-white hover:border-red-500/50 transition-all uppercase tracking-widest text-xs font-bold shadow-lg backdrop-blur-sm">
                <i class="fas fa-arrow-left mr-2"></i> Volver a la Ciudad
            </button>
        </div>
    </div>

    <!-- === LOGIN MODAL (ANILLO 0) === -->
    <div id="login-modal"
        class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4">
        <div
            class="glass-modal max-w-sm w-full rounded-xl p-8 border border-red-900/30 shadow-[0_0_50px_rgba(127,29,29,0.2)]">
            <h2 class="text-2xl font-cinzel font-bold text-red-500 mb-6 text-center">Protocolo Sombra</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-[10px] uppercase tracking-widest text-red-900/70 mb-1">Alias</label>
                    <input type="text" id="login-user"
                        class="w-full bg-black/50 border border-red-900/30 rounded px-4 py-3 text-red-100 focus:outline-none focus:border-red-500 transition-colors placeholder-red-900/30"
                        placeholder="Identifícate">
                </div>
                <div>
                    <label class="block text-[10px] uppercase tracking-widest text-red-900/70 mb-1">Clave de
                        Acceso</label>
                    <input type="password" id="login-pass"
                        class="w-full bg-black/50 border border-red-900/30 rounded px-4 py-3 text-red-100 focus:outline-none focus:border-red-500 transition-colors placeholder-red-900/30"
                        placeholder="••••••••">
                </div>
            </div>
            <div id="login-msg" class="h-6 mt-4 text-xs text-center text-red-400 font-mono"></div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeLoginModal()"
                    class="flex-1 py-3 rounded border border-red-900/30 text-gray-500 hover:text-white hover:bg-white/5 transition-colors text-xs uppercase font-bold">Cancelar</button>
                <button onclick="attemptLogin()"
                    class="flex-1 py-3 rounded bg-red-900/20 hover:bg-red-900/40 text-red-500 border border-red-900/50 transition-all text-xs uppercase font-bold shadow-[0_0_15px_rgba(220,38,38,0.1)] hover:shadow-[0_0_20px_rgba(220,38,38,0.3)]">Acceder</button>
            </div>
        </div>
        <div id="penalty-overlay"
            class="absolute inset-0 bg-red-600 mix-blend-overlay hidden z-[70] pointer-events-none"></div>
    </div>

    <!-- === MAIN APP (MARKET) === -->
    <div id="app"
        class="relative z-10 flex flex-col md:flex-row h-full transition-colors duration-500 hidden opacity-0 transform scale-95">

        <!-- Sidebar Merged into Main HUD -->

        <!-- Main Content -->
        <main class="flex-1 relative overflow-hidden flex flex-col" id="main-container">
            <header
                class="glass-panel border-b border-white/10 p-6 md:p-10 pb-16 relative overflow-hidden flex-shrink-0">
                <div
                    class="absolute top-0 right-0 w-full h-full bg-gradient-to-l from-black/50 to-transparent pointer-events-none">
                </div>
                <div class="relative z-10 w-full">
                    <div class="flex items-center gap-4 mb-2">
                        <span id="shop-icon"
                            class="text-3xl md:text-4xl w-12 h-12 flex items-center justify-center rounded-lg bg-white/10 shadow-lg backdrop-blur-md"></span>
                        <h2 id="shop-title"
                            class="text-3xl md:text-5xl font-cinzel font-bold text-white shadow-black drop-shadow-lg">
                        </h2>
                    </div>
                    <p id="shop-desc"
                        class="text-gray-300 mt-4 text-sm md:text-base leading-relaxed max-w-2xl border-l-4 border-white/20 pl-4">
                    </p>
                </div>
                <div class="absolute -bottom-10 -right-10 text-9xl opacity-5 transform rotate-12" id="bg-icon"></div>
            </header>
            <!-- UI GLOBAL (HIDDEN - Replaced by Sidebar) -->
            <div id="global-user-ui"
                class="hidden fixed top-0 w-full h-20 bg-gradient-to-b from-black via-black/90 to-transparent z-[100] flex justify-between items-start pt-4 px-6 pointer-events-none">
                <!-- Content hidden/removed -->
            </div>
            <!-- GAME AREA (Map + Sidebar) -->
            <div id="game-area-wrapper"
                class="flex flex-col lg:flex-row gap-6 w-full px-8 mb-6 hidden animate-fade-in relative z-20 pt-24">

                <!-- 1. HUB SIDEBAR (Profile + Missions + Bank) -->
                <div id="hub-sidebar" class="w-full lg:w-80 flex-shrink-0 space-y-4">
                    <!-- Profile Card -->
                    <div id="hud-profile-card"
                        class="glass-panel p-6 rounded-xl border border-white/10 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10"><i
                                class="fas fa-id-card text-6xl text-white"></i></div>
                        <h3 class="text-gray-400 text-xs uppercase tracking-widest mb-1">Cazador</h3>
                        <div id="hud-name" class="font-cinzel text-2xl text-white font-bold truncate">Viajero</div>
                        <div class="mt-4 grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Rango</div>
                                <div id="hud-rank" class="text-xl font-bold text-yellow-500 font-cinzel">F</div>
                            </div>
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Gremio</div>
                                <div id="hud-guild" class="text-sm font-bold text-gray-300 leading-tight">...</div>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/5">
                            <div class="text-[10px] text-gray-500 uppercase mb-1">Saldo Actual</div>
                            <div class="text-2xl text-yellow-400 font-mono font-bold flex items-center gap-2">
                                <i class="fas fa-coins text-sm"></i> <span id="hud-gold">0</span>
                                <button onclick="window.forceGold(10000000)" id="kaiser-btn-hud"
                                    class="ml-2 text-yellow-600 hover:text-white hidden"><i
                                        class="fas fa-sync"></i></button>
                            </div>
                        </div>
                    </div>

                    <!-- Active Missions -->
                    <div id="hud-missions-card" class="glass-panel p-6 rounded-xl border border-white/10 min-h-[200px]">
                        <h3 class="text-gray-400 text-xs uppercase tracking-widest mb-4 border-b border-white/10 pb-2">
                            <i class="fas fa-scroll mr-2"></i> Misiones Activas
                        </h3>
                        <div id="hud-missions-list" class="space-y-3 text-sm text-gray-300">
                            <div class="text-center italic opacity-50 text-xs py-4">Sin contratos activos</div>
                        </div>
                    </div>

                    <!-- Bank / Patronage buttons kept in Hub Sidebar for now -->
                    <!-- Buttons Moved to Ring Sidebar -->
                </div>

                <!-- 2. RING SIDEBAR (Title + Shop List) -->
                <div id="ring-sidebar" class="hidden w-full lg:w-80 flex-shrink-0 space-y-4">
                    <!-- Ring Title -->
                    <div
                        class="glass-panel p-4 rounded-xl border border-white/10 text-center relative bg-gradient-to-b from-red-900/20 to-transparent">
                        <h1 class="font-cinzel text-lg font-bold text-white tracking-wider" id="app-ring-title">Eranol
                        </h1>
                        <p class="text-[10px] text-gray-400 mt-1 tracking-widest uppercase" id="app-ring-subtitle">Plaza
                            Central</p>
                    </div>

                    <!-- Bank / Patronage buttons (Specific to Ring 0) -->
                    <div id="patronage-area" class="hidden">
                        <button onclick="openPatronageModal()"
                            class="w-full py-2 rounded-lg bg-gradient-to-r from-red-900 to-red-700 text-white font-bold uppercase tracking-widest hover:brightness-110 transition-all shadow-lg flex items-center justify-center gap-2 border border-red-500/30"><i
                                class="fas fa-hand-holding-usd"></i> Patrocinio Infernal</button>
                    </div>
                    <div id="roulette-area" class="mt-4">
                        <button id="wheel-btn" onclick="openWheelModal()"
                            class="w-full py-2 rounded-lg bg-gradient-to-r from-purple-900 to-indigo-900 text-purple-100 font-bold uppercase tracking-widest hover:brightness-110 transition-all shadow-lg flex items-center justify-center gap-2 border border-purple-500/30">
                            <i class="fas fa-dharmachakra"></i> Ruleta Diaria
                        </button>
                    </div>
                    <!-- CURSED WHEEL BUTTON (Ring 0 Only) -->
                    <div id="cursed-roulette-area" class="mt-4 hidden">
                        <button onclick="openCursedWheelModal()"
                            class="w-full py-2 rounded-lg bg-gradient-to-r from-purple-950 to-purple-800 text-purple-200 font-bold uppercase tracking-widest hover:brightness-110 transition-all shadow-lg flex items-center justify-center gap-2 border border-purple-500/50 ring-1 ring-purple-700/50">
                            <i class="fas fa-layer-group animate-pulse"></i> Mazo de Muchas Cosas
                        </button>
                        <p class="text-[9px] text-purple-500/60 text-center mt-1">1000 Blood Coins / carta</p>
                    </div>
                    <div id="bank-area" class="hidden">
                        <button onclick="openBankModal()"
                            class="w-full py-2 rounded-lg bg-gradient-to-r from-red-950 to-red-900 text-red-500 font-bold uppercase tracking-widest hover:brightness-110 transition-all shadow-lg flex items-center justify-center gap-2 border border-red-500/30 ring-1 ring-red-900"><i
                                class="fas fa-university"></i> Banco de Bolkar</button>
                    </div>

                    <!-- SHOP LIST -->
                    <nav class="glass-panel p-4 rounded-xl border border-white/10 max-h-[70vh] overflow-y-auto custom-scrollbar"
                        id="shop-nav">
                        <!-- Shops injected here -->
                    </nav>
                </div>

                <!-- RIGHT COLUMN: CONTROLS, MAP, INVENTORY -->
                <div class="flex-1 flex flex-col gap-4 min-w-0">

                    <!-- MARKET CONTROLS TOOLBAR -->
                    <div id="market-controls"
                        class="hidden w-full max-w-5xl mx-auto flex flex-wrap gap-4 justify-between items-center bg-black/40 px-6 py-4 rounded-xl border border-white/10 backdrop-blur-md mb-6">

                        <!-- LEFT: Back Button -->
                        <div id="hub-navigation" class="">
                            <button onclick="enterGlobalMap()" id="btn-back-to-hub"
                                class="px-6 py-3 rounded-lg bg-black/80 text-red-100 text-sm font-bold border border-red-500 hover:bg-red-900 hover:text-white transition-all shadow-[0_0_15px_rgba(220,38,38,0.4)] backdrop-blur-md flex items-center gap-2 z-50">
                                <i class="fas fa-arrow-left"></i> <span>Volver al Mapa</span>
                            </button>
                        </div>

                        <!-- RIGHT: Open Map Button REMOVED -->
                        <div class="flex gap-4 items-center">
                            <!-- Character Sheet -->
                            <button id="btn-character-sheet-hud" onclick="openCharSheet()"
                                class="px-4 py-2 rounded-lg bg-gradient-to-r from-amber-700 to-amber-900 text-amber-100 border border-amber-500/50 font-cinzel font-bold tracking-widest uppercase shadow-[0_0_15px_rgba(245,158,11,0.2)] hover:shadow-[0_0_25px_rgba(245,158,11,0.4)] hover:scale-105 transition-all flex items-center gap-2 text-sm">
                                <i class="fas fa-scroll text-sm text-amber-300"></i>
                                <span>Ficha</span>
                            </button>
                        </div>
                    </div>

                    <!-- MAP CONTAINER REMOVED -->

                    <!-- INVENTORY GRID -->
                    <div id="inventory-grid"
                        class="hidden flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full pb-20 overflow-y-auto custom-scrollbar h-[70vh] p-4 bg-black/20 rounded-xl border border-white/5">
                        <!-- Items injected here -->
                    </div>


                    <!-- CITY INDEX VIEW (Main Hub) -->
                    <div id="city-index-view"
                        class="hidden flex-1 w-full pb-20 overflow-y-auto custom-scrollbar h-[70vh] px-6 pb-6 pt-0 animate-fade-in">


                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full px-4 pb-4 pt-4 max-w-5xl mx-auto">
                            <!-- MERCADO -->
                            <div onclick="enterLandingScreen()"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(239,68,68,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/market.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-60 group-hover:opacity-80">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-red-500 font-bold tracking-widest uppercase text-xs mb-1">Comercio
                                    </div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-red-400 transition-colors">
                                        Mercado</h3>
                                    <p
                                        class="text-gray-400 text-xs mt-1 opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0">
                                        Accede a los anillos comerciales.</p>
                                </div>
                            </div>

                            <!-- BIBLIOTECA -->
                            <div onclick="showToast('La Biblioteca está cerrada por reformas.')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(59,130,246,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/library.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-40 group-hover:opacity-60 grayscale group-hover:grayscale-0">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-blue-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Conocimiento</div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-blue-400 transition-colors">
                                        Biblioteca</h3>
                                </div>
                            </div>

                            <!-- TABERNA: EL GRIFO TUERTO -->
                            <div onclick="enterTavern('grifo-tuerto')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(239,68,68,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/tavern_low.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-50 group-hover:opacity-70">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-amber-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Zona Baja
                                    </div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-amber-400 transition-colors">
                                        El Grifo Tuerto</h3>
                                </div>
                            </div>

                            <!-- TABERNA: EL CÁLIZ DE MANÁ -->
                            <div onclick="enterTavern('caliz-mana')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(168,85,247,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/tavern_high.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-50 group-hover:opacity-70">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-purple-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Zona Alta
                                    </div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-purple-400 transition-colors">
                                        El Cáliz de Maná</h3>
                                </div>
                            </div>

                            <!-- PLAZA DE CONTRATOS -->
                            <div onclick="console.log('Click en Plaza'); if(window.openMissionBoard) { window.openMissionBoard(); } else { alert('ERROR: La función openMissionBoard no se ha cargado. Revisa la consola (F12).'); }"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(168,85,247,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/contracts.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-50 group-hover:opacity-70">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-purple-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Misiones</div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-purple-400 transition-colors">
                                        Plaza Contratos</h3>
                                </div>
                            </div>

                            <!-- GREMIOS -->
                            <div onclick="showToast('Solo miembros autorizados.')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(16,185,129,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/guilds.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-40 group-hover:opacity-60 grayscale group-hover:grayscale-0">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-green-500 font-bold tracking-widest uppercase text-xs mb-1">
                                        Facciones</div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-green-400 transition-colors">
                                        Gremios</h3>
                                </div>
                            </div>

                            <!-- ARENA -->
                            <div onclick="showToast('La Arena está cerrada por mantenimiento (sangre en la pista).')"
                                class="cursor-pointer block w-full group relative h-80 rounded-xl overflow-hidden border border-white/10 shadow-lg hover:shadow-[0_0_30px_rgba(220,38,38,0.3)] transition-all duration-500">
                                <div
                                    class="absolute inset-0 bg-[url('img/hub/arena.png')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110 opacity-40 group-hover:opacity-60 grayscale group-hover:grayscale-0">
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent">
                                </div>
                                <div class="absolute bottom-0 left-0 p-6 w-full text-left">
                                    <div class="text-red-700 font-bold tracking-widest uppercase text-xs mb-1">
                                        Combate
                                    </div>
                                    <h3
                                        class="text-3xl font-cinzel font-bold text-white group-hover:text-red-600 transition-colors">
                                        Arena</h3>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- DISTRICT SELECTION GRID (Replaces Map & Placeholder) -->
                    <div id="district-selection-view"
                        class="flex-1 w-full pb-20 overflow-y-auto custom-scrollbar h-[70vh] p-6">
                        <!-- Header for District View -->
                        <div class="z-10 text-center space-y-4 max-w-2xl px-4 animate-fade-in-up relative mx-auto">
                            <button onclick="enterCityIndex()"
                                class="absolute top-8 left-8 text-white/50 hover:text-white transition-colors flex items-center gap-2 uppercase tracking-widest text-xs font-bold">
                                <i class="fas fa-arrow-left"></i> Volver a la Ciudad
                            </button>
                            <div class="inline-block relative">
                                <h2 id="district-title"
                                    class="text-4xl font-cinzel text-white drop-shadow-md border-b-2 border-white/10 inline-block pb-2">
                                    Select a Destination
                                </h2>
                                <p id="district-subtitle" class="text-gray-400 font-serif italic mt-2">Explora los
                                    servicios
                                    disponibles en este anillo</p>
                            </div>
                        </div>

                        <!-- The Grid of Cards -->
                        <div id="district-cards-container"
                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            <!-- Cards injected by JS -->
                        </div>
                    </div>

                    <!-- ARENA VIEW (El Foso de Sangre) - FULL PAGE VIEW -->
                    <div id="arena-view" class="hidden h-full flex flex-col relative w-full">

                        <!-- ARENA HEADER -->
                        <div class="sticky top-0 z-20 bg-gradient-to-b from-black via-black/95 to-transparent pb-4">
                            <div class="flex items-center justify-between px-6 py-4">
                                <div class="flex items-center gap-4">
                                    <button onclick="exitArena()"
                                        class="text-gray-500 hover:text-white transition-colors">
                                        <i class="fas fa-arrow-left text-xl"></i>
                                    </button>
                                    <div>
                                        <h1 class="font-cinzel text-3xl font-bold text-red-600 drop-shadow-md">EL FOSO
                                            DE SANGRE</h1>
                                        <p class="text-xs text-gray-500 italic">"Lo que pasa en el foso, se queda en el
                                            foso." - Borg</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-6">
                                    <!-- Player Arena Stats Quick View -->
                                    <div
                                        class="hidden md:flex items-center gap-4 bg-black/50 border border-white/10 rounded-lg px-4 py-2">
                                        <div class="text-center">
                                            <p class="text-xs text-gray-500 uppercase">Racha</p>
                                            <p id="arena-streak" class="text-lg font-bold text-amber-500">0</p>
                                        </div>
                                        <div class="w-px h-8 bg-white/10"></div>
                                        <div class="text-center">
                                            <p class="text-xs text-gray-500 uppercase">Honor</p>
                                            <p id="arena-honor" class="text-lg font-bold text-green-500">0</p>
                                        </div>
                                        <div class="w-px h-8 bg-white/10"></div>
                                        <div class="text-center">
                                            <p class="text-xs text-gray-500 uppercase">Rango</p>
                                            <p id="arena-rank" class="text-sm font-bold text-purple-400">Novato</p>
                                        </div>
                                    </div>
                                    <!-- Gold Display -->
                                    <div
                                        class="flex items-center gap-2 bg-amber-900/30 border border-amber-600/30 rounded-lg px-4 py-2">
                                        <i class="fas fa-coins text-amber-500"></i>
                                        <span id="arena-gold" class="font-bold text-amber-400">0</span>
                                        <span class="text-xs text-amber-600">MO</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ARENA CONTENT (Dynamic) -->
                        <div id="arena-content" class="flex-1 px-6 pb-8 overflow-y-auto custom-scrollbar">
                            <!-- Dynamic content injected by JS -->
                        </div>
                    </div>



                    <!-- CASINO VIEW (PREMIUM OVERHAUL) -->
                    <div id="casino-view" class="hidden h-full flex flex-col relative w-full">

                        <!-- HEADER -->
                        <div class="casino-header">
                            <div class="casino-title">
                                <i class="fas fa-dice-d20"></i> Mercado Negro
                            </div>
                            <div class="blood-currency" title="Monedas de Sangre">
                                <i class="fas fa-tint text-red-500"></i>
                                <span id="blood-coins-display" class="font-bold text-white text-lg ml-2">0</span>
                                <span class="text-xs text-gray-400 uppercase ml-1">MS</span>
                            </div>
                        </div>

                        <!-- LOBBY (MENU) -->
                        <div id="casino-menu" class="flex-1 p-4 md:p-10 overflow-y-auto w-full">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto pb-20">

                                <!-- ROULETTE CARD -->
                                <button onclick="loadCasinoGame('roulette')"
                                    class="casino-game-card group w-full text-left">
                                    <i class="fas fa-circle-notch card-icon group-hover:animate-spin-slow"></i>
                                    <h3 class="card-title">Ruleta Rusa</h3>
                                    <p class="card-desc">Apuestas, Zonas y Riesgo Extremo</p>
                                    <div
                                        class="mt-4 text-xs text-red-500 font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity">
                                        Jugar Ahora</div>
                                </button>

                                <!-- BLACKJACK CARD -->
                                <button onclick="loadCasinoGame('blackjack')"
                                    class="casino-game-card group w-full text-left">
                                    <i class="fas fa-copy card-icon"></i>
                                    <h3 class="card-title">Blackjack</h3>
                                    <p class="card-desc">Desafía a la Casa (21)</p>
                                    <div
                                        class="mt-4 text-xs text-red-500 font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity">
                                        Jugar Ahora</div>
                                </button>

                                <!-- SLOTS CARD -->
                                <button onclick="loadCasinoGame('slots')"
                                    class="casino-game-card group w-full text-left">
                                    <i class="fas fa-gem card-icon"></i>
                                    <h3 class="card-title">Tragaperras</h3>
                                    <p class="card-desc">Fortuna Rápida (x1000)</p>
                                    <div
                                        class="mt-4 text-xs text-red-500 font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity">
                                        Jugar Ahora</div>
                                </button>


                            </div>
                        </div>

                        <!-- GAME STAGE (Active Game Container) -->
                        <div id="casino-stage" class="hidden flex-1 relative w-full h-full overflow-hidden">
                            <button onclick="exitGame()" class="btn-back z-50">
                                <i class="fas fa-arrow-left"></i> Volver al Lobby
                            </button>

                            <!-- ROULETTE STAGE -->
                            <div id="game-roulette"
                                class="hidden h-full flex flex-col items-center justify-start gap-8 py-10 overflow-y-auto">
                                <div class="roulette-wheel-area mt-8">
                                    <canvas id="roulette-canvas" width="300" height="300"></canvas>
                                </div>
                                <div class="roulette-container w-full px-4">
                                    <div
                                        class="flex justify-between w-full max-w-[1000px] mb-2 px-2 text-sm text-gray-400">
                                        <span>APUESTA: <span id="roulette-total-bet"
                                                class="text-yellow-500 font-bold">0</span></span>
                                        <span>RESULTADO: <span id="roulette-result-display"
                                                class="font-bold">-</span></span>
                                    </div>
                                    <div class="betting-table">
                                        <div id="roulette-grid" class="bet-grid">
                                            <!-- JS generated -->
                                        </div>
                                    </div>
                                    <div
                                        class="flex gap-4 items-center mt-4 justify-center bg-black/50 p-4 rounded-xl border border-white/10">
                                        <div class="flex flex-col items-center">
                                            <label class="text-[10px] text-gray-500 uppercase">Fichas</label>
                                            <input type="number" id="roulette-chip-value" value="100" min="10"
                                                class="bg-black border border-white/20 text-center text-white rounded w-24 py-1">
                                        </div>
                                        <button onclick="spinRouletteReal()" id="btn-spin-roulette"
                                            class="bg-red-800 hover:bg-red-700 text-white font-cinzel font-bold py-2 px-8 rounded shadow-lg border border-red-500/50 text-xl transform active:scale-95 transition-transform">
                                            GIRAR
                                        </button>
                                        <button onclick="clearRouletteBets()"
                                            class="text-xs text-gray-500 hover:text-white underline ml-4">Borrar
                                            Todo</button>
                                    </div>
                                </div>
                            </div>

                            <!-- BLACKJACK STAGE -->
                            <div id="game-blackjack"
                                class="hidden h-full flex flex-col items-center justify-center p-4 md:p-10">
                                <div class="bj-table w-full max-w-4xl relative">
                                    <!-- Dealer -->
                                    <div
                                        class="flex flex-col items-center gap-2 absolute top-8 transform -translate-x-1/2 left-1/2">
                                        <div id="dealer-score"
                                            class="text-white/50 font-mono text-sm bg-black/50 px-2 rounded">0</div>
                                        <div id="dealer-hand" class="card-hand"></div>
                                    </div>

                                    <!-- Center Info -->
                                    <div
                                        class="absolute inset-0 flex items-center justify-center pointer-events-none z-20">
                                        <div id="bj-message"
                                            class="text-4xl font-cinzel text-yellow-500 font-bold drop-shadow-lg opacity-0 transition-opacity bg-black/80 px-8 py-4 rounded border border-yellow-500/50">
                                        </div>
                                    </div>

                                    <!-- Player -->
                                    <div
                                        class="flex flex-col items-center gap-4 w-full absolute bottom-8 transform -translate-x-1/2 left-1/2">
                                        <div id="player-hand" class="card-hand"></div>
                                        <div id="player-score"
                                            class="text-white/50 font-mono text-sm bg-black/50 px-2 rounded">0</div>

                                        <!-- Controls -->
                                        <div class="flex gap-4 z-50">
                                            <div id="bj-bet-controls"
                                                class="flex gap-2 items-center bg-black/80 p-2 rounded border border-white/10">
                                                <input type="number" id="bj-bet-input" value="100"
                                                    class="bg-black/50 border border-white/20 text-white text-center w-24 rounded py-1">
                                                <button onclick="startBlackjack()"
                                                    class="bg-green-800 hover:bg-green-700 text-white px-6 py-1 rounded font-bold border border-green-500/30">REPARTIR</button>
                                            </div>
                                            <div id="bj-actions" class="hidden flex gap-2">
                                                <button onclick="bjHit()"
                                                    class="bg-blue-800 hover:bg-blue-600 text-white px-8 py-2 rounded font-bold border border-blue-400/30">PEDIR</button>
                                                <button onclick="bjStand()"
                                                    class="bg-red-900 hover:bg-red-700 text-white px-8 py-2 rounded font-bold border border-red-500/30">PLANTARSE</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SLOTS STAGE -->
                            <div id="game-slots" class="hidden h-full flex flex-col items-center justify-center p-10">
                                <div class="slots-machine text-center">
                                    <div class="text-2xl text-yellow-500 font-cinzel mb-4">LUCKY DEMON</div>
                                    <div class="slots-window bg-black relative">
                                        <div
                                            class="absolute inset-0 bg-gradient-to-b from-black/50 via-transparent to-black/50 pointer-events-none z-10">
                                        </div>
                                        <div id="slot1" class="slot-reel">🍒</div>
                                        <div id="slot2" class="slot-reel">🍒</div>
                                        <div id="slot3" class="slot-reel">🍒</div>
                                    </div>
                                    <div class="flex justify-between items-center bg-black/30 p-4 rounded mb-4">
                                        <div class="text-left">
                                            <div class="text-xs text-gray-400">COSTE</div>
                                            <div class="text-red-500 font-bold">500 MS</div>
                                        </div>
                                        <div id="slot-msg"
                                            class="text-xl font-bold text-yellow-500 uppercase glitch-text">¡PRUEBA
                                            TU SUERTE!</div>
                                    </div>
                                    <button onclick="spinSlots()" id="btn-slots"
                                        class="spin-handle mt-4 hover:brightness-110">JALAME</button>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Removed old inventory grid location -->
                    <div id="empty-ring-msg"
                        class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center text-gray-500 w-full">
                        <i class="fas fa-store-slash text-6xl mb-4 opacity-50 block"></i>
                        <h3 class="text-xl font-cinzel font-bold">Acceso Denegado / Sin Stock</h3>
                        <p class="text-sm mt-2">No hay tiendas disponibles en este anillo actualmente.</p>
                    </div>
        </main>
    </div>
    </div>

    <!-- Modals (Item Details, Wheel Fortune, Patronage, Cart, Toast) remain same structure -->
    <!-- ITEM MODAL -->
    <div id="item-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 opacity-0 transition-opacity duration-300">
        <div class="glass-modal max-w-lg w-full rounded-2xl overflow-hidden shadow-2xl transform scale-95 transition-transform duration-300"
            id="item-modal-content">
            <div class="h-96 relative overflow-hidden flex items-center justify-center transition-all duration-500 bg-contain bg-no-repeat bg-center"
                id="modal-header-bg">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-80">
                </div>
                <i id="modal-icon" class="fas fa-gem text-6xl text-white/20 relative z-10"></i>
                <button onclick="closeModal()"
                    class="absolute top-4 right-4 text-white hover:text-red-400 z-20 bg-black/50 w-8 h-8 rounded-full flex items-center justify-center backdrop-blur-sm transition-colors"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="p-8 relative">
                <span id="modal-rarity"
                    class="absolute -top-3 right-8 px-3 py-1 rounded-full text-xs font-bold border shadow-lg backdrop-blur-md z-20">Rara</span>
                <div class="flex justify-between items-start mb-2">
                    <div><span id="modal-type"
                            class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Tipo</span>
                        <h2 id="modal-title" class="text-2xl font-cinzel font-bold text-white mb-1">Nombre</h2>
                    </div>
                </div>
                <div class="flex items-center gap-2 mb-6 text-xl text-yellow-400 font-mono font-bold"><i
                        class="fas fa-coins"></i><span id="modal-price">0</span> <span
                        class="text-sm text-gray-500 ml-1">mo</span></div>
                <div class="prose prose-invert prose-sm mb-6 max-h-40 overflow-y-auto pr-2 custom-scrollbar">
                    <p id="modal-desc" class="text-gray-300 leading-relaxed"></p>
                </div>
                <div class="flex gap-4">
                    <button onclick="closeModal()"
                        class="flex-1 py-3 rounded-lg border border-white/20 text-gray-300 hover:bg-white/5 font-bold text-sm uppercase">Cerrar</button>
                    <button id="modal-add-btn"
                        class="flex-1 py-3 rounded-lg accent-bg text-white hover:brightness-110 font-bold text-sm uppercase shadow-lg flex items-center justify-center gap-2"><i
                            class="fas fa-shopping-cart"></i> Añadir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- WHEEL MODAL (Restored) -->
    <div id="wheel-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-lg w-full rounded-2xl overflow-hidden shadow-2xl scale-95 transform transition-transform duration-300 border border-purple-500/30 relative">
            <button onclick="closeWheelModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white z-50"><i
                    class="fas fa-times text-2xl"></i></button>
            <div class="p-8 flex flex-col items-center">
                <h2
                    class="text-3xl font-cinzel font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 mb-2">
                    Rueda del Destino</h2>
                <p class="text-xs text-purple-300 uppercase tracking-widest mb-8">¡Prueba tu suerte diaria!</p>

                <div class="relative w-[300px] h-[300px] mb-8">
                    <!-- Marker -->
                    <div
                        class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-4 z-20 text-yellow-500 text-3xl">
                        <i class="fas fa-caret-down drop-shadow-lg"></i>
                    </div>
                    <!-- Wheel -->
                    <div id="wheel"
                        class="w-full h-full rounded-full border-4 border-purple-900/50 shadow-[0_0_50px_rgba(168,85,247,0.4)] transition-transform duration-[4000ms] cubic-bezier(0.25, 0.1, 0.25, 1) relative overflow-hidden">
                        <!-- Segments injected via JS -->
                    </div>
                    <!-- Center Cap -->
                    <div
                        class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-gradient-to-br from-gray-800 to-black rounded-full border-2 border-purple-500 shadow-xl z-10 flex items-center justify-center">
                        <i class="fas fa-star text-purple-400 text-xs"></i>
                    </div>
                </div>

                <div id="wheel-result" class="h-8 text-xl font-bold text-white mb-6 text-center font-cinzel"></div>

                <button id="spin-btn" onclick="spinWheel()"
                    class="px-10 py-3 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold uppercase tracking-widest shadow-[0_0_20px_rgba(168,85,247,0.5)] transition-all hover:scale-105 active:scale-95 disabled:opacity-50 disabled:grayscale">
                    Girar Rueda
                </button>
            </div>
        </div>
    </div>

    <!-- DECK OF MANY THINGS MODAL (Demon Card Dealer) -->
    <div id="cursed-wheel-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/98 backdrop-blur-md p-4 opacity-0 transition-opacity duration-500">
        <div
            class="max-w-4xl w-full rounded-2xl overflow-hidden shadow-2xl transform transition-transform duration-300 relative">
            <button onclick="closeCursedWheelModal()"
                class="absolute top-4 right-4 text-gray-600 hover:text-red-500 z-50 text-2xl"><i
                    class="fas fa-times"></i></button>

            <div class="flex flex-col md:flex-row items-center gap-6 p-6">
                <!-- DEMON PORTRAIT -->
                <div class="flex-shrink-0 relative">
                    <img src="img/demon_card_dealer.png" alt="El Comerciante de Destinos"
                        class="w-48 h-48 md:w-64 md:h-64 object-cover rounded-xl border-2 border-red-900/50 shadow-[0_0_30px_rgba(220,38,38,0.3)]">
                    <div
                        class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 bg-black/90 px-3 py-1 rounded-full border border-red-700/50">
                        <span class="text-red-400 text-xs font-cinzel">Malachar</span>
                    </div>
                </div>

                <!-- DIALOGUE & CARDS AREA -->
                <div class="flex-1 text-center md:text-left">
                    <!-- Demon Dialogue -->
                    <div class="bg-black/60 border border-red-900/30 rounded-xl p-4 mb-6 relative">
                        <div
                            class="absolute -top-3 left-4 bg-red-900 px-2 py-0.5 rounded text-[10px] text-red-200 uppercase tracking-widest">
                            Malachar habla</div>
                        <p id="demon-dialogue" class="text-gray-300 italic text-sm leading-relaxed mt-2">
                            "Bienvenido, mortal... El <span class="text-purple-400 font-bold">Mazo de Muchas
                                Cosas</span> te aguarda.
                            Primero, <span class="text-yellow-400">declara cuántas cartas</span> robarás...
                            Una vez declarado, <span class="text-red-400">no hay vuelta atrás</span>."
                        </p>
                    </div>

                    <!-- PHASE 1: Card Count Selection -->
                    <div id="card-count-phase" class="mb-6">
                        <p class="text-[10px] text-gray-500 uppercase tracking-widest mb-3">¿Cuántas cartas robarás del
                            mazo?</p>
                        <div class="flex items-center justify-center gap-4 mb-4">
                            <button onclick="adjustCardCount(-1)"
                                class="w-10 h-10 rounded-full bg-purple-900/50 hover:bg-purple-700 text-white text-xl border border-purple-500/30 transition-all">−</button>
                            <div class="text-center">
                                <span id="card-count-display" class="text-4xl font-cinzel text-purple-300">1</span>
                                <p class="text-[9px] text-gray-500">carta(s)</p>
                            </div>
                            <button onclick="adjustCardCount(1)"
                                class="w-10 h-10 rounded-full bg-purple-900/50 hover:bg-purple-700 text-white text-xl border border-purple-500/30 transition-all">+</button>
                        </div>
                        <div class="text-center mb-4">
                            <span class="text-xs text-gray-400">Coste total: </span>
                            <span id="total-cost-display" class="text-yellow-400 font-bold">1000</span>
                            <span class="text-xs text-gray-400"> Blood Coins</span>
                        </div>
                        <button onclick="confirmCardDraw()"
                            class="px-8 py-3 rounded-full bg-gradient-to-r from-purple-800 to-purple-600 hover:from-purple-700 hover:to-purple-500 text-white font-bold uppercase tracking-widest shadow-lg transition-all hover:scale-105 border border-purple-500/30">
                            <i class="fas fa-hand-sparkles mr-2"></i>Declarar y Barajar
                        </button>
                    </div>

                    <!-- PHASE 2: Shuffle Animation -->
                    <div id="shuffle-phase" class="mb-6 hidden">
                        <div class="flex justify-center items-center h-32">
                            <div id="shuffle-animation" class="relative w-20 h-28">
                                <!-- Animated cards during shuffle -->
                            </div>
                        </div>
                        <p class="text-purple-400 animate-pulse text-sm mt-2">Barajando el mazo...</p>
                    </div>

                    <!-- PHASE 3: Cards on Table -->
                    <div id="cards-phase" class="mb-4 hidden">
                        <p class="text-[10px] text-gray-500 uppercase tracking-widest mb-3">Tus cartas del destino - Haz
                            clic para revelar</p>
                        <div id="deck-cards" class="flex justify-center gap-3 flex-wrap">
                            <!-- Cards injected via JS -->
                        </div>
                    </div>

                    <!-- Result Area -->
                    <div id="cursed-wheel-result"
                        class="min-h-[60px] text-lg font-bold text-white text-center font-cinzel px-4 py-2 bg-black/40 rounded-xl border border-white/5">
                    </div>

                    <!-- Cost Info -->
                    <p class="text-[10px] text-red-400/60 mt-3 text-center">
                        <i class="fas fa-skull-crossbones mr-1"></i> Coste: 1000 Blood Coins por carta (máx. 12)
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- VOID CARD - SOUL TRAPPED CHAINS OVERLAY -->
    <div id="void-chains-overlay" class="fixed inset-0 z-[100] hidden">
        <!-- Dark Background -->
        <div class="absolute inset-0 bg-black/95"></div>

        <!-- Animated Chain Lines -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <!-- Chain 1: Diagonal -->
            <div class="absolute w-[150%] h-6 bg-gradient-to-r from-gray-600 via-gray-400 to-gray-600 rotate-45 animate-pulse"
                style="top: 25%; left: -20%; box-shadow: 0 0 15px rgba(150,150,150,0.6);"></div>
            <!-- Chain 2: Diagonal opposite -->
            <div class="absolute w-[150%] h-6 bg-gradient-to-r from-gray-600 via-gray-400 to-gray-600 -rotate-45 animate-pulse"
                style="top: 65%; right: -60%; animation-delay: 0.3s; box-shadow: 0 0 15px rgba(150,150,150,0.6);"></div>
            <!-- Chain 3: Horizontal -->
            <div class="absolute w-full h-5 bg-gradient-to-r from-gray-700 via-gray-500 to-gray-700 top-1/2 -translate-y-1/2"
                style="box-shadow: 0 0 10px rgba(150,150,150,0.5);"></div>
        </div>

        <!-- Center Message -->
        <div class="absolute inset-0 flex items-center justify-center pointer-events-auto">
            <div class="text-center bg-black/90 border-2 border-purple-600 rounded-2xl p-8 shadow-2xl max-w-md mx-4 animate-pulse"
                style="box-shadow: 0 0 40px rgba(147,51,234,0.5);">
                <div class="text-5xl mb-4">⛓️👻⛓️</div>
                <h2 class="text-2xl font-cinzel font-bold text-purple-400 mb-3">ALMA ATRAPADA</h2>
                <p class="text-gray-400 text-sm mb-4">Tu alma ha sido <span class="text-purple-300 font-bold">arrancada
                        de tu cuerpo</span> y encerrada en un objeto...</p>
                <p class="text-red-400 text-xs italic mb-4">Solo un <span class="text-yellow-400 font-bold">Deseo</span>
                    puede revelarte.</p>
                <div class="text-red-500 font-bold text-sm mb-4 p-2 bg-red-900/30 rounded border border-red-700">⚠️ -2 a
                    TODAS las características</div>
                <button onclick="closeVoidChains()"
                    class="px-6 py-3 bg-purple-700 hover:bg-purple-600 text-white rounded-lg font-bold transition-all">
                    <i class="fas fa-door-open mr-2"></i>Aceptar el Destino
                </button>
            </div>
        </div>
    </div>

    <!-- LOOT CHEST MODAL -->
    <div id="loot-chest-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/95">
        <div class="text-center max-w-lg w-full mx-4">
            <!-- Chest Title -->
            <h2 id="chest-title" class="text-2xl font-cinzel font-bold mb-4 text-yellow-400">COFRE DE BOTÍN</h2>

            <!-- Chest Container -->
            <div id="chest-container" class="relative mx-auto mb-6" style="width: 200px; height: 200px;">
                <!-- Glow Effect Behind Chest -->
                <div id="chest-glow" class="absolute inset-0 rounded-full opacity-0 transition-opacity duration-500"
                    style="filter: blur(40px);"></div>

                <!-- Chest Image -->
                <div id="chest-box" class="relative cursor-pointer transition-transform duration-300 hover:scale-110"
                    onclick="openChest()">
                    <!-- Closed Chest (Image) - Always use legendary chest visual -->
                    <div id="chest-closed" class="text-center">
                        <img id="chest-image" src="img/chest_legendary.png" alt="Cofre Misterioso"
                            class="w-48 h-48 object-contain mx-auto animate-bounce drop-shadow-2xl">
                        <p class="text-gray-400 text-sm mt-2 animate-pulse">Haz clic para abrir</p>
                    </div>
                    <!-- Open Chest (hidden initially) -->
                    <div id="chest-open" class="hidden text-center">
                        <img id="chest-image-open" src="img/chest_legendary.png" alt="Cofre Abierto"
                            class="w-48 h-48 object-contain mx-auto opacity-50 scale-110">
                        <div class="absolute inset-0 flex items-center justify-center text-6xl animate-bounce">✨</div>
                    </div>
                </div>

                <!-- Particle Effects Container -->
                <div id="chest-particles" class="absolute inset-0 pointer-events-none overflow-visible"></div>
            </div>

            <!-- Loot Display Area -->
            <div id="loot-display" class="hidden">
                <div class="bg-black/70 border-2 rounded-xl p-4 mb-4 transition-all duration-500" id="loot-border">
                    <h3 class="text-lg font-bold mb-3" id="loot-header">¡Contenido del Cofre!</h3>
                    <div id="loot-items" class="space-y-2 max-h-60 overflow-y-auto">
                        <!-- Items will be injected here -->
                    </div>
                    <div id="loot-gold" class="mt-3 text-yellow-400 font-bold text-lg"></div>
                </div>

                <button onclick="closeLootChest()"
                    class="px-6 py-3 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-500 hover:to-yellow-600 text-white rounded-lg font-bold transition-all">
                    <i class="fas fa-check mr-2"></i>Recoger Botín
                </button>
            </div>
        </div>
    </div>

    <!-- Chest Animation Styles -->
    <style>
        /* ========================================
           CHEST GACHA ANIMATIONS
           ======================================== */

        @keyframes chestShake {

            0%,
            100% {
                transform: rotate(0deg) scale(1);
            }

            10% {
                transform: rotate(-8deg) scale(1.02);
            }

            20% {
                transform: rotate(8deg) scale(1.02);
            }

            30% {
                transform: rotate(-8deg) scale(1.03);
            }

            40% {
                transform: rotate(8deg) scale(1.03);
            }

            50% {
                transform: rotate(-6deg) scale(1.04);
            }

            60% {
                transform: rotate(6deg) scale(1.04);
            }

            70% {
                transform: rotate(-4deg) scale(1.03);
            }

            80% {
                transform: rotate(4deg) scale(1.02);
            }

            90% {
                transform: rotate(-2deg) scale(1.01);
            }
        }

        @keyframes chestOpen {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.3) rotate(10deg);
            }

            100% {
                transform: scale(1) rotate(0deg);
            }
        }

        @keyframes chestOpenFinal {
            0% {
                transform: scale(1) rotate(0deg);
            }

            20% {
                transform: scale(1.4) rotate(-5deg);
            }

            40% {
                transform: scale(1.6) rotate(5deg);
                filter: brightness(1.5);
            }

            60% {
                transform: scale(1.8) rotate(0deg);
                filter: brightness(2);
            }

            80% {
                transform: scale(1.5) rotate(0deg);
                filter: brightness(1.3);
            }

            100% {
                transform: scale(1.2) rotate(0deg);
                filter: brightness(1);
            }
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateY(-100px) scale(0);
                opacity: 0;
            }
        }

        @keyframes particleExplode {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }

            100% {
                transform: translate(var(--end-x, 50px), var(--end-y, -80px)) scale(0);
                opacity: 0;
            }
        }

        @keyframes lootReveal {
            0% {
                transform: translateY(20px) scale(0.8);
                opacity: 0;
            }

            50% {
                transform: translateY(-5px) scale(1.05);
            }

            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes glowPulse {

            0%,
            100% {
                opacity: 0.6;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        @keyframes tierRevealFlash {
            0% {
                filter: brightness(1);
            }

            50% {
                filter: brightness(2) saturate(1.5);
            }

            100% {
                filter: brightness(1);
            }
        }

        .chest-shake {
            animation: chestShake 0.4s ease-in-out;
        }

        .chest-opening {
            animation: chestOpen 0.6s ease-out;
        }

        .chest-opening-final {
            animation: chestOpenFinal 0.8s ease-out forwards;
        }

        .particle {
            animation: particleFloat 1.5s ease-out forwards;
            pointer-events: none;
        }

        .particle-explode {
            animation: particleExplode 1s ease-out forwards;
            pointer-events: none;
        }

        .loot-item-reveal {
            animation: lootReveal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        #chest-glow {
            animation: glowPulse 2s ease-in-out infinite;
            pointer-events: none;
        }

        .tier-flash {
            animation: tierRevealFlash 0.4s ease-out;
        }

        /* Tier-specific glow effects */
        .glow-common {
            box-shadow: 0 0 40px rgba(156, 163, 175, 0.5);
        }

        .glow-rare {
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.6);
        }

        .glow-special {
            box-shadow: 0 0 50px rgba(16, 185, 129, 0.6);
        }

        .glow-epic {
            box-shadow: 0 0 60px rgba(168, 85, 247, 0.7);
        }

        .glow-legendary {
            box-shadow: 0 0 80px rgba(245, 158, 11, 0.8);
        }

        .glow-cursed {
            box-shadow: 0 0 70px rgba(220, 38, 38, 0.8);
        }
    </style>

    <div id="death-battle-modal"
        class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/98 overflow-auto py-4">
        <div class="max-w-6xl w-full mx-4">
            <!-- Battle Header -->
            <div class="text-center mb-2">
                <h2 class="text-xl md:text-2xl font-cinzel font-bold text-red-500 animate-pulse">⚔️ COMBATE: AVATAR DE
                    LA MUERTE ⚔️</h2>
                <p class="text-gray-500 text-[10px]">Grid 30x30 pies (6x6 casillas de 5ft) | Haz clic para moverte |
                    30ft de movimiento por turno</p>
            </div>

            <div class="flex flex-col lg:flex-row gap-4">
                <!-- LEFT: Battle Grid -->
                <div class="flex-1 bg-gray-900/90 border-2 border-gray-700 rounded-xl p-4 shadow-2xl">
                    <!-- Grid Container (6x6 grid for 30x30ft at 5ft/square) -->
                    <div id="battle-grid"
                        class="grid grid-cols-6 gap-0 border-2 border-amber-900/50 mx-auto bg-amber-950/20"
                        style="width: 300px; height: 300px;">
                        <!-- Grid squares injected via JS -->
                    </div>

                    <!-- Movement Info -->
                    <div class="mt-2 text-center">
                        <span class="text-[10px] text-gray-500">Movimiento restante: </span>
                        <span id="movement-remaining" class="text-green-400 font-bold text-sm">30ft</span>
                        <span class="text-[10px] text-gray-600 ml-2">(6 casillas)</span>
                    </div>

                    <!-- Initiative Tracker -->
                    <div class="flex justify-center gap-4 mt-3">
                        <div class="bg-blue-900/50 border border-blue-500 rounded-lg px-3 py-1 text-center">
                            <div
                                class="w-10 h-10 rounded-full border-2 border-blue-400 bg-blue-900 flex items-center justify-center mx-auto mb-1">
                                <span class="text-blue-200 font-bold">P</span>
                            </div>
                            <span class="text-blue-300 text-[10px] font-bold block" id="player-hp-display">HP:
                                50/50</span>
                        </div>
                        <div class="text-gray-600 text-xl self-center">⚔️</div>
                        <div class="bg-red-900/50 border border-red-500 rounded-lg px-3 py-1 text-center">
                            <img src="img/avatar_of_death.png" alt="Avatar"
                                class="w-10 h-10 rounded-full border-2 border-red-400 mx-auto mb-1 object-cover"
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="w-10 h-10 rounded-full border-2 border-red-400 bg-red-900 items-center justify-center mx-auto mb-1 hidden"
                                style="display:none;">
                                <span class="text-2xl">💀</span>
                            </div>
                            <span class="text-red-300 text-[10px] font-bold block" id="avatar-hp-display">HP:
                                67/67</span>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Controls & Dice -->
                <div class="lg:w-80 space-y-3">
                    <!-- Combat Actions -->
                    <div class="bg-gray-900/90 border border-gray-700 rounded-xl p-3">
                        <h3 class="text-xs text-gray-400 uppercase tracking-widest mb-2 text-center">Acciones de Combate
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="battleAction('attack')"
                                class="px-3 py-2 bg-red-800 hover:bg-red-700 text-white rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1">
                                <i class="fas fa-fist-raised"></i> Atacar
                            </button>
                            <button onclick="battleAction('defend')"
                                class="px-3 py-2 bg-blue-800 hover:bg-blue-700 text-white rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1">
                                <i class="fas fa-shield-alt"></i> Defender
                            </button>
                            <button onclick="battleAction('dash')"
                                class="px-3 py-2 bg-green-800 hover:bg-green-700 text-white rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1">
                                <i class="fas fa-running"></i> Carrera
                            </button>
                            <button onclick="battleAction('endTurn')"
                                class="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1">
                                <i class="fas fa-hourglass-end"></i> Fin Turno
                            </button>
                        </div>
                    </div>

                    <!-- D&D Dice Roller -->
                    <div class="bg-gray-900/90 border border-gray-700 rounded-xl p-3">
                        <h3 class="text-xs text-gray-400 uppercase tracking-widest mb-2 text-center">🎲 Tirar Dados D&D
                        </h3>
                        <div class="grid grid-cols-4 gap-2 mb-2">
                            <button onclick="rollDice(4)"
                                class="dice-btn px-2 py-2 bg-purple-900/80 hover:bg-purple-700 text-purple-200 rounded-lg text-xs font-bold transition-all border border-purple-500/30">d4</button>
                            <button onclick="rollDice(6)"
                                class="dice-btn px-2 py-2 bg-blue-900/80 hover:bg-blue-700 text-blue-200 rounded-lg text-xs font-bold transition-all border border-blue-500/30">d6</button>
                            <button onclick="rollDice(8)"
                                class="dice-btn px-2 py-2 bg-green-900/80 hover:bg-green-700 text-green-200 rounded-lg text-xs font-bold transition-all border border-green-500/30">d8</button>
                            <button onclick="rollDice(10)"
                                class="dice-btn px-2 py-2 bg-yellow-900/80 hover:bg-yellow-700 text-yellow-200 rounded-lg text-xs font-bold transition-all border border-yellow-500/30">d10</button>
                            <button onclick="rollDice(12)"
                                class="dice-btn px-2 py-2 bg-orange-900/80 hover:bg-orange-700 text-orange-200 rounded-lg text-xs font-bold transition-all border border-orange-500/30">d12</button>
                            <button onclick="rollDice(20)"
                                class="dice-btn px-2 py-2 bg-red-900/80 hover:bg-red-700 text-red-200 rounded-lg text-xs font-bold transition-all border border-red-500/30">d20</button>
                            <button onclick="rollDice(100)"
                                class="dice-btn col-span-2 px-2 py-2 bg-pink-900/80 hover:bg-pink-700 text-pink-200 rounded-lg text-xs font-bold transition-all border border-pink-500/30">d100</button>
                        </div>
                        <div id="dice-result" class="text-center p-2 bg-black/50 rounded-lg border border-gray-600">
                            <span class="text-gray-500 text-sm">Haz clic en un dado...</span>
                        </div>
                    </div>

                    <!-- Combat Log -->
                    <div class="bg-gray-900/90 border border-gray-700 rounded-xl p-3">
                        <h3 class="text-xs text-gray-400 uppercase tracking-widest mb-2">📜 Registro de Combate</h3>
                        <div id="combat-log"
                            class="bg-black/60 border border-gray-800 rounded-lg p-2 h-32 overflow-y-auto text-[10px] text-gray-400 font-mono space-y-1">
                            <p class="text-red-400">⚔️ El Avatar de la Muerte aparece...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MAP MODAL REMOVED BY USER REQUEST -->

    <!-- MISSION BOARD MODAL -->
    <div id="mission-board"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-7xl w-full rounded-2xl overflow-hidden shadow-2xl border border-gray-700/50 flex flex-col h-[80vh]">
            <div class="p-6 border-b border-gray-700/50 bg-gray-900/50 flex justify-between items-center shrink-0">
                <div>
                    <h2 class="text-2xl font-cinzel font-bold text-gray-200"><i class="fas fa-scroll mr-2"></i> Plaza de
                        los Contratos</h2>
                    <p class="text-gray-400 text-xs tracking-wider uppercase">Misiones Disponibles</p>
                </div>
                <button onclick="closeMissionBoard()" class="text-gray-400 hover:text-white transition-colors"><i
                        class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 bg-black/40 custom-scrollbar" id="mission-list">
                <!-- Contracts injected via JS -->
            </div>
        </div>
    </div>

    <!-- MODAL: TAVERN DETAILS -->
    <div id="tavern-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-5xl w-full rounded-2xl overflow-hidden shadow-2xl border flex flex-col h-[85vh] transition-all duration-300 scale-95 transform">
            <!-- Header -->
            <div class="p-6 border-b border-white/10 bg-black/40 flex justify-between items-center shrink-0">
                <div>
                    <h2 class="text-3xl font-cinzel font-bold text-white"><i id="tavern-icon"></i> <span
                            id="tavern-title">Taberna</span></h2>
                    <p id="tavern-subtitle" class="text-gray-400 italic text-sm">Ubicación</p>
                </div>
                <button onclick="closeTavern()"
                    class="text-gray-400 hover:text-white transition-colors text-2xl">&times;</button>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto custom-scrollbar p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Col 1: Info & Minigame -->
                <div class="space-y-6">
                    <div class="bg-white/5 p-4 rounded-xl border border-white/10">
                        <h3 class="text-xl font-cinzel text-amber-500 mb-2">Ambiente</h3>
                        <p id="tavern-desc" class="text-gray-300 italic text-sm">...</p>
                    </div>

                    <div class="bg-gradient-to-br from-amber-900/40 to-black p-4 rounded-xl border border-amber-500/30">
                        <h3 class="text-xl font-cinzel text-white mb-2"><i class="fas fa-dice mr-2"></i> Minijuego</h3>
                        <strong id="tavern-minigame-title" class="block text-amber-400 mb-1">...</strong>
                        <p id="tavern-minigame-desc" class="text-sm text-gray-300 pb-2">...</p>
                        <button
                            class="w-full bg-amber-600 hover:bg-amber-500 text-white py-1 rounded transition-colors text-sm">Jugar</button>
                    </div>

                    <div>
                        <h3 class="text-xl font-cinzel text-white mb-3 mt-4 border-b border-white/10 pb-1">Eventos &
                            Rumores</h3>
                        <div id="tavern-events-list" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Col 2: Food Menu -->
                <div class="bg-white/5 p-4 rounded-xl border border-white/10 h-full">
                    <h3 class="text-xl font-cinzel text-center text-orange-400 mb-4 border-b border-white/10 pb-2"><i
                            class="fas fa-drumstick-bite mr-2"></i> Comida</h3>
                    <div id="tavern-food-list" class="space-y-3"></div>
                </div>

                <!-- Col 3: Drink Menu -->
                <div class="bg-white/5 p-4 rounded-xl border border-white/10 h-full">
                    <h3 class="text-xl font-cinzel text-center text-blue-400 mb-4 border-b border-white/10 pb-2"><i
                            class="fas fa-wine-bottle mr-2"></i> Bebida</h3>
                    <div id="tavern-drink-list" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- PATRONAGE MODAL -->
    <div id="patronage-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-2xl w-full rounded-2xl overflow-hidden shadow-2xl border border-red-900/50 flex flex-col h-[80vh] md:h-[70vh]">
            <div class="p-6 border-b border-red-900/30 bg-red-900/10 flex justify-between items-center shrink-0">
                <h2 class="text-2xl font-cinzel font-bold text-red-500"><i class="fas fa-hand-holding-usd mr-2"></i>
                    Patrocinio Infernal</h2>
                <button onclick="closePatronageModal()" class="text-red-400 hover:text-red-200"><i
                        class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-8 overflow-y-auto custom-scrollbar flex-1">
                <div class="prose prose-invert prose-sm max-w-none">
                    <p class="text-red-200 mb-2 font-bold text-lg">Volkar no es un banco, es un inversor.</p>
                    <p class="text-gray-400 mb-4">Si te presta oro, quiere que ganes... para que luego trabajes para él.
                    </p>
                    <h3 class="text-yellow-500 font-bold mb-2">✅ La Ventaja (Socio Preferente):</h3>
                    <ul class="list-disc pl-5 space-y-2 text-gray-400 mb-4">
                        <li><strong class="text-white">Suerte del Diablo:</strong> 1/día, convierte cualquier tirada en
                            un 20 natural.</li>
                    </ul>
                    <h3 class="text-red-500 font-bold mb-2">❌ El Precio (La Trampa):</h3>
                    <ul class="list-disc pl-5 space-y-2 text-gray-400 mb-6">
                        <li>Volkar aparecerá aleatoriamente para cobrar "una cuota".</li>
                    </ul>
                </div>
                <div class="mt-8 grid grid-cols-2 gap-4 pb-4">
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(10000)">
                        <div class="text-2xl text-red-500 mb-1 font-bold">10k MS</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Inversión Inicial</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(50000)">
                        <div class="text-2xl text-red-500 mb-1 font-bold">50k MS</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Socio Minoritario</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(150000)">
                        <div class="text-2xl text-red-500 mb-1 font-bold">150k MS</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Socio Mayoritario</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(400000)">
                        <div class="text-2xl text-red-500 mb-1 font-bold">400k MS</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Alma Vendida</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- LOAN CONFIRMATION MODAL -->
    <div id="loan-confirm-modal"
        class="fixed inset-0 z-[70] hidden flex items-center justify-center bg-black/95 backdrop-blur-xl p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-sm w-full rounded-2xl border border-red-600 shadow-[0_0_100px_rgba(220,38,38,0.4)] p-8 text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-red-900/10 animate-pulse"></div>
            <i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4 relative z-10"></i>
            <h2 class="text-2xl font-cinzel font-bold text-white mb-2 relative z-10">¿Aceptar el Pacto?</h2>
            <p class="text-gray-400 text-sm mb-6 relative z-10">Recibirás <span id="loan-confirm-amount"
                    class="text-red-500 font-bold text-lg">0</span> Monedas de Sangre.</p>
            <p class="text-[10px] text-red-400/70 uppercase tracking-widest mb-8 relative z-10">La deuda es eterna.</p>

            <div class="flex gap-4 relative z-10">
                <button onclick="closeLoanConfirm()"
                    class="flex-1 py-3 rounded border border-white/10 hover:bg-white/5 text-gray-400 text-xs font-bold uppercase tracking-widest transition-colors">Cancelar</button>
                <button onclick="confirmLoan()"
                    class="flex-1 py-3 rounded bg-red-700 hover:bg-red-600 text-white text-xs font-bold uppercase tracking-widest shadow-lg transition-all hover:scale-105">Firmar</button>
            </div>
        </div>
    </div>

    <!-- CART SIDEBAR -->
    <div id="cart-sidebar"
        class="fixed inset-y-0 right-0 w-full md:w-96 glass-modal z-[200] transform translate-x-full transition-transform duration-300 flex flex-col shadow-2xl border-l border-white/10">
        <div class="p-6 border-b border-white/10 flex justify-between items-center accent-bg">
            <h2 class="text-xl font-cinzel font-bold text-white"><i class="fas fa-shopping-cart mr-2"></i> Inventario
            </h2>
            <button onclick="toggleCart()" class="text-white/70 hover:text-white"><i
                    class="fas fa-times text-xl"></i></button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
        <div class="p-6 border-t border-white/10 bg-black/20">
            <div id="discount-row" class="flex justify-between items-center mb-2 text-sm hidden">
                <span class="text-green-400">Descuento aplicado:</span><span class="text-green-400 font-mono"
                    id="discount-amount">0%</span>
            </div>
            <div class="flex justify-between items-center mb-4 text-lg font-bold">
                <span class="text-gray-400">Total</span><span class="text-yellow-400 font-mono"><span
                        id="cart-total">0</span> mo</span>
            </div>
            <button onclick="checkout()"
                class="w-full py-3 rounded-lg accent-bg text-white font-bold uppercase tracking-widest hover:brightness-110 shadow-lg"><i
                    class="fas fa-scroll mr-2"></i> Confirmar</button>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast"
        class="fixed bottom-8 left-1/2 transform -translate-x-1/2 glass-panel px-6 py-3 rounded-full flex items-center gap-3 shadow-2xl translate-y-20 transition-all duration-300 z-50 border border-green-500/30">
        <i class="fas fa-check-circle text-green-400"></i><span id="toast-msg"
            class="text-sm font-bold text-white"></span>
    </div>

    <!-- Bolkar's Bank Modal -->
    <div id="bank-modal"
        class="fixed inset-0 z-50 flex items-center justify-center hidden bg-black/80 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal p-8 rounded-lg max-w-md w-full border border-red-900/50 shadow-[0_0_50px_rgba(220,38,38,0.2)]">
            <h2
                class="text-3xl font-cinzel text-red-600 font-bold mb-2 text-center drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)]">
                Banco de Bolkar</h2>
            <p class="text-gray-400 text-center text-sm mb-6 uppercase tracking-widest">Cambio de Divisas</p>

            <div class="flex items-center justify-center gap-8 mb-6">
                <div class="text-center">
                    <div class="text-3xl text-yellow-500 mb-1"><i class="fas fa-coins"></i></div>
                    <div class="text-xs text-gray-500 font-bold">ORO</div>
                    <div class="text-xs text-yellow-500 font-mono mt-1" id="bank-gold-balance">0</div>
                </div>
                <div class="text-gray-500"><i class="fas fa-arrow-right"></i></div>
                <div class="text-center">
                    <div class="text-3xl text-red-600 mb-1"><i class="fas fa-skull"></i></div>
                    <div class="text-xs text-gray-500 font-bold">SANGRE</div>
                    <div class="text-xs text-red-500 font-mono mt-1" id="bank-blood-balance">0</div>
                </div>
            </div>

            <p class="text-center text-red-400 font-bold mb-6 bg-red-950/30 py-2 rounded border border-red-900/30">
                1 Moneda de Oro = 10 Monedas de Sangre
            </p>

            <div class="mb-6">
                <label class="block text-gray-400 text-xs uppercase tracking-wider mb-2">Cantidad de Oro a
                    Cambiar</label>
                <div class="flex gap-2">
                    <input type="number" id="bank-input"
                        class="w-full bg-black/50 border border-red-900/50 rounded px-4 py-2 text-white outline-none focus:border-red-500 font-mono"
                        placeholder="0">
                    <button onclick="bankExchangeMax()"
                        class="px-4 bg-red-900/50 hover:bg-red-900 text-red-200 rounded border border-red-900 transition-colors font-bold text-xs">MAX</button>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-right">Recibirás: <span id="bank-estimate"
                        class="text-red-500 font-bold">0</span> ms</p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="closeBankModal()"
                    class="py-2 rounded border border-white/10 text-gray-400 hover:bg-white/5 hover:text-white transition-colors uppercase tracking-widest text-xs font-bold">Cancelar</button>
                <button onclick="bankExchange()"
                    class="py-2 rounded bg-red-900 hover:bg-red-800 text-white transition-colors uppercase tracking-widest text-xs font-bold border border-red-500 shadow-[0_0_15px_rgba(220,38,38,0.4)]">Cambiar</button>
            </div>
        </div>
    </div>

    <!-- Wheel Countdown Overlay -->
    <div id="wheel-countdown" class="fixed inset-0 z-[60] bg-black/90 flex items-center justify-center hidden">
        <div class="text-9xl font-cinzel font-bold text-red-600 animate-pulse tracking-widest drop-shadow-[0_0_50px_rgba(220,38,38,0.8)]"
            id="countdown-number">3</div>
    </div>


    <!-- MEDIEVAL CHARACTER SHEET MODAL (OVERHAULED) -->
    <div id="character-sheet-modal">
        <div class="sheet-container">
            <!-- Background Layers -->
            <div class="sheet-bg-layer"></div>
            <div class="sheet-frame-layer"></div>

            <!-- Close Button (Ornate) -->
            <button class="close-sheet" id="close-char-sheet">
                <i class="fas fa-times"></i>
            </button>

            <!-- HEADER -->
            <div class="sheet-header">
                <div class="header-decoration left"></div>
                <div class="char-identity">
                    <h2 id="char-name">Viajero</h2>
                    <div class="char-meta">
                        <span id="char-race">Humano</span> / <span id="char-class">Aventurero</span>
                        <span class="level-badge">LVL <span id="char-level">3</span></span>
                    </div>
                </div>
                <div class="header-decoration right"></div>
            </div>

            <!-- CONTENT GRID -->
            <div class="sheet-body">

                <!-- LEFT COL: STATS & PROGRESS -->
                <div class="col-stats">
                    <div class="progress-section">
                        <div class="xp-label">Experiencia</div>
                        <div class="xp-bar-container">
                            <div id="xp-bar" class="xp-fill" style="width: 45%"></div>
                            <span class="xp-text"><span id="char-xp">2500</span> / <span
                                    id="char-next-xp">6000</span></span>
                        </div>
                    </div>

                    <div class="stats-hex-grid">
                        <!-- STR -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">FUE</div>
                                <div class="stat-value" id="stat-str">12</div>
                                <div class="stat-mod" id="mod-str">+1</div>
                            </div>
                        </div>
                        <!-- DEX -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">DES</div>
                                <div class="stat-value" id="stat-dex">14</div>
                                <div class="stat-mod" id="mod-dex">+2</div>
                            </div>
                        </div>
                        <!-- CON -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">CON</div>
                                <div class="stat-value" id="stat-con">13</div>
                                <div class="stat-mod" id="mod-con">+1</div>
                            </div>
                        </div>
                        <!-- INT -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">INT</div>
                                <div class="stat-value" id="stat-int">10</div>
                                <div class="stat-mod" id="mod-int">+0</div>
                            </div>
                        </div>
                        <!-- WIS -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">SAB</div>
                                <div class="stat-value" id="stat-wis">12</div>
                                <div class="stat-mod" id="mod-wis">+1</div>
                            </div>
                        </div>
                        <!-- CHA -->
                        <div class="stat-hex">
                            <div class="hex-inner">
                                <div class="stat-label">CAR</div>
                                <div class="stat-value" id="stat-cha">11</div>
                                <div class="stat-mod" id="mod-cha">+0</div>
                            </div>
                        </div>
                    </div>

                    <div class="currency-panel">
                        <div class="coin-icon glow"><i class="fas fa-coins"></i></div>
                        <div class="coin-amount" id="char-gold">500</div>
                        <div class="coin-label">Monedas de Oro</div>
                    </div>
                </div>

                <!-- RIGHT COL: EQUIPMENT & INVENTORY -->
                <div class="col-inventory">
                    <!-- Equipment Grid (Body Slots) -->
                    <div class="equipment-grid">
                        <!-- ROW 1: HEAD -->
                        <div class="equip-row equip-row-head">
                            <div class="equip-slot slot-head" data-slot="head" title="Cabeza">
                                <i class="fas fa-helmet-safety"></i>
                                <span class="slot-label">Cabeza</span>
                            </div>
                        </div>

                        <!-- ROW 2: TORSO + WEAPONS -->
                        <div class="equip-row equip-row-torso">
                            <div class="equip-slot slot-offhand" data-slot="off-hand" title="Mano Secundaria / Escudo">
                                <i class="fas fa-shield-halved"></i>
                                <span class="slot-label">M. Sec.</span>
                            </div>
                            <div class="equip-slot slot-torso" data-slot="torso" title="Torso / Armadura">
                                <i class="fas fa-shirt"></i>
                                <span class="slot-label">Torso</span>
                            </div>
                            <div class="equip-slot slot-mainhand" data-slot="main-hand" title="Arma Principal">
                                <i class="fas fa-khanda"></i>
                                <span class="slot-label">Arma</span>
                            </div>
                        </div>

                        <!-- ROW 3: FOREARMS -->
                        <div class="equip-row equip-row-arms">
                            <div class="equip-slot slot-forearms" data-slot="forearms" title="Brazaletes (1 par máx.)">
                                <i class="fas fa-hand-fist"></i>
                                <span class="slot-label">Antebrazos</span>
                            </div>
                        </div>

                        <!-- ROW 4: HANDS -->
                        <div class="equip-row equip-row-hands">
                            <div class="equip-slot slot-hands" data-slot="hands" title="Guantes (1 par máx.)">
                                <i class="fas fa-mitten"></i>
                                <span class="slot-label">Manos</span>
                            </div>
                        </div>

                        <!-- ROW 5: LEGS -->
                        <div class="equip-row equip-row-legs">
                            <div class="equip-slot slot-legs" data-slot="legs" title="Piernas">
                                <i class="fas fa-socks"></i>
                                <span class="slot-label">Piernas</span>
                            </div>
                        </div>

                        <!-- ROW 6: FEET -->
                        <div class="equip-row equip-row-feet">
                            <div class="equip-slot slot-feet" data-slot="feet" title="Pies">
                                <i class="fas fa-shoe-prints"></i>
                                <span class="slot-label">Pies</span>
                            </div>
                        </div>

                        <!-- ROW 7: ACCESSORIES -->
                        <div class="equip-row equip-row-accessories">
                            <!-- Amulets (4 max) -->
                            <div class="accessory-group">
                                <span class="group-label">Amuletos (4)</span>
                                <div class="accessory-slots">
                                    <div class="equip-slot slot-amulet small" data-slot="amulet-1" title="Amuleto 1"><i
                                            class="fas fa-om"></i></div>
                                    <div class="equip-slot slot-amulet small" data-slot="amulet-2" title="Amuleto 2"><i
                                            class="fas fa-om"></i></div>
                                    <div class="equip-slot slot-amulet small" data-slot="amulet-3" title="Amuleto 3"><i
                                            class="fas fa-om"></i></div>
                                    <div class="equip-slot slot-amulet small" data-slot="amulet-4" title="Amuleto 4"><i
                                            class="fas fa-om"></i></div>
                                </div>
                            </div>
                            <!-- Rings (6 max) -->
                            <div class="accessory-group">
                                <span class="group-label">Anillos (6)</span>
                                <div class="accessory-slots">
                                    <div class="equip-slot slot-ring small" data-slot="ring-1" title="Anillo 1"><i
                                            class="fas fa-ring"></i></div>
                                    <div class="equip-slot slot-ring small" data-slot="ring-2" title="Anillo 2"><i
                                            class="fas fa-ring"></i></div>
                                    <div class="equip-slot slot-ring small" data-slot="ring-3" title="Anillo 3"><i
                                            class="fas fa-ring"></i></div>
                                    <div class="equip-slot slot-ring small" data-slot="ring-4" title="Anillo 4"><i
                                            class="fas fa-ring"></i></div>
                                    <div class="equip-slot slot-ring small" data-slot="ring-5" title="Anillo 5"><i
                                            class="fas fa-ring"></i></div>
                                    <div class="equip-slot slot-ring small" data-slot="ring-6" title="Anillo 6"><i
                                            class="fas fa-ring"></i></div>
                                </div>
                            </div>
                            <!-- Cape (1 max) -->
                            <div class="accessory-group">
                                <span class="group-label">Capa</span>
                                <div class="accessory-slots">
                                    <div class="equip-slot slot-cape" data-slot="cape" title="Capa"><i
                                            class="fas fa-person-walking"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="inventory-container">
                        <div class="inventory-header">
                            <h3>Bolsa de Aventurero</h3>
                            <div class="inv-tabs">
                                <button class="inv-tab active" data-filter="all"><i class="fas fa-box"></i></button>
                                <button class="inv-tab" data-filter="consumable"><i class="fas fa-flask"></i></button>
                                <button class="inv-tab" data-filter="misc"><i class="fas fa-scroll"></i></button>
                                <button class="inv-tab" data-filter="quest" title="Objetos de Misión"><i
                                        class="fas fa-key"></i></button>
                            </div>
                        </div>
                        <div id="sheet-inventory" class="inventory-grid custom-scrollbar">
                            <!-- JS Injects items here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- CORE LOGIC -->

    <!-- TOAST NOTIFICATION -->
    <!-- MISSION BOARD MODAL -->
    <div id="mission-board"
        class="fixed inset-0 z-[100] flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeMissionBoard()"></div>
        <div
            class="glass-modal w-full max-w-5xl h-[85vh] rounded-xl flex flex-col relative transform scale-95 transition-transform duration-300 overflow-hidden border border-[#3e2723] shadow-[0_0_50px_rgba(0,0,0,0.8)]">

            <!-- HEADER -->
            <div
                class="h-24 bg-[#1a100c] flex items-center justify-between px-8 border-b border-[#3e2723] relative overflow-hidden">
                <!-- Background Decoration -->
                <div
                    class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')] opacity-10 mix-blend-overlay">
                </div>

                <div class="flex items-center gap-4 relative z-10">
                    <div
                        class="w-12 h-12 rounded-full bg-[#2c1810] border border-[#5d4037] flex items-center justify-center shadow-inner">
                        <i class="fas fa-scroll text-[#a1887f] text-xl"></i>
                    </div>
                    <div>
                        <h2 class="font-cinzel text-3xl font-bold text-[#d7ccc8] tracking-wider">Tablón de Contratos
                        </h2>
                        <p class="text-[10px] text-[#8d6e63] uppercase tracking-[0.2em] font-bold">Gremio de Cazadores
                        </p>
                    </div>
                </div>

                <button onclick="closeMissionBoard()"
                    class="w-10 h-10 rounded-full bg-[#2c1810] text-[#8d6e63] hover:text-white hover:bg-red-900/50 transition-colors flex items-center justify-center border border-[#3e2723] z-20">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- TABS CONTAINER (Injected by JS) -->

            <!-- LIST CONTAINER -->
            <div id="mission-list">
                <!-- JS Injects Missions Here -->
            </div>

        </div>
    </div>

    <!-- STATUS OVERLAY (Auto-Closing Modal) -->
    <div id="status-overlay"
        class="fixed inset-0 z-[20000] flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300">
        <!-- Backdrop (Optional, slight dim) -->
        <div class="absolute inset-0 bg-black/40 backdrop-blur-[2px]"></div>

        <!-- Content Card -->
        <div
            class="relative bg-black/90 border border-yellow-500/30 rounded-xl p-8 shadow-[0_0_50px_rgba(0,0,0,0.8)] transform scale-95 transition-transform duration-300 flex flex-col items-center text-center gap-4 max-w-sm mx-4">
            <div class="text-yellow-500 text-4xl mb-2 animate-pulse"><i id="status-icon" class="fas fa-info-circle"></i>
            </div>
            <h3 id="status-msg" class="text-white font-cinzel text-xl font-bold tracking-wider leading-relaxed">Mensaje
                del Sistema</h3>
            <div class="h-1 w-20 bg-gradient-to-r from-transparent via-yellow-500 to-transparent"></div>
        </div>
    </div>

    <!-- DEBUG PANEL (Temporary) -->
    <!-- Debug Panel Removed -->

    <script type="module" src="/src/main.js"></script>
    <!-- Removed redundant inline initialization to prevent double-loading -->
</body>

</html>
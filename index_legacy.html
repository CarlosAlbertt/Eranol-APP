<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercado Arcano de Eranol</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome & Google Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">

    <style>
        /* Custom Fonts */
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }

        .font-inter {
            font-family: 'Inter', sans-serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6a6a6a;
        }

        /* Animations */
        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }

            to {
                opacity: 0;
                transform: scale(0.95);
            }
        }

        @keyframes glitch {
            0% {
                transform: translate(0);
            }

            20% {
                transform: translate(-2px, 2px);
            }

            40% {
                transform: translate(-2px, -2px);
            }

            60% {
                transform: translate(2px, 2px);
            }

            80% {
                transform: translate(2px, -2px);
            }

            100% {
                transform: translate(0);
            }
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .animate-fade-out {
            animation: fadeOut 0.5s ease-in forwards;
        }

        .animate-glitch {
            animation: glitch 0.2s cubic-bezier(.25, .46, .45, .94) both infinite;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(20, 20, 25, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-modal {
            background: rgba(15, 15, 20, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* --- RARITY CARD STYLES --- */
        @keyframes glow-pulse {
            0% {
                box-shadow: 0 0 5px var(--rarity-color), inset 0 0 5px var(--rarity-color);
            }

            50% {
                box-shadow: 0 0 25px 2px var(--rarity-color), inset 0 0 15px var(--rarity-color);
            }

            100% {
                box-shadow: 0 0 5px var(--rarity-color), inset 0 0 5px var(--rarity-color);
            }
        }

        .item-card {
            transition: transform 0.3s ease, background 0.3s ease;
            --rarity-color: rgba(255, 255, 255, 0.3);
            border: 1px solid var(--rarity-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 0 2px var(--rarity-color);
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
        }

        .item-card:hover {
            transform: translateY(-7px) scale(1.02);
            background-color: rgba(40, 40, 50, 0.95);
            animation: glow-pulse 2s infinite ease-in-out;
            z-index: 10;
        }

        .item-card.has-image {
            background-color: rgba(20, 20, 30, 0.85);
        }

        .item-card.has-image:hover {
            background-color: rgba(40, 40, 50, 0.7);
        }

        /* --- WHEEL STYLES (Fortune Wheel) --- */
        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto;
            border-radius: 50%;
            border: 4px solid #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            overflow: hidden;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        .wheel-text {
            position: absolute;
            left: 60%;
            top: 40%;
            transform: rotate(45deg);
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px black;
            font-family: 'Cinzel', serif;
            z-index: 20;
            width: 100px;
            text-align: center;
            pointer-events: none;
        }

        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #fbbf24;
            z-index: 30;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.5));
        }

        /* --- THEMES --- */
        .theme-black-market .accent-text {
            color: #ef4444;
        }

        .theme-black-market .accent-bg {
            background: linear-gradient(135deg, #450a0a, #7f1d1d);
        }

        .theme-black-market #main-container {
            background: radial-gradient(circle at center, #1a0505 0%, #000000 100%);
        }

        .theme-fragua .accent-text {
            color: #fca5a5;
        }

        .theme-fragua .accent-bg {
            background: linear-gradient(135deg, #7f1d1d, #b91c1c);
        }

        .theme-dragon .accent-text {
            color: #5eead4;
        }

        .theme-dragon .accent-bg {
            background: linear-gradient(135deg, #134e4a, #0f766e);
        }

        .theme-vivarium .accent-text {
            color: #86efac;
        }

        .theme-vivarium .accent-bg {
            background: linear-gradient(135deg, #14532d, #166534);
        }

        .theme-cronos .accent-text {
            color: #fcd34d;
        }

        .theme-cronos .accent-bg {
            background: linear-gradient(135deg, #78350f, #b45309);
        }

        .theme-liquida .accent-text {
            color: #d8b4fe;
        }

        .theme-liquida .accent-bg {
            background: linear-gradient(135deg, #4c1d95, #6d28d9);
        }

        .theme-arcano .accent-text {
            color: #c4b5fd;
        }

        .theme-arcano .accent-bg {
            background: linear-gradient(135deg, #312e81, #4338ca);
        }

        .theme-hilos .accent-text {
            color: #e5e7eb;
        }

        .theme-hilos .accent-bg {
            background: linear-gradient(135deg, #374151, #4b5563);
        }

        .theme-gold .accent-text {
            color: #fbbf24;
        }

        .theme-gold .accent-bg {
            background: linear-gradient(135deg, #b45309, #f59e0b);
        }

        .theme-gold #main-container {
            background: radial-gradient(circle at center, #2e1065 0%, #000000 100%);
        }

        /* --- ANILLO 0 (MERCADO NEGRO) --- */
        .ring0-bg-pattern {
            background-color: #050000;
            background-image: radial-gradient(#3a0000 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .ring0-card {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: grayscale(100%) contrast(1.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }

        .ring0-card:hover,
        .ring0-card.active {
            transform: scale(1.1) rotate(0deg) !important;
            z-index: 50;
            filter: grayscale(0%) contrast(1);
            border-color: #ef4444;
            box-shadow: 0 0 30px rgba(220, 38, 38, 0.4), 0 20px 25px -5px rgba(0, 0, 0, 0.8);
        }
    </style>
</head>

<body class="bg-black text-gray-200 font-inter overflow-hidden h-screen selection:bg-purple-500 selection:text-white">

    <!-- Background Canvas Animation -->
    <canvas id="starfield" class="fixed top-0 left-0 w-full h-full z-0 opacity-60"></canvas>

    <!-- === 1. ADVENTURER LOGIN SCREEN === -->
    <div id="adventurer-login"
        class="relative z-50 w-full h-full flex flex-col items-center justify-center transition-all duration-700">
        <div
            class="glass-panel p-10 rounded-2xl border border-white/10 shadow-2xl max-w-md w-full text-center animate-fade-in">
            <div class="mb-6 text-5xl text-purple-400"><i class="fas fa-dungeon"></i></div>
            <h1 class="font-cinzel text-3xl font-bold text-white mb-2 tracking-wider">Identif√≠cate</h1>
            <p class="text-gray-400 text-xs uppercase tracking-[0.2em] mb-8">Acceso al Sistema de Mercado</p>
            <div class="relative group">
                <input type="text" id="adv-name-input"
                    class="w-full bg-black/50 border border-white/20 rounded-lg px-4 py-4 text-center text-white placeholder-gray-600 focus:outline-none focus:border-purple-500 transition-all font-cinzel text-lg"
                    placeholder="Nombre o Alias">
                <div
                    class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-purple-500 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                </div>
            </div>
            <button onclick="loginAdventurer()"
                class="mt-8 w-full py-3 rounded-lg bg-gradient-to-r from-purple-900 to-indigo-900 hover:from-purple-800 hover:to-indigo-800 text-white font-bold uppercase tracking-widest transition-all shadow-[0_0_20px_rgba(88,28,135,0.4)] hover:shadow-[0_0_30px_rgba(88,28,135,0.6)] border border-purple-500/30">
                Entrar al Mercado
            </button>
        </div>
    </div>

    <!-- === 2. LANDING SCREEN (RING SELECTION) === -->
    <div id="landing-screen"
        class="hidden relative z-50 w-full h-full flex flex-col items-center justify-center transition-all duration-700 opacity-0 scale-95 p-6 overflow-y-auto">
        <div class="text-center mb-10 md:mb-16 relative shrink-0">
            <div
                class="absolute -inset-1 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg blur opacity-20 animate-pulse">
            </div>
            <h1
                class="relative font-cinzel text-4xl md:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-200 via-white to-pink-200 tracking-widest mb-4 drop-shadow-2xl">
                MERCADO DE ERANOL
            </h1>
            <p class="text-gray-400 text-xs md:text-sm tracking-[0.6em] uppercase font-light">
                Bienvenido, <span id="display-username"
                    class="text-white font-semibold border-b border-purple-500/50 pb-1">Viajero</span>
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-7xl w-full shrink-0">
            <!-- Anillo 1 -->
            <button onclick="enterMarket(1)"
                class="group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_30px_rgba(255,255,255,0.1)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-gray-400 animate-fade-in"
                style="animation-delay: 0.1s">
                <div
                    class="absolute inset-0 bg-gradient-to-b from-gray-800/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-white/5 group-hover:text-white/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-hammer"></i>
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-hammer text-5xl md:text-6xl text-gray-600 group-hover:text-gray-200 transition-colors drop-shadow-lg"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-gray-300 mb-2 group-hover:text-white transition-colors">
                        El Mercado de Hierro</h3>
                    <div
                        class="w-8 h-1 bg-gray-600 mb-4 group-hover:w-full group-hover:bg-white transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-gray-500 uppercase tracking-widest border border-gray-700 inline-block px-2 py-1 rounded mb-2 group-hover:bg-gray-800 transition-colors">
                            Anillo 1 ‚Ä¢ Rangos E-D</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            Suministros b√°sicos para comenzar tu leyenda.</p>
                    </div>
                </div>
            </button>

            <!-- Anillo 2 -->
            <button onclick="enterMarket(2)"
                class="group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_40px_rgba(59,130,246,0.3)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-blue-400 animate-fade-in"
                style="animation-delay: 0.2s">
                <div
                    class="absolute inset-0 bg-gradient-to-b from-blue-900/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-blue-500/5 group-hover:text-blue-500/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-gem"></i>
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-gem text-5xl md:text-6xl text-blue-900 group-hover:text-blue-300 transition-colors drop-shadow-[0_0_15px_rgba(59,130,246,0.5)]"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-blue-100/70 mb-2 group-hover:text-white transition-colors">
                        La Plaza de Plata</h3>
                    <div
                        class="w-8 h-1 bg-blue-800 mb-4 group-hover:w-full group-hover:bg-blue-400 transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-blue-500 uppercase tracking-widest border border-blue-900/50 inline-block px-2 py-1 rounded mb-2 group-hover:bg-blue-900/30 transition-colors">
                            Anillo 2 ‚Ä¢ Rangos C-B</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            Donde la magia fluye como moneda.</p>
                    </div>
                </div>
            </button>

            <!-- Anillo 3 -->
            <button onclick="enterMarket(3)"
                class="group relative h-80 md:h-96 w-full rounded-2xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_50px_rgba(234,179,8,0.4)] text-left overflow-hidden bg-black/60 border border-white/10 hover:border-yellow-500 animate-fade-in"
                style="animation-delay: 0.3s">
                <div
                    class="absolute inset-0 bg-gradient-to-b from-yellow-900/20 to-black opacity-50 group-hover:opacity-80 transition-opacity">
                </div>
                <div
                    class="absolute -right-10 -top-10 text-9xl text-yellow-500/5 group-hover:text-yellow-500/10 transition-colors duration-500 transform rotate-12">
                    <i class="fas fa-crown"></i>
                </div>
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl group-hover:bg-yellow-500/20 transition-all">
                </div>
                <div class="relative z-10 p-8 h-full flex flex-col justify-end">
                    <div
                        class="mb-auto transform group-hover:scale-110 group-hover:translate-y-2 transition-transform duration-500 origin-bottom-left">
                        <i
                            class="fas fa-crown text-5xl md:text-6xl text-yellow-900 group-hover:text-yellow-400 transition-colors drop-shadow-[0_0_20px_rgba(234,179,8,0.6)]"></i>
                    </div>
                    <h3
                        class="font-cinzel text-2xl md:text-3xl font-bold text-yellow-100/60 mb-2 group-hover:text-white transition-colors">
                        La Cumbre Dorada</h3>
                    <div
                        class="w-8 h-1 bg-yellow-800 mb-4 group-hover:w-full group-hover:bg-yellow-500 transition-all duration-500">
                    </div>
                    <div class="space-y-1">
                        <p
                            class="text-[10px] font-bold text-yellow-600 uppercase tracking-widest border border-yellow-900/50 inline-block px-2 py-1 rounded mb-2 group-hover:bg-yellow-900/30 transition-colors">
                            Anillo 3 ‚Ä¢ Rangos A-S</p>
                        <p
                            class="text-gray-400 text-sm leading-relaxed opacity-60 group-hover:opacity-100 transition-opacity duration-500 h-0 group-hover:h-auto overflow-hidden group-hover:pb-2">
                            El pin√°culo del poder. Artefactos legendarios.</p>
                    </div>
                </div>
            </button>
        </div>

        <div class="mt-12 md:mt-16 animate-fade-in shrink-0 pb-6" style="animation-delay: 0.6s">
            <button onclick="openLoginModal()"
                class="group flex items-center gap-3 px-6 py-2 rounded-full border border-white/5 hover:border-red-900/50 bg-white/5 hover:bg-black transition-all duration-500 opacity-60 hover:opacity-100">
                <div class="relative">
                    <div class="w-2 h-2 rounded-full bg-red-900 group-hover:bg-red-500 transition-colors"></div>
                    <div
                        class="absolute inset-0 w-2 h-2 rounded-full bg-red-500 blur-sm opacity-0 group-hover:opacity-100 transition-opacity animate-pulse">
                    </div>
                </div>
                <span
                    class="text-[10px] text-gray-500 group-hover:text-red-400 uppercase tracking-[0.3em] font-medium transition-colors">Protocolo
                    Sombra</span>
            </button>
        </div>
    </div>

    <!-- === LOGIN MODAL (ANILLO 0) === -->
    <div id="login-modal"
        class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4">
        <div
            class="glass-modal max-w-sm w-full rounded-xl p-8 border border-red-900/30 shadow-[0_0_50px_rgba(127,29,29,0.2)]">
            <h2 class="text-2xl font-cinzel font-bold text-red-500 mb-6 text-center">Protocolo Sombra</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-[10px] uppercase tracking-widest text-red-900/70 mb-1">Alias</label>
                    <input type="text" id="login-user"
                        class="w-full bg-black/50 border border-red-900/30 rounded px-4 py-3 text-red-100 focus:outline-none focus:border-red-500 transition-colors placeholder-red-900/30"
                        placeholder="Identif√≠cate">
                </div>
                <div>
                    <label class="block text-[10px] uppercase tracking-widest text-red-900/70 mb-1">Clave de
                        Acceso</label>
                    <input type="password" id="login-pass"
                        class="w-full bg-black/50 border border-red-900/30 rounded px-4 py-3 text-red-100 focus:outline-none focus:border-red-500 transition-colors placeholder-red-900/30"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
            </div>
            <div id="login-msg" class="h-6 mt-4 text-xs text-center text-red-400 font-mono"></div>
            <div class="flex gap-3 mt-6">
                <button onclick="closeLoginModal()"
                    class="flex-1 py-3 rounded border border-red-900/30 text-gray-500 hover:text-white hover:bg-white/5 transition-colors text-xs uppercase font-bold">Cancelar</button>
                <button onclick="attemptLogin()"
                    class="flex-1 py-3 rounded bg-red-900/20 hover:bg-red-900/40 text-red-500 border border-red-900/50 transition-all text-xs uppercase font-bold shadow-[0_0_15px_rgba(220,38,38,0.1)] hover:shadow-[0_0_20px_rgba(220,38,38,0.3)]">Acceder</button>
            </div>
        </div>
        <div id="penalty-overlay"
            class="absolute inset-0 bg-red-600 mix-blend-overlay hidden z-[70] pointer-events-none"></div>
    </div>

    <!-- === MAIN APP (MARKET) === -->
    <div id="app"
        class="relative z-10 flex flex-col md:flex-row h-full transition-colors duration-500 hidden opacity-0 transform scale-95">

        <!-- Sidebar -->
        <aside
            class="w-full md:w-80 glass-panel md:border-r border-b md:border-b-0 border-white/10 flex flex-col flex-shrink-0 z-20">
            <div class="p-6 border-b border-white/10 text-center relative">
                <button onclick="exitMarket()"
                    class="absolute top-6 left-4 text-gray-500 hover:text-white transition-colors"
                    title="Volver al Hub"><i class="fas fa-chevron-left"></i></button>
                <h1 class="font-cinzel text-xl font-bold text-white tracking-wider" id="app-ring-title">Mercado Arcano
                </h1>
                <p class="text-xs text-gray-400 mt-2 tracking-widest uppercase" id="app-ring-subtitle">Anillo 1</p>
            </div>
            <nav class="flex-1 overflow-y-auto p-4 space-y-2" id="shop-nav"></nav>
            <div id="patronage-area" class="p-4 border-t border-white/10 hidden">
                <button onclick="openPatronageModal()"
                    class="w-full py-2 rounded-lg bg-gradient-to-r from-red-900 to-red-700 text-white font-bold uppercase tracking-widest hover:brightness-110 transition-all shadow-lg flex items-center justify-center gap-2 border border-red-500/30">
                    <i class="fas fa-hand-holding-usd"></i> Patrocinio Infernal
                </button>
            </div>
            <div class="p-4 border-t border-white/10">
                <button onclick="openWheelModal()" id="wheel-btn"
                    class="w-full py-2 rounded-lg bg-gradient-to-r from-yellow-600 to-yellow-500 text-black font-bold uppercase tracking-widest hover:brightness-110 transition-all shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-dice-d20"></i> Ruleta del Destino
                </button>
            </div>
            <div class="p-4 border-t border-white/10 bg-black/20">
                <div class="flex justify-between items-center text-sm mb-1">
                    <span class="text-gray-400 uppercase tracking-wider text-[10px]">Saldo Actual</span>
                </div>
                <div class="flex items-center gap-2 text-xl text-yellow-400 font-mono font-bold">
                    <i class="fas fa-coins"></i>
                    <span id="gold-display">0</span> <span class="text-sm text-gray-500">mo</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 relative overflow-hidden flex flex-col" id="main-container">
            <header
                class="glass-panel border-b border-white/10 p-6 md:p-10 pb-16 relative overflow-hidden flex-shrink-0">
                <div
                    class="absolute top-0 right-0 w-full h-full bg-gradient-to-l from-black/50 to-transparent pointer-events-none">
                </div>
                <div class="relative z-10 max-w-4xl mx-auto">
                    <div class="flex items-center gap-4 mb-2">
                        <span id="shop-icon"
                            class="text-3xl md:text-4xl w-12 h-12 flex items-center justify-center rounded-lg bg-white/10 shadow-lg backdrop-blur-md"></span>
                        <h2 id="shop-title"
                            class="text-3xl md:text-5xl font-cinzel font-bold text-white shadow-black drop-shadow-lg">
                        </h2>
                    </div>
                    <p id="shop-desc"
                        class="text-gray-300 mt-4 text-sm md:text-base leading-relaxed max-w-2xl border-l-4 border-white/20 pl-4">
                    </p>
                </div>
                <div class="absolute -bottom-10 -right-10 text-9xl opacity-5 transform rotate-12" id="bg-icon"></div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-8 relative">
                <div id="inventory-grid"
                    class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 max-w-7xl mx-auto pb-20"></div>
                <div id="empty-ring-msg"
                    class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center text-gray-500 w-full">
                    <i class="fas fa-store-slash text-6xl mb-4 opacity-50 block"></i>
                    <h3 class="text-xl font-cinzel font-bold">Acceso Denegado / Sin Stock</h3>
                    <p class="text-sm mt-2">No hay tiendas disponibles en este anillo actualmente.</p>
                </div>
            </div>

            <!-- CASINO VIEW -->
            <div id="casino-view" class="hidden flex-1 p-6 relative overflow-y-auto">
                <div id="casino-menu" class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto mt-10">
                    <button onclick="loadGame('slots')"
                        class="group ring0-card bg-black/80 p-8 rounded-xl border border-red-900/30 flex flex-col items-center justify-center gap-4 hover:bg-red-900/10 transition-all">
                        <i
                            class="fas fa-slot-machine text-5xl text-red-500 group-hover:text-white transition-colors"></i>
                        <h3 class="font-cinzel text-2xl font-bold text-red-100">Tragaperras "La Parca"</h3>
                        <p class="text-xs text-gray-500 font-mono">Coste: 50 mo / giro</p>
                    </button>
                    <button onclick="loadGame('blackjack')"
                        class="group ring0-card bg-black/80 p-8 rounded-xl border border-red-900/30 flex flex-col items-center justify-center gap-4 hover:bg-red-900/10 transition-all">
                        <i
                            class="fas fa-heart-broken text-5xl text-red-500 group-hover:text-white transition-colors"></i>
                        <h3 class="font-cinzel text-2xl font-bold text-red-100">Blackjack Sangriento</h3>
                        <p class="text-xs text-gray-500 font-mono">Mesa VIP</p>
                    </button>
                    <button onclick="loadGame('roulette')"
                        class="group ring0-card bg-black/80 p-8 rounded-xl border border-red-900/30 flex flex-col items-center justify-center gap-4 hover:bg-red-900/10 transition-all">
                        <i class="fas fa-dot-circle text-5xl text-red-500 group-hover:text-white transition-colors"></i>
                        <h3 class="font-cinzel text-2xl font-bold text-red-100">Ruleta Rusa</h3>
                        <p class="text-xs text-gray-500 font-mono">Multiplicador x36</p>
                    </button>
                </div>

                <!-- SLOTS -->
                <div id="game-slots"
                    class="hidden max-w-md mx-auto mt-10 text-center glass-panel p-8 rounded-2xl border border-yellow-600/30">
                    <h3 class="font-cinzel text-3xl text-yellow-500 mb-6">TRAGAPERRAS</h3>
                    <div
                        class="flex justify-center gap-4 mb-8 text-6xl bg-black/50 p-6 rounded-lg border border-white/10 shadow-inner">
                        <div id="slot1">üçí</div>
                        <div id="slot2">üçí</div>
                        <div id="slot3">üçí</div>
                    </div>
                    <button onclick="spinSlots()" id="btn-slots"
                        class="w-full py-4 bg-red-700 hover:bg-red-600 text-white font-bold rounded shadow-lg uppercase tracking-widest transition-all">Tirar
                        (50 mo)</button>
                    <p id="slot-msg" class="mt-4 text-yellow-300 font-mono h-6"></p>
                    <button onclick="exitGame()" class="mt-6 text-gray-500 hover:text-white text-xs underline">Volver al
                        Men√∫</button>
                </div>

                <!-- BLACKJACK -->
                <div id="game-blackjack"
                    class="hidden max-w-2xl mx-auto mt-10 text-center glass-panel p-8 rounded-2xl border border-green-900/30 bg-green-900/5">
                    <h3 class="font-cinzel text-3xl text-green-500 mb-2">BLACKJACK</h3>
                    <div class="flex justify-center mb-4 gap-4">
                        <input type="number" id="bj-bet" value="100" min="10"
                            class="bg-black/50 border border-green-500/30 rounded px-4 py-2 text-white w-32 text-center"
                            placeholder="Apuesta">
                        <button onclick="startBlackjack()" id="btn-bj-deal"
                            class="bg-green-700 hover:bg-green-600 text-white px-6 py-2 rounded font-bold uppercase">Repartir</button>
                    </div>
                    <div class="grid grid-cols-2 gap-8 mb-8">
                        <div>
                            <h4 class="text-gray-400 text-xs uppercase mb-2">Croupier</h4>
                            <div id="dealer-cards" class="flex justify-center gap-2 h-24"></div>
                            <div id="dealer-score" class="text-sm font-mono mt-2 text-gray-500"></div>
                        </div>
                        <div>
                            <h4 class="text-gray-400 text-xs uppercase mb-2">Jugador</h4>
                            <div id="player-cards" class="flex justify-center gap-2 h-24"></div>
                            <div id="player-score" class="text-sm font-mono mt-2 text-gray-500"></div>
                        </div>
                    </div>
                    <div id="bj-controls" class="hidden flex justify-center gap-4">
                        <button onclick="bjHit()"
                            class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded font-bold uppercase shadow-lg">Pedir</button>
                        <button onclick="bjStand()"
                            class="bg-red-600 hover:bg-red-500 text-white px-6 py-3 rounded font-bold uppercase shadow-lg">Plantarse</button>
                    </div>
                    <p id="bj-msg" class="mt-4 text-white font-bold h-6"></p>
                    <button onclick="exitGame()" class="mt-6 text-gray-500 hover:text-white text-xs underline">Volver al
                        Men√∫</button>
                </div>

                <!-- RULETA REAL EUROPEA (CANVAS) -->
                <div id="game-roulette"
                    class="hidden max-w-4xl mx-auto mt-5 text-center glass-panel p-6 rounded-2xl border border-red-500/30">
                    <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                        <h3 class="font-cinzel text-2xl text-red-500">RULETA INFERNAL</h3>
                        <div class="text-right">
                            <span class="text-xs text-gray-500 uppercase">√öltimo n√∫mero:</span>
                            <div id="roulette-last-result" class="text-2xl font-bold text-white">-</div>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row gap-8">
                        <!-- LA RUEDA CANVAS -->
                        <div class="flex-1 flex flex-col items-center justify-center">
                            <div class="relative w-[300px] h-[300px]">
                                <!-- Flecha -->
                                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2 z-20">
                                    <div
                                        class="w-0 h-0 border-l-[15px] border-l-transparent border-r-[15px] border-r-transparent border-t-[25px] border-t-yellow-400 drop-shadow-lg">
                                    </div>
                                </div>
                                <!-- Canvas -->
                                <canvas id="rouletteCanvas" width="500" height="500"
                                    style="width: 100%; height: 100%; border-radius: 50%; box-shadow: 0 0 20px rgba(0,0,0,0.8);"></canvas>
                                <!-- Centro decorativo -->
                                <div
                                    class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-gradient-to-br from-yellow-600 to-yellow-800 rounded-full border-4 border-yellow-300 shadow-xl flex items-center justify-center z-10">
                                    <i class="fas fa-skull text-black text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- TABLERO DE APUESTAS -->
                        <div
                            class="flex-1 bg-green-900/80 p-4 rounded-lg border-8 border-yellow-900/50 shadow-inner relative select-none">
                            <div class="flex justify-between items-center mb-4 bg-black/40 p-2 rounded">
                                <label class="text-xs text-gray-300 uppercase">Valor Ficha:</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="roulette-amount" value="100" min="10"
                                        class="bg-black border border-white/20 rounded px-2 py-1 text-white w-24 text-right font-mono text-sm">
                                    <span class="text-yellow-500 text-xs">mo</span>
                                </div>
                            </div>

                            <!-- Panel de control de apuestas -->
                            <div class="flex justify-between items-center mb-2 px-1">
                                <div class="text-left text-xs text-gray-400 font-mono">Total: <span
                                        class="text-yellow-400 font-bold" id="total-bet-display">0</span> mo</div>
                                <button onclick="clearRouletteBets()"
                                    class="text-[10px] text-red-400 hover:text-white border border-red-900 hover:bg-red-900 px-2 py-1 rounded bg-black/50 transition-colors uppercase">Limpiar
                                    Mesa</button>
                            </div>

                            <!-- Bot√≥n 0 -->
                            <button id="btn-bet-number-0" onclick="placeRouletteBet('number', 0)"
                                class="relative w-full h-8 mb-1 rounded bg-green-600 hover:bg-green-500 text-white font-bold text-xs border border-white/20 transition-colors group">
                                0
                                <div
                                    class="hidden absolute -top-2 -right-2 bg-yellow-500 text-black text-[9px] font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg border border-white chip-badge z-10">
                                </div>
                            </button>

                            <!-- Grid N√∫meros -->
                            <div class="grid grid-cols-3 gap-1 mb-2" id="roulette-grid"></div>

                            <!-- Apuestas Externas -->
                            <div class="grid grid-cols-2 gap-1">
                                <button id="btn-bet-color-red" onclick="placeRouletteBet('color', 'red')"
                                    class="relative h-10 rounded bg-red-700 hover:bg-red-600 text-white font-bold text-xs border border-white/20 uppercase tracking-wider group">
                                    Rojo (x2)
                                    <div
                                        class="hidden absolute -top-2 -right-2 bg-yellow-500 text-black text-[9px] font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg border border-white chip-badge z-10">
                                    </div>
                                </button>
                                <button id="btn-bet-color-black" onclick="placeRouletteBet('color', 'black')"
                                    class="relative h-10 rounded bg-black hover:bg-gray-800 text-white font-bold text-xs border border-white/20 uppercase tracking-wider group">
                                    Negro (x2)
                                    <div
                                        class="hidden absolute -top-2 -right-2 bg-yellow-500 text-black text-[9px] font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg border border-white chip-badge z-10">
                                    </div>
                                </button>
                                <button id="btn-bet-parity-even" onclick="placeRouletteBet('parity', 'even')"
                                    class="relative h-8 rounded bg-green-800 hover:bg-green-700 text-white font-bold text-[10px] border border-white/20 uppercase group">
                                    Pares
                                    <div
                                        class="hidden absolute -top-2 -right-2 bg-yellow-500 text-black text-[9px] font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg border border-white chip-badge z-10">
                                    </div>
                                </button>
                                <button id="btn-bet-parity-odd" onclick="placeRouletteBet('parity', 'odd')"
                                    class="relative h-8 rounded bg-green-800 hover:bg-green-700 text-white font-bold text-[10px] border border-white/20 uppercase group">
                                    Impares
                                    <div
                                        class="hidden absolute -top-2 -right-2 bg-yellow-500 text-black text-[9px] font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg border border-white chip-badge z-10">
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-center">
                        <button onclick="spinRouletteReal()" id="btn-spin-roulette"
                            class="w-64 py-3 bg-yellow-600 hover:bg-yellow-500 text-black font-bold rounded shadow-lg uppercase tracking-widest transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            GIRAR LA RUEDA
                        </button>
                    </div>
                    <button onclick="exitGame()" class="mt-6 text-gray-500 hover:text-white text-xs underline">Volver al
                        Men√∫</button>
                </div>
            </div>

            <button onclick="toggleCart()"
                class="absolute bottom-8 right-8 w-16 h-16 rounded-full accent-bg shadow-[0_0_20px_rgba(0,0,0,0.5)] flex items-center justify-center text-white text-xl z-30 hover:scale-110 transition-transform group">
                <i class="fas fa-shopping-cart"></i>
                <span id="cart-count"
                    class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border border-black hidden">0</span>
            </button>
        </main>
    </div>

    <!-- Modals (Item Details, Wheel Fortune, Patronage, Cart, Toast) remain same structure -->
    <!-- ITEM MODAL -->
    <div id="item-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 opacity-0 transition-opacity duration-300">
        <div class="glass-modal max-w-lg w-full rounded-2xl overflow-hidden shadow-2xl transform scale-95 transition-transform duration-300"
            id="item-modal-content">
            <div class="h-72 relative overflow-hidden flex items-center justify-center transition-all duration-500 bg-cover bg-center"
                id="modal-header-bg">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-80">
                </div>
                <i id="modal-icon" class="fas fa-gem text-6xl text-white/20 relative z-10"></i>
                <button onclick="closeModal()"
                    class="absolute top-4 right-4 text-white hover:text-red-400 z-20 bg-black/50 w-8 h-8 rounded-full flex items-center justify-center backdrop-blur-sm transition-colors"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="p-8 relative">
                <span id="modal-rarity"
                    class="absolute -top-3 right-8 px-3 py-1 rounded-full text-xs font-bold border shadow-lg backdrop-blur-md z-20">Rara</span>
                <div class="flex justify-between items-start mb-2">
                    <div><span id="modal-type"
                            class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Tipo</span>
                        <h2 id="modal-title" class="text-2xl font-cinzel font-bold text-white mb-1">Nombre</h2>
                    </div>
                </div>
                <div class="flex items-center gap-2 mb-6 text-xl text-yellow-400 font-mono font-bold"><i
                        class="fas fa-coins"></i><span id="modal-price">0</span> <span
                        class="text-sm text-gray-500 ml-1">mo</span></div>
                <div class="prose prose-invert prose-sm mb-6 max-h-40 overflow-y-auto pr-2 custom-scrollbar">
                    <p id="modal-desc" class="text-gray-300 leading-relaxed"></p>
                </div>
                <div class="flex gap-4">
                    <button onclick="closeModal()"
                        class="flex-1 py-3 rounded-lg border border-white/20 text-gray-300 hover:bg-white/5 font-bold text-sm uppercase">Cerrar</button>
                    <button id="modal-add-btn"
                        class="flex-1 py-3 rounded-lg accent-bg text-white hover:brightness-110 font-bold text-sm uppercase shadow-lg flex items-center justify-center gap-2"><i
                            class="fas fa-shopping-cart"></i> A√±adir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FORTUNE WHEEL MODAL (Distinct from Casino Roulette) -->
    <div id="wheel-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/85 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-md w-full rounded-2xl overflow-hidden shadow-2xl p-8 text-center relative border border-yellow-500/30">
            <button onclick="closeWheelModal()" class="absolute top-4 right-4 text-white/50 hover:text-white"><i
                    class="fas fa-times text-xl"></i></button>
            <h2 class="text-2xl font-cinzel font-bold text-yellow-400 mb-2">Ruleta del Destino</h2>
            <div class="relative py-4">
                <div class="wheel-pointer"></div>
                <div class="wheel-container" id="wheel"></div>
            </div>
            <button id="spin-btn" onclick="spinWheel()"
                class="w-full mt-6 py-3 rounded-lg bg-yellow-600 hover:bg-yellow-500 text-black font-bold uppercase tracking-widest shadow-lg flex items-center justify-center gap-2"><i
                    class="fas fa-play"></i> Girar</button>
            <p id="wheel-result" class="mt-4 text-lg font-bold min-h-[28px] text-white"></p>
        </div>
    </div>

    <!-- PATRONAGE MODAL -->
    <div id="patronage-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4 opacity-0 transition-opacity duration-300">
        <div
            class="glass-modal max-w-2xl w-full rounded-2xl overflow-hidden shadow-2xl border border-red-900/50 flex flex-col h-[80vh] md:h-[70vh]">
            <div class="p-6 border-b border-red-900/30 bg-red-900/10 flex justify-between items-center shrink-0">
                <h2 class="text-2xl font-cinzel font-bold text-red-500"><i class="fas fa-hand-holding-usd mr-2"></i>
                    Patrocinio Infernal</h2>
                <button onclick="closePatronageModal()" class="text-red-400 hover:text-red-200"><i
                        class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-8 overflow-y-auto custom-scrollbar flex-1">
                <div class="prose prose-invert prose-sm max-w-none">
                    <p class="text-red-200 mb-2 font-bold text-lg">Volkar no es un banco, es un inversor.</p>
                    <p class="text-gray-400 mb-4">Si te presta oro, quiere que ganes... para que luego trabajes para √©l.
                    </p>
                    <h3 class="text-yellow-500 font-bold mb-2">‚úÖ La Ventaja (Socio Preferente):</h3>
                    <ul class="list-disc pl-5 space-y-2 text-gray-400 mb-4">
                        <li><strong class="text-white">Suerte del Diablo:</strong> 1/d√≠a, convierte cualquier tirada en
                            un 20 natural.</li>
                    </ul>
                    <h3 class="text-red-500 font-bold mb-2">‚ùå El Precio (La Trampa):</h3>
                    <ul class="list-disc pl-5 space-y-2 text-gray-400 mb-6">
                        <li>Volkar aparecer√° aleatoriamente para cobrar "una cuota".</li>
                    </ul>
                </div>
                <div class="mt-8 grid grid-cols-2 gap-4 pb-4">
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(50000)">
                        <div class="text-2xl text-yellow-500 mb-1 font-bold">50k mo</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Inversi√≥n Inicial</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(150000)">
                        <div class="text-2xl text-yellow-500 mb-1 font-bold">150k mo</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Socio Minoritario</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(500000)">
                        <div class="text-2xl text-yellow-500 mb-1 font-bold">500k mo</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Socio Mayoritario</div>
                    </div>
                    <div class="bg-black/40 p-4 rounded border border-red-900/20 text-center cursor-pointer hover:border-red-500 transition-colors"
                        onclick="requestLoan(1000000)">
                        <div class="text-2xl text-yellow-500 mb-1 font-bold">1M mo</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest">Alma Vendida</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CART SIDEBAR -->
    <div id="cart-sidebar"
        class="fixed inset-y-0 right-0 w-full md:w-96 glass-modal z-50 transform translate-x-full transition-transform duration-300 flex flex-col shadow-2xl border-l border-white/10">
        <div class="p-6 border-b border-white/10 flex justify-between items-center accent-bg">
            <h2 class="text-xl font-cinzel font-bold text-white"><i class="fas fa-shopping-cart mr-2"></i> Inventario
            </h2>
            <button onclick="toggleCart()" class="text-white/70 hover:text-white"><i
                    class="fas fa-times text-xl"></i></button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
        <div class="p-6 border-t border-white/10 bg-black/20">
            <div id="discount-row" class="flex justify-between items-center mb-2 text-sm hidden">
                <span class="text-green-400">Descuento aplicado:</span><span class="text-green-400 font-mono"
                    id="discount-amount">0%</span>
            </div>
            <div class="flex justify-between items-center mb-4 text-lg font-bold">
                <span class="text-gray-400">Total</span><span class="text-yellow-400 font-mono"><span
                        id="cart-total">0</span> mo</span>
            </div>
            <button onclick="checkout()"
                class="w-full py-3 rounded-lg accent-bg text-white font-bold uppercase tracking-widest hover:brightness-110 shadow-lg"><i
                    class="fas fa-scroll mr-2"></i> Confirmar</button>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast"
        class="fixed bottom-8 left-1/2 transform -translate-x-1/2 glass-panel px-6 py-3 rounded-full flex items-center gap-3 shadow-2xl translate-y-20 transition-all duration-300 z-50 border border-green-500/30">
        <i class="fas fa-check-circle text-green-400"></i><span id="toast-msg"
            class="text-sm font-bold text-white"></span>
    </div>

    <script>
        // --- CONFIGURACI√ìN DE USUARIO ---
        let userGold = 25000;

        // --- DATA STRUCTURE (Restored) ---
        const allShops = [
            // ANILLO 0 (Mercado Negro)
            {
                id: 'casino-infernal',
                ring: 0,
                name: 'El Casino de la Perdici√≥n',
                subtitle: 'Juegos de Azar',
                themeClass: 'theme-black-market',
                icon: 'fa-dice', bgIcon: 'fa-coins',
                image: 'https://images.unsplash.com/photo-1596838132731-3301c3fd4317?q=80&w=1470&auto=format&fit=crop',
                description: "Aqu√≠ no se compra con oro, se apuesta el alma. La casa siempre gana... ¬øo no?",
                specialType: 'casino',
                items: []
            },
            {
                id: 'fragua-matadioses',
                ring: 0,
                name: 'La Fragua del Matadioses',
                subtitle: 'Armas +5 God-Tier',
                themeClass: 'theme-black-market',
                icon: 'fa-skull', bgIcon: 'fa-hammer',
                image: 'img/tiendas/fragua_matadioses_1765927064019.png',
                description: "Armas prohibidas capaces de herir lo divino forjadas en lava negra.",
                items: [
                    { name: 'La Cercenadora de Conjuros', price: 150000, type: 'Arma', desc: 'Espada +5. Reacci√≥n infinita: Corta cualquier hechizo (incluso Deseo) si superas la CD.', rarity: 'Prohibido' },
                    { name: 'Guada√±a del Fin (Antares)', price: 220000, type: 'Arma', desc: 'Guada√±a +5. Ignora resistencias/inmunidades. Si mata, borra el alma (sin resurrecci√≥n).', rarity: 'Prohibido' },
                    { name: 'Arco del Horizonte Infinito', price: 180000, type: 'Arma', desc: 'Arco +5. Alcance visual infinito. Atraviesa muros. Ataca vs CA 10 + Des (ignora armadura).', rarity: 'Prohibido' },
                    { name: 'Dagas del Tiempo Robado', price: 250000, type: 'Arma', desc: 'Dagas +5. Si aciertas 2 ataques, el enemigo pierde su turno y t√∫ ganas uno extra.', rarity: 'Prohibido' },
                    { name: 'Martillo de Gravedad (Legia)', price: 160000, type: 'Arma', desc: 'Martillo +5. Empuja 1km o crea zona de no-vuelo al golpear.', rarity: 'Prohibido' },
                    { name: 'Lanza Perforacielos', price: 170000, type: 'Arma', desc: 'Lanza +5. Golpea voladores: caen aturdidos (sin salvaci√≥n) y pierden vuelo 1 hora.', rarity: 'Prohibido' },
                    { name: 'L√°tigo de la Plaga (Querehsha)', price: 190000, type: 'Arma', desc: 'L√°tigo +5. Veneno ignora inmunidad. Cr√≠tico: Par√°lisis permanente.', rarity: 'Prohibido' }
                ]
            },
            {
                id: 'bunker-eterno',
                ring: 0,
                name: 'El B√∫nker Eterno',
                subtitle: 'Armaduras Inmortales',
                themeClass: 'theme-black-market',
                icon: 'fa-shield-virus', bgIcon: 'fa-shield-alt',
                image: 'img/tiendas/bunker_eterno_1765927079607.png',
                description: "Defensas absolutas para sobrevivir al apocalipsis hechas de placas negras.",
                items: [
                    { name: 'Placas del Reflejo Total', price: 250000, type: 'Armadura', desc: 'Armadura +5 (CA 23). Inmune magia Nvl 1-5. Nvl 6+ 50% rebote.', rarity: 'Prohibido' },
                    { name: 'T√∫nica de Intangibilidad', price: 190000, type: 'Ropa', desc: 'Resistencia a todo da√±o f√≠sico. Atraviesa paredes.', rarity: 'Prohibido' },
                    { name: 'Escudo Muro de Legia', price: 175000, type: 'Escudo', desc: 'Escudo +5. Inmune a ser movido. Cobertura Total detr√°s de ti.', rarity: 'Prohibido' },
                    { name: 'Yelmo de la Omnisciencia', price: 200000, type: 'Casco', desc: 'Visi√≥n Verdadera 1km. Inmune Sorpresa/Ceguera. Ves stats enemigos.', rarity: 'Prohibido' },
                    { name: 'Brazales de la Tormenta', price: 150000, type: 'Accesorio', desc: 'Da√±o Rayo/Trueno cura. Vuelas igual a tu velocidad.', rarity: 'Prohibido' },
                    { name: 'Capa de la Nube T√≥xica', price: 160000, type: 'Capa', desc: 'Aura 10 pies: 4d10 veneno (sin salvaci√≥n). Inmune a veneno.', rarity: 'Prohibido' },
                    { name: 'Coraza del F√©nix Helado', price: 210000, type: 'Armadura', desc: 'Coraza +5. A 0 HP, bloque invulnerable y regeneras 100 HP.', rarity: 'Prohibido' }
                ]
            },
            {
                id: 'archivo-prohibido',
                ring: 0,
                name: 'El Archivo Prohibido',
                subtitle: 'Manuales y Tomos',
                themeClass: 'theme-black-market',
                icon: 'fa-book-dead', bgIcon: 'fa-book',
                image: 'img/tiendas/archivo_prohibido_1765927095916.png',
                description: "Conocimiento que quema la mente y altera la realidad en estanter√≠as de hueso.",
                items: [
                    { name: 'Tomo de la Doble Mente', price: 300000, type: 'Manual', desc: 'Mantener Concentraci√≥n en 2 hechizos a la vez.', rarity: 'Prohibido' },
                    { name: 'C√≥dice de L√≠mites Rotos', price: 400000, type: 'Manual', desc: 'Stat m√°ximo sube a 30 y ganas +5 instant√°neo.', rarity: 'Prohibido' },
                    { name: 'Manual de Acci√≥n Suprema', price: 250000, type: 'Manual', desc: 'Ganas una segunda Reacci√≥n por turno permanentemente.', rarity: 'Prohibido' },
                    { name: 'Pergamino del Avatar', price: 350000, type: 'Consumible', desc: 'Transformaci√≥n en Drag√≥n/Demonio CR 17+ 1 vez/d√≠a.', rarity: 'Prohibido' },
                    { name: 'Grimorio Magia de Sangre', price: 280000, type: 'Objeto', desc: 'Lanza hechizos gastando Hit Dice en lugar de Slots.', rarity: 'Prohibido' },
                    { name: 'Tratado de Piel de Acero', price: 200000, type: 'Manual', desc: 'Resistencia permanente a cortante/perf/contundente.', rarity: 'Prohibido' },
                    { name: 'Libro del Olvido', price: 100000, type: 'Consumible', desc: 'Respec total del personaje manteniendo XP.', rarity: 'Prohibido' }
                ]
            },
            {
                id: 'taller-injertos',
                ring: 0,
                name: 'El Taller de Injertos',
                subtitle: 'Modificaciones Corporales',
                themeClass: 'theme-black-market',
                icon: 'fa-dna', bgIcon: 'fa-hand-lizard',
                image: 'img/tiendas/taller_injertos_1765927118688.png',
                description: "Evoluciona m√°s all√° de tu humanidad en quir√≥fanos manchados de icor.",
                items: [
                    { name: 'Alas de Valquiria', price: 120000, type: 'Injerto', desc: 'Alas f√≠sicas permanentes. Vuelo 90 pies.', rarity: 'Ilegal' },
                    { name: 'Coraz√≥n de Troll', price: 180000, type: 'Injerto', desc: 'Regeneras 20 HP al inicio de cada turno.', rarity: 'Ilegal' },
                    { name: 'Brazo Extra', price: 150000, type: 'Injerto', desc: 'Tercer brazo funcional. Usa escudo + arma a dos manos.', rarity: 'Ilegal' },
                    { name: 'Ojos de Basilisco', price: 200000, type: 'Injerto', desc: 'Acci√≥n: Mirada petrificante (CON CD 18) permanente.', rarity: 'Ilegal' },
                    { name: 'Piel de Camale√≥n', price: 140000, type: 'Injerto', desc: 'Invisibilidad a voluntad (bonus). No rompe al atacar.', rarity: 'Ilegal' },
                    { name: 'Branquias de Kraken', price: 80000, type: 'Injerto', desc: 'Respirar agua, nado 60 pies, inmune presi√≥n.', rarity: 'Ilegal' },
                    { name: 'Sangre de Monarca', price: 250000, type: 'Injerto', desc: 'Tipo cambia a Celestial/Demonio. Inmune enfermedad/vejez.', rarity: 'Ilegal' }
                ]
            },
            {
                id: 'astillero-vacio',
                ring: 0,
                name: 'Astillero del Vac√≠o',
                subtitle: 'Veh√≠culos de Guerra',
                themeClass: 'theme-black-market',
                icon: 'fa-rocket', bgIcon: 'fa-fighter-jet',
                image: 'img/tiendas/astillero_vacio_1765927133577.png',
                description: "Bases m√≥viles y m√°quinas de destrucci√≥n masiva flotando en la nada.",
                items: [
                    { name: 'Fortaleza Flotante', price: 1000000, type: 'Veh√≠culo', desc: 'Castillo volador. Escudo fuerza, ca√±ones 8d10. 50 pax.', rarity: 'Ex√≥tica' },
                    { name: 'Barco "El Espectro"', price: 500000, type: 'Veh√≠culo', desc: 'Navega agua/bajo agua/astral. Indetectable.', rarity: 'Ex√≥tica' },
                    { name: 'Mecha "Tit√°n de Hierro"', price: 400000, type: 'Veh√≠culo', desc: 'Traje g√≥lem. FUE 26, 300 HP extra.', rarity: 'Ex√≥tica' },
                    { name: 'Puerta de Enlace', price: 300000, type: 'Estructura', desc: 'Dos arcos. Teleport instant√°neo ilimitado entre ellos.', rarity: 'Ex√≥tica' },
                    { name: 'Moto Arcano-Ciclo', price: 80000, type: 'Veh√≠culo', desc: 'Terrestre 2 pax. 200 pies. Sube paredes.', rarity: 'Ex√≥tica' },
                    { name: 'Torre de Bolsillo', price: 150000, type: 'Objeto', desc: 'Cubo despliega torre mago defensiva en 1 turno.', rarity: 'Ex√≥tica' },
                    { name: 'Ca√±√≥n "Mata-Dragones"', price: 250000, type: 'Arma Asedio', desc: 'Port√°til. 20d12 da√±o. Derriba Gigantes.', rarity: 'Ex√≥tica' }
                ]
            },
            {
                id: 'joyeria-destino',
                ring: 0,
                name: 'Joyer√≠a del Destino',
                subtitle: 'Accesorios de Poder',
                themeClass: 'theme-black-market',
                icon: 'fa-ring', bgIcon: 'fa-gem',
                image: 'img/tiendas/joyeria_destino_1765927148348.png',
                description: "Peque√±os objetos, consecuencias masivas en vitrinas irrompibles.",
                items: [
                    { name: 'Anillo F√©nix Eterno', price: 600000, type: 'Anillo', desc: 'Si mueres, revives 100% HP al instante. Indestructible.', rarity: 'Legendaria' },
                    { name: 'Amuleto Mana Infinito', price: 450000, type: 'Collar', desc: 'Hechizos Nvl 1-3 son trucos ilimitados.', rarity: 'Legendaria' },
                    { name: 'Botas Caminante de Planos', price: 180000, type: 'Botas', desc: 'Paso Brumoso (30ft) es Acci√≥n Gratuita cada turno.', rarity: 'Legendaria' },
                    { name: 'Cintur√≥n Fuerza de Atlas', price: 220000, type: 'Cintur√≥n', desc: 'Fuerza 29 (+9). Carga x4.', rarity: 'Legendaria' },
                    { name: 'Gema Alma de Magia', price: 300000, type: 'Gema', desc: 'Aplica Metamagia a hechizos sin ser Hechicero.', rarity: 'Legendaria' },
                    { name: 'Collar Crono-Estasis', price: 350000, type: 'Collar', desc: '1/d√≠a Time Stop sin gastar slot.', rarity: 'Legendaria' },
                    { name: 'Mon√≥culo de la Verdad', price: 280000, type: 'Ojos', desc: 'Visi√≥n Verdadera permanente. +10 Iniciativa.', rarity: 'Legendaria' }
                ]
            },
            {
                id: 'alambique-limite',
                ring: 0,
                name: 'El Alambique del L√≠mite',
                subtitle: 'Consumibles Devastadores',
                themeClass: 'theme-black-market',
                icon: 'fa-flask', bgIcon: 'fa-skull-crossbones',
                image: 'img/tiendas/alambique_limite_1765927168109.png',
                description: "Un solo uso para cambiar el destino. Cuidado con los efectos secundarios.",
                items: [
                    { name: 'Suero "Limit Break"', price: 50000, type: 'Poci√≥n', desc: '1 min: 2 Acciones/Bonus/Reacciones por turno. Luego 0 HP.', rarity: 'Consumible' },
                    { name: 'Bomba Agujero Negro', price: 80000, type: 'Bomba', desc: 'Radio 20ft. Fallo CD 20 = Desintegrado.', rarity: 'Consumible' },
                    { name: 'Elixir Descanso de Dioses', price: 60000, type: 'Poci√≥n', desc: 'Descanso Largo instant√°neo en combate.', rarity: 'Consumible' },
                    { name: 'Aceite Golpe Vorpal', price: 40000, type: 'Aceite', desc: 'Siguiente golpe Cr√≠tico Auto + Decapitar (<150 HP).', rarity: 'Consumible' },
                    { name: 'Frasco de Invulnerabilidad', price: 70000, type: 'Poci√≥n', desc: 'Inmune a todo da√±o 3 rondas.', rarity: 'Consumible' },
                    { name: 'Polvo de Resurrecci√≥n', price: 30000, type: 'Polvo', desc: 'Revive aliado 100% HP como acci√≥n, sin coste.', rarity: 'Consumible' },
                    { name: 'Vial de Deseo L√≠quido', price: 100000, type: 'Poci√≥n', desc: 'Simula Deseo (Wish) sin riesgo de perderlo.', rarity: 'Consumible' }
                ]
            },
            // ANILLO 1
            {
                id: 'fragua-amanecer',
                ring: 1,
                name: 'La Fragua del Amanecer',
                subtitle: 'Armas de Calidad',
                themeClass: 'theme-fragua',
                icon: 'fa-hammer', bgIcon: 'fa-fire',
                image: 'img/tiendas/fragua_amanecer_1765927196318.png',
                description: "Un edificio de piedra blanca donde el fuego de la forja es dorado. Los martillos suenan como campanas afinadas.",
                items: [
                    { name: 'Espada Larga +1', price: 500, type: 'Arma', desc: 'M√°gica. +1 al ataque y da√±o.', rarity: 'Poco Com√∫n' },
                    { name: 'Jabalina del Rayo', price: 1500, type: 'Arma', desc: 'Se convierte en un rayo de 4d6 (1 vez/d√≠a).', rarity: 'Rara' },
                    { name: 'Espada "Toque Lunar"', price: 300, type: 'Arma', desc: 'Brilla en la oscuridad. Ignora resistencia a no-m√°gico.', rarity: 'Poco Com√∫n' },
                    { name: 'Daga "Colmillo de V√≠bora"', price: 450, type: 'Arma', desc: '1/d√≠a: El siguiente golpe a√±ade 2d6 veneno.', rarity: 'Poco Com√∫n' },
                    { name: 'Gran Hacha "Tumbapuertas"', price: 600, type: 'Arma', desc: 'Cr√≠tico autom√°tico contra objetos inanimados.', rarity: 'Poco Com√∫n' },
                    { name: 'Arco "Susurro de Viento"', price: 400, type: 'Arma', desc: 'Indica direcci√≥n del viento. Alcance +20 pies.', rarity: 'Poco Com√∫n' },
                    { name: 'Maza "Luz Sagrada"', price: 800, type: 'Arma', desc: 'Lanza Luz. +1d4 radiante vs No-muertos.', rarity: 'Poco Com√∫n' },
                    { name: 'Espada Corta del Duelista', price: 1200, type: 'Arma', desc: '+1 CA extra al usar la acci√≥n Esquivar.', rarity: 'Rara' },
                    { name: 'Lanza de Caza "Retr√°ctil"', price: 350, type: 'Arma', desc: 'Se encoge al tama√±o de una varita (Acci√≥n bonus).', rarity: 'Poco Com√∫n' },
                    { name: 'Martillo "Eco"', price: 1000, type: 'Arma', desc: 'Si fallas, el siguiente ataque al mismo objetivo tiene +1.', rarity: 'Rara' },
                    { name: 'Virotes de Rastreo (5)', price: 250, type: 'Munici√≥n', desc: 'Sabes la ubicaci√≥n del objetivo 1 hora (1 milla).', rarity: 'Poco Com√∫n' },
                    { name: 'Estoque "Plata L√≠quida"', price: 550, type: 'Arma', desc: 'Cuenta como Plata y M√°gica. Nunca se oxida.', rarity: 'Poco Com√∫n' }
                ]
            },
            {
                id: 'bastion-plata',
                ring: 1,
                name: 'El Basti√≥n de Plata',
                subtitle: 'Armaduras y Escudos',
                themeClass: 'theme-hilos',
                icon: 'fa-shield-alt', bgIcon: 'fa-user-shield',
                image: 'img/tiendas/bastion_plata_1765927212624.png',
                description: "Armaduras sobre maniqu√≠es de cristal flotantes. Un silencio m√°gico amortigua el ruido met√°lico.",
                items: [
                    { name: 'Escudo +1', price: 1200, type: 'Escudo', desc: '+3 a la CA total.', rarity: 'Rara' },
                    { name: 'Cota de Malla de Mithral', price: 800, type: 'Armadura', desc: 'Sin desventaja en Sigilo. Ocultable bajo ropa.', rarity: 'Poco Com√∫n' },
                    { name: 'Armadura de Adamantina', price: 900, type: 'Armadura', desc: 'Convierte cualquier cr√≠tico recibido en golpe normal.', rarity: 'Poco Com√∫n' },
                    { name: 'Casco "Ojos de B√∫ho"', price: 600, type: 'Casco', desc: 'Visi√≥n Oscuridad 60ft (o +30ft si ya tienes).', rarity: 'Poco Com√∫n' },
                    { name: 'Botas "Aterrizaje Suave"', price: 400, type: 'Botas', desc: 'Reduces da√±o ca√≠da 20 pies. Siempre caes de pie.', rarity: 'Poco Com√∫n' },
                    { name: 'Guanteletes "Agarre de Hierro"', price: 300, type: 'Guantes', desc: 'Ventaja para evitar ser desarmado.', rarity: 'Poco Com√∫n' },
                    { name: 'Escudo "Reflector Menor"', price: 1500, type: 'Escudo', desc: 'Reacci√≥n: Redirige flecha fallida a 5 pies de ti.', rarity: 'Rara' },
                    { name: 'Cuero Tachonado "Selv√°tico"', price: 700, type: 'Armadura', desc: 'Ventaja Sigilo en bosques/selvas.', rarity: 'Poco Com√∫n' },
                    { name: 'Coraza del "Nadador"', price: 850, type: 'Armadura', desc: 'Flotadores m√°gicos. No te hundes, nadas normal.', rarity: 'Poco Com√∫n' },
                    { name: 'Cintur√≥n "Soporte Vital"', price: 2000, type: 'Cintur√≥n', desc: 'Estabiliza autom√°ticamente a 0 HP (1/d√≠a).', rarity: 'Rara' },
                    { name: 'Brazales de "Parada"', price: 1800, type: 'Accesorio', desc: 'Reacci√≥n: +2 CA contra un ataque melee.', rarity: 'Rara' },
                    { name: 'Capa "Guardia Invernal"', price: 250, type: 'Capa', desc: 'Resistencia Fr√≠o ambiental. Te mantiene seco.', rarity: 'Com√∫n' }
                ]
            },
            {
                id: 'alquimia-gota',
                ring: 1,
                name: 'Alquimia "La Gota Dorada"',
                subtitle: 'Pociones y Brebajes',
                themeClass: 'theme-liquida',
                icon: 'fa-flask', bgIcon: 'fa-prescription-bottle-alt',
                image: 'img/tiendas/alquimia_gota_1765927227421.png',
                description: "Cientos de tubos de vidrio llevan l√≠quidos de colores. Un g√≥lem de cristal sirve con precisi√≥n.",
                items: [
                    { name: 'Poci√≥n Curaci√≥n Mayor', price: 250, type: 'Poci√≥n', desc: 'Cura 4d4 + 4 HP.', rarity: 'Poco Com√∫n' },
                    { name: 'Poci√≥n Respirar Agua', price: 300, type: 'Poci√≥n', desc: 'Respiras bajo el agua 1 hora.', rarity: 'Poco Com√∫n' },
                    { name: 'Aceite de Resbalar', price: 400, type: 'Aceite', desc: 'Libertad de Movimiento por 8 horas.', rarity: 'Poco Com√∫n' },
                    { name: 'Polvo de Desaparici√≥n', price: 500, type: 'Polvo', desc: 'Invisibilidad 2d4 minutos (se esparce).', rarity: 'Poco Com√∫n' },
                    { name: 'Elixir "Piel de Piedra"', price: 800, type: 'Poci√≥n', desc: 'Resistencia da√±o f√≠sico no m√°gico (10 min).', rarity: 'Poco Com√∫n' },
                    { name: 'T√≥nico "Ojo de √Åguila"', price: 600, type: 'Poci√≥n', desc: 'Ventaja Percepci√≥n visual y ataque rango (30 min).', rarity: 'Poco Com√∫n' },
                    { name: 'Frasco "Fuego L√≠quido"', price: 200, type: 'Bomba', desc: 'Como Fuego Alquimista pero 3d6 da√±o.', rarity: 'Com√∫n' },
                    { name: 'Poci√≥n "Descanso R√°pido"', price: 450, type: 'Poci√≥n', desc: 'Elimina 1 nivel de agotamiento al instante.', rarity: 'Poco Com√∫n' },
                    { name: 'Vial "Humo de Huida"', price: 700, type: 'Consumible', desc: 'Al romperlo: Paso Brumoso (30ft) inmediato.', rarity: 'Poco Com√∫n' },
                    { name: 'Aceite de "Afilado"', price: 350, type: 'Aceite', desc: 'Arma m√°gica +0 y +2 da√±o por 1 hora.', rarity: 'Poco Com√∫n' },
                    { name: 'Ant√≠doto Universal', price: 300, type: 'Poci√≥n', desc: 'Cura veneno no m√°gico. Ventaja vs veneno 1h.', rarity: 'Poco Com√∫n' },
                    { name: 'P√≠ldora "Mente Clara"', price: 250, type: 'Consumible', desc: 'Elimina estado Asustado o Hechizado.', rarity: 'Poco Com√∫n' }
                ]
            },
            {
                id: 'morral-viajero',
                ring: 1,
                name: 'El Morral del Viajero',
                subtitle: 'Equipo de Aventura',
                themeClass: 'theme-hilos',
                icon: 'fa-hiking', bgIcon: 'fa-map',
                image: 'img/tiendas/morral_viajero_1765927243784.png',
                description: "Un almac√©n desordenado donde los objetos vuelan a tu mano. Huele a cuero y cuerda nueva.",
                items: [
                    { name: 'Mochila Pr√°ctica Heward', price: 2500, type: 'Maravilloso', desc: 'Los objetos pesan menos y siempre sacas lo que buscas.', rarity: 'Rara' },
                    { name: 'Cuerda de Escalada', price: 400, type: 'Equipo', desc: 'Se mueve, sube y ata sola (60 pies).', rarity: 'Poco Com√∫n' },
                    { name: 'Odre Agua Infinita', price: 800, type: 'Maravilloso', desc: 'Produce agua potable diariamente.', rarity: 'Poco Com√∫n' },
                    { name: 'Tienda "Camuflaje"', price: 350, type: 'Equipo', desc: 'Se mimetiza con el entorno (bosque, nieve...).', rarity: 'Poco Com√∫n' },
                    { name: 'Antorcha Eterna', price: 150, type: 'Equipo', desc: 'Llama fr√≠a que nunca se apaga. Se puede tapar.', rarity: 'Com√∫n' },
                    { name: 'Saco de Dormir "Feliz"', price: 500, type: 'Equipo', desc: 'Recuperas 1 Dado de Golpe extra al descansar.', rarity: 'Poco Com√∫n' },
                    { name: 'Br√∫jula de "Retorno"', price: 200, type: 'Equipo', desc: 'Apunta a la √∫ltima posada donde dormiste.', rarity: 'Com√∫n' },
                    { name: 'Kit de Cocina "Chef"', price: 300, type: 'Equipo', desc: 'Especias infinitas. La comida siempre sabe bien.', rarity: 'Com√∫n' },
                    { name: 'Tiza Fantasma', price: 100, type: 'Consumible', desc: 'Escribe en aire/agua. Dura 1 hora.', rarity: 'Com√∫n' },
                    { name: 'Caja Yesca Autom√°tica', price: 120, type: 'Equipo', desc: 'Fuego instant√°neo incluso con lluvia.', rarity: 'Com√∫n' },
                    { name: 'Catalejo Visi√≥n Nocturna', price: 900, type: 'Equipo', desc: 'Ver en oscuridad 60 pies a trav√©s de la lente.', rarity: 'Poco Com√∫n' },
                    { name: 'Candado Arcano', price: 400, type: 'Equipo', desc: 'Solo abre con palabra clave. CD 25.', rarity: 'Poco Com√∫n' }
                ]
            },
            {
                id: 'tinta-eterna',
                ring: 1,
                name: 'La Tinta Eterna',
                subtitle: 'Pergaminos y Libros',
                themeClass: 'theme-arcano',
                icon: 'fa-scroll', bgIcon: 'fa-feather-alt',
                image: 'img/tiendas/tinta_eterna_1765927269690.png',
                description: "Estanter√≠as infinitas con escaleras voladoras. Los libros susurran entre ellos.",
                items: [
                    { name: 'Pergamino Bola de Fuego', price: 400, type: 'Pergamino', desc: 'Lanza Fireball (Nivel 3). Un uso.', rarity: 'Poco Com√∫n' },
                    { name: 'Pergamino Volar', price: 350, type: 'Pergamino', desc: 'Lanza Fly. Un uso.', rarity: 'Poco Com√∫n' },
                    { name: 'Pergamino Revivir', price: 600, type: 'Pergamino', desc: 'Revivify. Vital para emergencias.', rarity: 'Poco Com√∫n' },
                    { name: 'Mapa M√°gico Regi√≥n', price: 1000, type: 'Objeto', desc: 'Muestra tu ubicaci√≥n en tiempo real (Solo Eranol).', rarity: 'Rara' },
                    { name: 'Tinta Invisible', price: 150, type: 'Consumible', desc: 'Solo se lee con luz de luna o calor.', rarity: 'Com√∫n' },
                    { name: 'Libro de "Traducci√≥n"', price: 800, type: 'Libro', desc: 'Traduce 1 p√°gina/d√≠a al tocar el texto.', rarity: 'Poco Com√∫n' },
                    { name: 'Pack Pergaminos Identificar', price: 300, type: 'Pergamino', desc: '3 usos de Identify sin componentes.', rarity: 'Com√∫n' },
                    { name: 'Sobre Mensajero', price: 500, type: 'Objeto', desc: 'Lo que metes aparece en un sobre vinculado.', rarity: 'Poco Com√∫n' },
                    { name: 'Pergamino "Paso Brumoso"', price: 250, type: 'Pergamino', desc: 'Teletransporte de emergencia.', rarity: 'Com√∫n' },
                    { name: 'Grimorio Impermeable', price: 400, type: 'Libro', desc: 'No se moja ni quema con fuego normal.', rarity: 'Poco Com√∫n' },
                    { name: 'Pluma de Dictado', price: 200, type: 'Objeto', desc: 'Escribe lo que dices en voz alta.', rarity: 'Com√∫n' },
                    { name: 'Sello de "Silencio"', price: 350, type: 'Consumible', desc: 'Al romperlo, Silencio en 15 pies por 1 min.', rarity: 'Poco Com√∫n' }
                ]
            },
            {
                id: 'brillos-baratijas',
                ring: 1,
                name: 'Brillos y Baratijas',
                subtitle: 'Accesorios M√°gicos',
                themeClass: 'theme-cronos',
                icon: 'fa-ring', bgIcon: 'fa-star',
                image: 'img/tiendas/brillos_baratijas_1765927283774.png',
                description: "Tienda peque√±a y oscura donde las joyas brillan en vitrinas de terciopelo.",
                items: [
                    { name: 'Anillo de Nadar', price: 800, type: 'Anillo', desc: 'Velocidad nado 40 pies.', rarity: 'Poco Com√∫n' },
                    { name: 'Broche de Escudo', price: 2500, type: 'Broche', desc: 'Resistencia Fuerza. Inmune Proyectil M√°gico.', rarity: 'Rara' },
                    { name: 'Gafas de la Noche', price: 1200, type: 'Ojos', desc: 'Visi√≥n oscuridad 60 pies.', rarity: 'Rara' },
                    { name: 'Anillo "Luz Gu√≠a"', price: 200, type: 'Anillo', desc: 'Lanza Luz o Luces Danzantes a voluntad.', rarity: 'Com√∫n' },
                    { name: 'Amuleto "Salud Menor"', price: 400, type: 'Collar', desc: 'Inmune a resfriados y fiebres comunes.', rarity: 'Poco Com√∫n' },
                    { name: 'Pendientes "Murmullo"', price: 700, type: 'Pendientes', desc: 'Mensajes susurrados al par (1 milla).', rarity: 'Poco Com√∫n' },
                    { name: 'Brazalete "Retorno"', price: 500, type: 'Pulsera', desc: 'Vincula arma. Vuelve a la mano con orden.', rarity: 'Poco Com√∫n' },
                    { name: 'Anillo del "Saltamontes"', price: 350, type: 'Anillo', desc: 'Triplica distancia de salto.', rarity: 'Poco Com√∫n' },
                    { name: 'Medall√≥n del "Coraje"', price: 600, type: 'Collar', desc: 'Ventaja en 1¬™ salvaci√≥n Miedo del d√≠a.', rarity: 'Poco Com√∫n' },
                    { name: 'Gema de "Calor"', price: 250, type: 'Objeto', desc: 'En el bolsillo, nunca pasas fr√≠o extremo.', rarity: 'Com√∫n' },
                    { name: 'Broche del "Orador"', price: 300, type: 'Broche', desc: 'Amplifica voz x3 (Meg√°fono).', rarity: 'Com√∫n' },
                    { name: 'Anillo "Camuflaje"', price: 450, type: 'Anillo', desc: 'Cambia color de ropa/pelo a voluntad.', rarity: 'Poco Com√∫n' }
                ]
            },
            {
                id: 'melodia-encantada',
                ring: 1,
                name: 'La Melod√≠a Encantada',
                subtitle: 'Instrumentos y Arte',
                themeClass: 'theme-liquida',
                icon: 'fa-music', bgIcon: 'fa-guitar',
                image: 'img/tiendas/melodia_encantada_1765927299645.png',
                description: "Los instrumentos tocan solos una melod√≠a suave. Las paredes cambian de color con la m√∫sica.",
                items: [
                    { name: 'Flauta de los Lagos', price: 2000, type: 'Instrumento', desc: 'Instrumento de los Bardos.', rarity: 'Rara' },
                    { name: 'Cuerno del Valhalla (Lat√≥n)', price: 3000, type: 'Instrumento', desc: 'Invoca berserkers espectrales (1/semana).', rarity: 'Rara' },
                    { name: 'Tambor del "Trueno"', price: 500, type: 'Instrumento', desc: 'Acci√≥n: Sonido atronador 300 pies. +1 Intimidar.', rarity: 'Poco Com√∫n' },
                    { name: 'Arpa "Aut√≥noma"', price: 800, type: 'Instrumento', desc: 'Toca sola canciones aprendidas.', rarity: 'Poco Com√∫n' },
                    { name: 'Pintura "Viva"', price: 400, type: 'Arte', desc: 'Lienzo con imagen en movimiento (GIF m√°gico).', rarity: 'Poco Com√∫n' },
                    { name: 'Capa de "Bardo"', price: 250, type: 'Capa', desc: 'Ondea dram√°ticamente sin viento.', rarity: 'Com√∫n' },
                    { name: 'La√∫d "Durabilidad"', price: 350, type: 'Instrumento', desc: 'Sirve como Maza. No se rompe.', rarity: 'Com√∫n' },
                    { name: 'M√°scara "Tragedia/Comedia"', price: 300, type: 'M√°scara', desc: 'Cambia expresi√≥n y tono de voz.', rarity: 'Com√∫n' },
                    { name: 'Trompeta de "Alerta"', price: 200, type: 'Instrumento', desc: 'Despierta aliados en 100 pies m√°gicamente.', rarity: 'Com√∫n' },
                    { name: 'Caja M√∫sica "Sue√±o"', price: 450, type: 'Objeto', desc: 'Ventaja para dormir en entorno hostil.', rarity: 'Poco Com√∫n' },
                    { name: 'Silbato de "Perro"', price: 100, type: 'Instrumento', desc: 'Ultras√≥nico. Solo lo oyen bestias.', rarity: 'Com√∫n' },
                    { name: 'Dados "Tramposos"', price: 600, type: 'Juego', desc: 'Eliges resultado 3/d√≠a. Detectable con magia.', rarity: 'Poco Com√∫n' }
                ]
            },
            {
                id: 'companeros-menores',
                ring: 1,
                name: 'Compa√±eros Menores',
                subtitle: 'Mascotas y Monturas',
                themeClass: 'theme-vivarium',
                icon: 'fa-paw', bgIcon: 'fa-horse',
                image: 'img/tiendas/companeros_menores_1765927318524.png',
                description: "Establo limpio y m√°gico. Criaturas peque√±as para utilidad, no combate.",
                items: [
                    { name: 'Figurilla Escarabajo', price: 1500, type: 'Maravilloso', desc: 'Se transforma en escarabajo gigante 1 hora.', rarity: 'Rara' },
                    { name: 'Caballo de Guerra', price: 400, type: 'Montura', desc: 'Entrenado, no se asusta. Con armadura ligera.', rarity: 'Com√∫n' },
                    { name: 'Paloma "Arcana"', price: 200, type: 'Mascota', desc: 'Entrega cartas y vuelve m√°gicamente.', rarity: 'Com√∫n' },
                    { name: 'Gato "Cazador"', price: 100, type: 'Mascota', desc: 'Detecta y caza alima√±as/esp√≠as peque√±os.', rarity: 'Com√∫n' },
                    { name: 'Perro Guardi√°n "Blink"', price: 300, type: 'Mascota', desc: 'Parpadea un poco. Ventaja olfato.', rarity: 'Com√∫n' },
                    { name: 'B√∫ho "Linterna"', price: 250, type: 'Mascota', desc: 'Ojos proyectan luz 60 pies a la orden.', rarity: 'Com√∫n' },
                    { name: 'Lagarto "Trepa-Muros"', price: 150, type: 'Mascota', desc: 'Lleva objetos ligeros por paredes.', rarity: 'Com√∫n' },
                    { name: 'Pez "Luminoso"', price: 80, type: 'Mascota', desc: 'Brilla si el agua est√° envenenada.', rarity: 'Com√∫n' },
                    { name: 'Hur√≥n "Ladr√≥n"', price: 500, type: 'Mascota', desc: 'Entrenado. +5 Juego de Manos.', rarity: 'Poco Com√∫n' },
                    { name: 'Silla de Montar "Militar"', price: 150, type: 'Equipo', desc: 'Ventaja para no caer de la montura.', rarity: 'Com√∫n' },
                    { name: 'Silbato de Montura', price: 200, type: 'Objeto', desc: 'Llama caballo vinculado (1 milla).', rarity: 'Com√∫n' },
                    { name: 'Alforjas de "Carga"', price: 1200, type: 'Equipo', desc: 'Bolsa de Contenci√≥n menor para montura.', rarity: 'Rara' }
                ]
            },
            {
                id: 'ojo-cristal',
                ring: 1,
                name: 'El Ojo de Cristal',
                subtitle: 'Varitas y Focos',
                themeClass: 'theme-arcano',
                icon: 'fa-eye', bgIcon: 'fa-magic',
                image: 'img/tiendas/ojo_cristal_1765927350429.png',
                description: "Torre de cristal en espiral transparente. Hechicera ciega atiende.",
                items: [
                    { name: 'Varita Detectar Magia', price: 800, type: 'Varita', desc: '3 cargas diarias.', rarity: 'Poco Com√∫n' },
                    { name: 'Varita Telara√±a', price: 1500, type: 'Varita', desc: 'Lanza Web. Control de masas.', rarity: 'Rara' },
                    { name: 'Perla de Poder', price: 2000, type: 'Maravilloso', desc: 'Recupera slot Nivel 3.', rarity: 'Rara' },
                    { name: 'Foco "Orbe de Sangre"', price: 1200, type: 'Foco', desc: '+1 da√±o hechizos Nigromancia.', rarity: 'Rara' },
                    { name: 'Bast√≥n de "Luz"', price: 600, type: 'Bast√≥n', desc: 'Luz, Luces Danzantes, Fuego Fe√©rico (1/d√≠a).', rarity: 'Poco Com√∫n' },
                    { name: 'Varita Misiles M√°gicos', price: 2500, type: 'Varita', desc: '7 cargas. Magic Missile Nvl 1.', rarity: 'Rara' },
                    { name: 'Cetro de "Mando"', price: 900, type: 'Cetro', desc: 'Voz a 300 pies. Ventaja Persuasi√≥n grupos.', rarity: 'Poco Com√∫n' },
                    { name: 'Cristal de "Fuego"', price: 1000, type: 'Foco', desc: 'Cambia da√±o elemental a Fuego.', rarity: 'Rara' },
                    { name: 'Varita de "Bromista"', price: 300, type: 'Varita', desc: 'Prestidigitaci√≥n/Taumaturgia a voluntad.', rarity: 'Com√∫n' },
                    { name: 'Bast√≥n de "Roble"', price: 700, type: 'Bast√≥n', desc: 'Shillelagh permanente (arma m√°gica).', rarity: 'Poco Com√∫n' },
                    { name: 'Gema "Concentraci√≥n"', price: 2800, type: 'Gema', desc: 'Repite 1 tirada concentraci√≥n/d√≠a.', rarity: 'Rara' },
                    { name: 'Varita "Crecimiento"', price: 1500, type: 'Varita', desc: 'Lanza Enlarge (1/d√≠a).', rarity: 'Rara' }
                ]
            },
            {
                id: 'caja-sorpresas',
                ring: 1,
                name: 'Caja de Sorpresas',
                subtitle: 'Artilugios Gn√≥micos',
                themeClass: 'theme-cronos',
                icon: 'fa-cogs', bgIcon: 'fa-wrench',
                image: 'img/tiendas/caja_sorpresas_1765927366945.png',
                description: "Tienda llena de ruidos, tictacs y humo. Artilugios extra√±os de utilidad.",
                items: [
                    { name: 'Jarra de Alquimia', price: 1000, type: 'Maravilloso', desc: 'Produce agua, vino, √°cido, mayonesa...', rarity: 'Rara' },
                    { name: 'Bast√≥n Inamovible', price: 2500, type: 'Barra', desc: 'Se queda fijo en el espacio al activarlo.', rarity: 'Rara' },
                    { name: 'Ara√±a Mec√°nica "Esp√≠a"', price: 1200, type: 'Constructo', desc: 'Controlable 100 pies. Transmite sonido.', rarity: 'Rara' },
                    { name: 'Caja de "Alarma"', price: 300, type: 'Objeto', desc: 'Sirena fuerte si detecta movimiento (20 pies).', rarity: 'Poco Com√∫n' },
                    { name: 'Gafas de "Zoom"', price: 500, type: 'Ojos', desc: 'Zoom x10. Ver detalles lejanos.', rarity: 'Poco Com√∫n' },
                    { name: 'Mechero "Lanzallamas"', price: 150, type: 'Herramienta', desc: 'Llama de 1 pie. 1d4 fuego.', rarity: 'Com√∫n' },
                    { name: 'Gancho "Autom√°tico"', price: 800, type: 'Herramienta', desc: 'Pistola gancho. Arrastra 30 pies arriba.', rarity: 'Poco Com√∫n' },
                    { name: 'Reloj "Exacto"', price: 200, type: 'Objeto', desc: 'Nunca atrasa. Alarma y fase lunar.', rarity: 'Com√∫n' },
                    { name: 'Abanico de "Viento"', price: 400, type: 'Maravilloso', desc: 'Crea r√°faga fuerte (no m√°gica).', rarity: 'Poco Com√∫n' },
                    { name: 'Paraca√≠das Emergencia', price: 600, type: 'Capa', desc: 'Abre al caer >20 pies. Un uso (reparable).', rarity: 'Poco Com√∫n' },
                    { name: 'Llave "Esqueleto"', price: 700, type: 'Herramienta', desc: '+5 abrir cerradura normal. Se rompe con 1.', rarity: 'Poco Com√∫n' },
                    { name: 'Bomba "Purpurina"', price: 150, type: 'Consumible', desc: 'Ciega y revela invisibles 10 pies.', rarity: 'Com√∫n' }
                ]
            },
            // ANILLO 2
            {
                id: 'vivarium',
                ring: 2,
                name: 'Vivarium de Mundos',
                subtitle: 'Mascotas Ex√≥ticas',
                themeClass: 'theme-vivarium',
                icon: 'fa-paw', bgIcon: 'fa-leaf',
                image: 'img/tiendas/vivarium_mundos_1765927385073.png',
                description: "Un invernadero m√°gico dimensional lleno de jungla y vida.",
                items: [
                    { name: 'Cr√≠a de F√©nix Azul', price: 6000, type: 'Eranol', desc: 'Otorga resitencia al da√±o por fr√≠o, si muere, explota curando a su due√±o (4d8 HP). Da luz y calor.', rarity: 'Ex√≥tica', image: 'img/EL VIVARIUM DE LOS MUNDOS/Cr√≠a de F√©nix Azul.png' },
                    { name: 'Perro de √ìnice', price: 3000, type: 'DMG', desc: 'Figurilla de Poder Maravilloso. Se transforma en mast√≠n real.', rarity: 'Rara', image: 'img/EL VIVARIUM DE LOS MUNDOS/Figurilla de Poder Maravilloso (Perro de √ìnice).png' },
                    { name: 'Mono "Ladr√≥n de Sombras"', price: 2500, type: 'Eranol', desc: 'Puede interactuar con objetos a 30 pies telequin√©ticamente. +5 a Juego de Manos.', rarity: 'Poco Com√∫n', image: 'img/EL VIVARIUM DE LOS MUNDOS/Mono Ladr√≥n de Sombras.png' },
                    { name: 'Slime "Limpiador"', price: 800, type: 'Eranol', desc: 'Se come el √≥xido y repara armaduras da√±adas durante el descanso largo (+1 AC temporal).', rarity: 'Com√∫n', image: 'img/EL VIVARIUM DE LOS MUNDOS/Slime Limpiador.png' },
                    { name: 'Bolsa de Trucos (Gris)', price: 2800, type: 'DMG', desc: 'Sacas bolas de pelo que se vuelven animales aleatorios.', rarity: 'Poco Com√∫n', image: 'img/EL VIVARIUM DE LOS MUNDOS/Bolsa de Trucos (Gris).png' },
                    { name: 'Serpiente de Tinta', price: 1500, type: 'Eranol', desc: 'Puede volverse un tatuaje en tu piel y salir para atacar (Veneno 1d6).', rarity: 'Poco Com√∫n', image: 'img/EL VIVARIUM DE LOS MUNDOS/Serpiente de Tinta.png' },
                    { name: 'B√∫ho de Cristal', price: 2200, type: 'Eranol', desc: 'Graba visualmente lo que ve y puede proyectarlo como un holograma.', rarity: 'Poco Com√∫n', image: 'img/EL VIVARIUM DE LOS MUNDOS/B√∫ho de Cristal.png' },
                    { name: 'Tortuga Fortaleza', price: 3500, type: 'Eranol', desc: 'Crece hasta tama√±o mediano y sirve de cobertura m√≥vil (+2 CA) para quien se esconda tras ella.', rarity: 'Rara', image: 'img/EL VIVARIUM DE LOS MUNDOS/Tortuga Fortaleza.png' },
                    { name: 'Peque√±o Elemental Tormenta', price: 4200, type: 'Eranol', desc: 'Una nube con ojos. Lanza Shocking Grasp a voluntad.', rarity: 'Rara', image: 'img/EL VIVARIUM DE LOS MUNDOS/Peque√±o Elemental de Tormenta.png' },
                    { name: 'Escarabajo Resurrecci√≥n', price: 5500, type: 'Eranol', desc: 'Un uso. Si el due√±o muere, el escarabajo se sacrifica para lanzar Revivify autom√°ticamente.', rarity: 'Muy Rara', image: 'img/EL VIVARIUM DE LOS MUNDOS/Escarabajo de la Resurrecci√≥n.png' }
                ]
            },
            {
                id: 'hilos',
                ring: 2,
                name: 'Sastrer√≠a Hilos del √âter',
                subtitle: 'Moda M√°gica',
                themeClass: 'theme-hilos',
                icon: 'fa-tshirt', bgIcon: 'fa-magic',
                image: 'img/tiendas/hilos_eter_1765927401749.png',
                description: "Elegancia silenciosa y telas que flotan solas. Ropa m√°gica para el aventurero distinguido.",
                items: [
                    { name: 'Capa de Desplazamiento', price: 5000, type: 'DMG', desc: 'Efecto visual de "blur", impone desventaja al atacar al portador.', rarity: 'Rara', image: 'img/SASTRER√çA HILOS DEL √âTER/Capa de Desplazamiento.png' },
                    { name: 'Alas de Vuelo', price: 5500, type: 'DMG', desc: 'Capa que se transforma en alas de murci√©lago o √°guila.', rarity: 'Rara', image: 'img/SASTRER√çA HILOS DEL √âTER/Alas de Volar.png' },
                    { name: 'T√∫nica de la Tormenta', price: 4500, type: 'Eranol', desc: 'Si te golpean, descargas 2d8 el√©ctricos al atacante. Flota un poco con el viento.', rarity: 'Rara', image: 'img/SASTRER√çA HILOS DEL √âTER/T√∫nica de la Tormenta.png' },
                    { name: 'Guantes "Ladr√≥n Hechizos"', price: 6000, type: 'Eranol', desc: 'Si eres blanco de un hechizo de nivel 1-2, puedes usar reacci√≥n para atraparlo y lanzarlo t√∫ en el siguiente turno.', rarity: 'Legendaria', image: 'img/SASTRER√çA HILOS DEL √âTER/Guantes del Ladr√≥n de Hechizos.png' },
                    { name: 'Botas "Caminar Aire"', price: 3800, type: 'Eranol', desc: 'Dejas huellas de luz. Puedes caminar por el aire (45 grados) como si fuera suelo.', rarity: 'Rara', image: 'img/SASTRER√çA HILOS DEL √âTER/Botas de Caminar sobre el Aire.png' },
                    { name: 'Capucha Verdugo An√≥nimo', price: 2500, type: 'Eranol', desc: 'Mientras la lleves puesta, nadie puede recordar tu cara ni tu voz 10 minutos despu√©s de verte.', rarity: 'Poco Com√∫n', image: 'img/SASTRER√çA HILOS DEL √âTER/Capucha del Verdugo An√≥nimo.png' },
                    { name: 'Cintur√≥n Gigante Colina', price: 5000, type: 'DMG', desc: 'Fuerza se vuelve 21.', rarity: 'Rara', image: 'img/SASTRER√çA HILOS DEL √âTER/Cintur√≥n de Fuerza de Gigante (Colina).png' },
                    { name: 'Traje "Presencia Real"', price: 3000, type: 'Eranol', desc: 'Los humanoides de CR bajo tienen desventaja para atacarte a menos que t√∫ los ataques primero (Aura de Majestad).', rarity: 'Rara', image: 'img/SASTRER√çA HILOS DEL √âTER/Vestido o Traje de la Presencia Real.png' },
                    { name: 'Bufanda Brazos Extra', price: 2200, type: 'Eranol', desc: 'Una bufanda larga que funciona como dos brazos extra (no atacan, pero pueden usar objetos, pociones o abrir puertas).', rarity: 'Poco Com√∫n', image: 'img/SASTRER√çA HILOS DEL √âTER/Bufanda de Brazos Extra.png' },
                    { name: 'M√°scara Mil Caras', price: 3500, type: 'Eranol', desc: 'Puedes lanzar Disguise Self a voluntad. La m√°scara se funde con tu piel.', rarity: 'Rara', image: 'img/SASTRER√çA HILOS DEL √âTER/M√°scara de las Mil Caras.png' }
                ]
            },
            {
                id: 'fragua',
                ring: 2,
                name: 'La Fragua Astral',
                subtitle: 'El Yunque de las Estrellas',
                themeClass: 'theme-fragua',
                icon: 'fa-fire-alt', bgIcon: 'fa-meteor',
                image: 'img/tiendas/fragua_astral_1765927429280.png',
                description: "Una plataforma de obsidiana flotando en el espacio profundo con un n√∫cleo estelar.",
                items: [
                    { name: 'Gran Espada "Eclipse Solar"', price: 5500, type: 'Eranol', desc: '(+2). Hoja negra como el vac√≠o. 1/d√≠a ciega enemigos en 10 pies al golpear (CON CD 15) excepto al portador.', rarity: 'Legendaria', image: 'img/LA FRAGUA ASTRAL/Eclipse Solar.png' },
                    { name: 'Arco "Susurro del Cometa"', price: 4200, type: 'Eranol', desc: '(+1). No usa flechas. Al tensar la cuerda, crea proyectiles de luz estelar. El da√±o es radiante y atraviesa enemigos en l√≠nea recta.', rarity: 'Rara', image: 'img/LA FRAGUA ASTRAL/Arco Susurro del Cometa.png' },
                    { name: 'Espada Larga Lengua de Fuego', price: 5000, type: 'DMG', desc: '(+2d6 fuego). La hoja parece hecha de lava s√≥lida que gotea pero no cae.', rarity: 'Rara', image: 'img/LA FRAGUA ASTRAL/Espada Larga Lengua de Fuego.png' },
                    { name: 'Dagas Gemelas "Fase Lunar"', price: 3800, type: 'Eranol', desc: '(+1). Si golpeas con ambas en el mismo turno, el objetivo se vuelve vulnerable al da√±o necr√≥tico hasta el fin de su siguiente turno.', rarity: 'Rara', image: 'img/LA FRAGUA ASTRAL/Dagas Gemelas Fase Lunar.png' },
                    { name: 'Martillo "Impacto de Meteoro"', price: 4500, type: 'Eranol', desc: 'Al sacar un cr√≠tico, el objetivo es empujado 20 pies hacia arriba y cae (da√±o de ca√≠da extra).', rarity: 'Rara', image: 'img/LA FRAGUA ASTRAL/Martillo de Guerra Impacto de Meteoro.png' },
                    { name: 'Jabalina del Rayo', price: 2500, type: 'DMG', desc: 'Se transforma en un rel√°mpago al lanzarse.', rarity: 'Poco Com√∫n', image: 'img/LA FRAGUA ASTRAL/Jabalina del Rayo.png' },
                    { name: 'L√°tigo de Nebulosa', price: 3000, type: 'Eranol', desc: 'Alcance 15 pies. Hecho de gas estelar. Ignora escudos y cobertura (AC base + Des).', rarity: 'Rara', image: 'img/LA FRAGUA ASTRAL/L√°tigo de Nebulosa.png' },
                    { name: 'Ballesta "Cazadora de Vac√≠o"', price: 4800, type: 'Eranol', desc: '(+2). Ventaja contra aberraciones y criaturas que se teletransportan.', rarity: 'Muy Rara', image: 'img/LA FRAGUA ASTRAL/Ballesta Cazadora de Vac√≠o.png' },
                    { name: 'Tridente C√≥smico', price: 1800, type: 'DMG', desc: 'Reflavoreado como Tridente C√≥smico. Control de criaturas acu√°ticas/espaciales.', rarity: 'Poco Com√∫n', image: 'img/LA FRAGUA ASTRAL/Tridente C√≥smico.png' },
                    { name: 'Guada√±a "Horizonte de Sucesos"', price: 6000, type: 'Eranol', desc: 'Si reduces a un enemigo a 0 HP, su cuerpo es absorbido por un micro-agujero negro, impidiendo que sea revivido f√°cilmente.', rarity: 'Legendaria', image: 'img/LA FRAGUA ASTRAL/Guada√±a Horizonte de Sucesos.png' }
                ]
            },
            {
                id: 'dragon',
                ring: 2,
                name: 'Nido del Drag√≥n',
                subtitle: 'Armaduras de Cristal',
                themeClass: 'theme-dragon',
                icon: 'fa-shield-alt', bgIcon: 'fa-dragon',
                image: 'img/tiendas/nido_dragon_1765927446552.png',
                description: "Construida dentro del esqueleto de un drag√≥n gargantuesco.",
                items: [
                    { name: 'Placas "Escamas de Ashmir"', price: 5800, type: 'Eranol', desc: '(+1). Armadura blanca. Si te golpean cuerpo a cuerpo, el atacante recibe 1d6 de da√±o fr√≠o (Reacci√≥n).', rarity: 'Muy Rara', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Placas de Escamas de Ashmir.png' },
                    { name: 'Armadura de Adamantina', price: 4500, type: 'DMG', desc: 'Completa. Inmune a golpes cr√≠ticos. Brilla con un tono verdoso oscuro.', rarity: 'Rara', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Armadura de Adamantina (Completa).png' },
                    { name: 'Escudo "Boca de Drag√≥n"', price: 3200, type: 'Eranol', desc: 'Tiene una cara esculpida. Como acci√≥n adicional, puedes hacer que muerda el arma del enemigo (Desarme, Fue CD 15).', rarity: 'Rara', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Escudo Boca de Drag√≥n.png' },
                    { name: 'Coraza de Magma Viviente', price: 4000, type: 'Eranol', desc: 'Otorga resistencia al fuego. Brilla en la oscuridad. Inspirada en Baran.', rarity: 'Rara', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Coraza de Magma Viviente.png' },
                    { name: 'Escudo Animado', price: 6000, type: 'DMG', desc: 'Flota a tu alrededor dej√°ndote las manos libres.', rarity: 'Muy Rara', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Escudo Animado.png' },
                    { name: 'Cuero Tachonado Camale√≥n', price: 2800, type: 'Eranol', desc: 'Te vuelves invisible si permaneces inm√≥vil contra una superficie s√≥lida por 1 asalto.', rarity: 'Poco Com√∫n', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Cuero Tachonado del Camale√≥n.png' },
                    { name: 'Casco "Mente de Hierro"', price: 3500, type: 'Eranol', desc: 'Inmunidad a da√±o ps√≠quico y lectura de pensamientos.', rarity: 'Rara', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Casco de la Mente de Hierro.png' },
                    { name: 'Cota de Malla √âlfica', price: 5000, type: 'DMG', desc: '(+1). Se considera armadura ligera.', rarity: 'Rara', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Cota de Malla √âlfica.png' },
                    { name: 'Botas "Paso de Gigante"', price: 2500, type: 'Eranol', desc: 'Una vez al minuto, puedes pisotear el suelo y derribar a criaturas Peque√±as o Medianas a 5 pies (Fue CD 14).', rarity: 'Poco Com√∫n', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Botas de Paso de Gigante.png' },
                    { name: 'Guanteletes del Tit√°n', price: 5500, type: 'Eranol', desc: 'Permiten empu√±ar armas de "Dos Manos" con una sola mano (con desventaja en el ataque).', rarity: 'Muy Rara', image: 'img/EL NIDO DEL DRAG√ìN DE CRISTAL/Guanteletes del Tit√°n.png' }
                ]
            },
            {
                id: 'cronos',
                ring: 2,
                name: 'Bazar del Cronometrista',
                subtitle: 'Artefactos Temporales',
                themeClass: 'theme-cronos',
                icon: 'fa-hourglass-half', bgIcon: 'fa-clock',
                image: 'https://images.unsplash.com/photo-1508057198894-247b9871aa9c?q=80&w=1469&auto=format&fit=crop',
                description: "Relojes de arena donde la arena cae hacia arriba. El tendero envejece y rejuvenece en bucle.",
                items: [
                    { name: 'Reloj "Segundo Chance"', price: 6000, type: 'Eranol', desc: 'Una vez al d√≠a, puedes volver a tirar un turno completo (movimiento y acci√≥n) como si nunca hubiera pasado.', rarity: 'Legendaria', image: 'img/EL BAZAR DEL CRONOMETRISTA/Reloj de Bolsillo del Segundo Chance.png' },
                    { name: 'Cubo de Fuerza', price: 5500, type: 'DMG', desc: 'Crea barreras invisibles impenetrables.', rarity: 'Rara', image: 'img/EL BAZAR DEL CRONOMETRISTA/Cubo de Fuerza.png' },
                    { name: 'Moneda Suerte Absoluta', price: 2000, type: 'Eranol', desc: 'Al lanzarla al aire antes de una tirada: Cara = Cr√≠tico autom√°tico / Cruz = Pifia autom√°tica (1 del dado).', rarity: 'Poco Com√∫n', image: 'img/EL BAZAR DEL CRONOMETRISTA/Moneda de la Suerte Absoluta.png' },
                    { name: 'Gafas Pasado Inmediato', price: 3000, type: 'Eranol', desc: 'Permiten ver "fantasmas" de lo que ocurri√≥ en la habitaci√≥n hace 10 minutos.', rarity: 'Rara', image: 'img/EL BAZAR DEL CRONOMETRISTA/Gafas del Pasado Inmediato.png' },
                    { name: 'Gema Visi√≥n Verdadera', price: 1500, type: 'DMG', desc: 'Un uso. Ves lo invisible y la verdad durante 10 min.', rarity: 'Consumible', image: 'img/EL BAZAR DEL CRONOMETRISTA/Gema de Visi√≥n Verdadera (Un uso).png' },
                    { name: 'Caja de Schr√∂dinger', price: 4000, type: 'Eranol', desc: 'Metes un objeto. Al abrirla 24h despu√©s, hay un 50% de que el objeto se haya duplicado o un 50% de que haya desaparecido.', rarity: 'Rara', image: 'img/EL BAZAR DEL CRONOMETRISTA/Caja de Schr√∂dinger.png' },
                    { name: 'Llave Maestra Espectral', price: 2500, type: 'Eranol', desc: 'Abre cualquier puerta, incluso m√°gica, pero alerta a todos los enemigos en 100 metros.', rarity: 'Poco Com√∫n', image: 'img/EL BAZAR DEL CRONOMETRISTA/Llave Maestra Espectral.png' },
                    { name: 'Guantelete de la Pausa', price: 5000, type: 'Eranol', desc: '1 vez al d√≠a, lanza Hold Monster (Paralizar Monstruo) tocando al objetivo.', rarity: 'Muy Rara', image: 'img/EL BAZAR DEL CRONOMETRISTA/Guantelete de la Pausa.png' },
                    { name: 'Frasco de Juventud', price: 800, type: 'Eranol', desc: 'Falso pero efectivo. Te cambia la apariencia f√≠sica para parecer 20 a√±os m√°s joven por 1 semana.', rarity: 'Com√∫n', image: 'img/EL BAZAR DEL CRONOMETRISTA/Frasco de Juventud (Falso pero efectivo).png' },
                    { name: 'Mapa del Futuro Posible', price: 3500, type: 'Eranol', desc: 'Muestra d√≥nde estar√°n los enemigos en el siguiente turno (Ventaja en ataques 1 ronda).', rarity: 'Rara', image: 'img/EL BAZAR DEL CRONOMETRISTA/Mapa del Futuro Posible.png' }
                ]
            },
            {
                id: 'liquida',
                ring: 2,
                name: 'Nebulosa L√≠quida',
                subtitle: 'Alquimia Avanzada',
                themeClass: 'theme-liquida',
                icon: 'fa-flask', bgIcon: 'fa-prescription-bottle',
                image: 'https://images.unsplash.com/photo-1555633514-abce6637170f?q=80&w=1470&auto=format&fit=crop',
                description: "Esferas de l√≠quido flotan en gravedad cero.",
                items: [
                    { name: 'Poci√≥n de Velocidad', price: 1200, type: 'DMG', desc: 'Efecto de Haste sin concentraci√≥n.', rarity: 'Muy Rara', image: 'img/LA NEBULOSA L√çQUIDA/Poci√≥n de Velocidad.png' },
                    { name: 'Aceite de Etereidad', price: 2500, type: 'DMG', desc: 'Te vuelves et√©reo durante 1 hora.', rarity: 'Rara', image: 'img/LA NEBULOSA L√çQUIDA/Aceite de Etereidad.png' },
                    { name: 'Sangre de Drag√≥n Rojo', price: 800, type: 'Eranol', desc: 'Al beberla, ganas aliento de fuego (4d6) por 1 minuto. Te vuelve la piel roja.', rarity: 'Poco Com√∫n', image: 'img/LA NEBULOSA L√çQUIDA/Sangre de Drag√≥n Rojo.png' },
                    { name: 'T√≥nico "Piel de Diamante"', price: 1500, type: 'Eranol', desc: 'Inmunidad al da√±o f√≠sico cortante/perforante/contundente durante 1 asalto.', rarity: 'Rara', image: 'img/LA NEBULOSA L√çQUIDA/T√≥nico de Piel de Diamante.png' },
                    { name: 'Vial "Silencio L√≠quido"', price: 600, type: 'Eranol', desc: 'Al romperlo, lanza Silencio en el √°rea. El humo es negro y pesado.', rarity: 'Poco Com√∫n', image: 'img/LA NEBULOSA L√çQUIDA/Vial de Silencio L√≠quido.png' },
                    { name: 'Elixir Descanso Instant√°neo', price: 3000, type: 'Eranol', desc: 'Obtienes los beneficios de un Descanso Largo en 10 minutos (1 vez por semana, t√≥xico si se abusa).', rarity: 'Muy Rara', image: 'img/LA NEBULOSA L√çQUIDA/Elixir del Descanso Instant√°neo.png' },
                    { name: 'Poci√≥n Clarividencia', price: 900, type: 'DMG', desc: 'Ves y oyes un lugar lejano.', rarity: 'Rara', image: 'img/LA NEBULOSA L√çQUIDA/Poci√≥n de Clarividencia.png' },
                    { name: 'Perfume de Dominio', price: 500, type: 'Eranol', desc: 'Ventaja en Intimidaci√≥n. Los animales huyen de ti.', rarity: 'Com√∫n', image: 'img/LA NEBULOSA L√çQUIDA/Perfume de Dominio.png' },
                    { name: 'Veneno "Sue√±o de Dioses"', price: 2000, type: 'Eranol', desc: 'Si se aplica al arma, CD 17 CON o el enemigo cae inconsciente 1 hora (o hasta recibir da√±o).', rarity: 'Rara', image: 'img/LA NEBULOSA L√çQUIDA/Veneno Sue√±o de los Dioses.png' },
                    { name: 'Bomba de Gravedad', price: 1800, type: 'Eranol', desc: 'Atrae a todos en 20 pies al centro y los aplasta (4d10 fuerza).', rarity: 'Rara', image: 'img/LA NEBULOSA L√çQUIDA/Bomba de Gravedad.png' }
                ]
            },
            {
                id: 'arcano',
                ring: 2,
                name: 'El Ojo del Arcano',
                subtitle: 'Varitas y Bastones',
                themeClass: 'theme-arcano',
                icon: 'fa-eye', bgIcon: 'fa-hat-wizard',
                image: 'https://images.unsplash.com/photo-1549557497-6a5c2ce94573?q=80&w=1374&auto=format&fit=crop',
                description: "Torre√≥n espiral con libros voladores.",
                items: [
                    { name: 'Varita Bolas de Fuego', price: 5500, type: 'DMG', desc: 'Cl√°sica y destructiva.', rarity: 'Rara', image: 'img/EL OJO DEL ARCANO/Varita de Bolas de Fuego.png' },
                    { name: 'Bast√≥n de la Defensa', price: 2500, type: 'DMG', desc: 'Armadura de Mago + Escudo.', rarity: 'Rara', image: 'img/EL OJO DEL ARCANO/Bast√≥n de la Defensa.png' },
                    { name: 'Cetro "Prisma de Hielo"', price: 4800, type: 'Eranol', desc: '3 cargas. Lanza Ice Storm. Si matas a alguien, se convierte en estatua de hielo.', rarity: 'Muy Rara', image: 'img/EL OJO DEL ARCANO/Cetro Prisma de Hielo.png' },
                    { name: 'Orbe "Mente Colmena"', price: 3000, type: 'Eranol', desc: 'Permite telepat√≠a ilimitada entre los miembros del grupo que toquen el orbe al inicio del d√≠a.', rarity: 'Rara', image: 'img/EL OJO DEL ARCANO/Orbe de la Mente Colmena.png' },
                    { name: 'Varita "Titiritero"', price: 2200, type: 'Eranol', desc: 'Lanza Command (Orden Imperiosa) como acci√≥n adicional (5 cargas).', rarity: 'Poco Com√∫n', image: 'img/EL OJO DEL ARCANO/Varita del Titiritero.png' },
                    { name: 'Bast√≥n "Ra√≠ces Profundas"', price: 3500, type: 'Eranol', desc: 'Puedes clavarlo en el suelo para crear un muro de espinas instant√°neo.', rarity: 'Rara', image: 'img/EL OJO DEL ARCANO/Bast√≥n de Ra√≠ces Profundas.png' },
                    { name: 'Perla de Poder', price: 4000, type: 'DMG', desc: 'Recuperas un espacio de conjuro de nivel 3.', rarity: 'Poco Com√∫n', image: 'img/EL OJO DEL ARCANO/Perla de Poder.png' },
                    { name: 'Guantelete Hechicero Guerra', price: 5000, type: 'Eranol', desc: 'Permite lanzar un truco como reacci√≥n si te atacan.', rarity: 'Rara', image: 'img/EL OJO DEL ARCANO/Guantelete del Hechicero de Guerra.png' },
                    { name: 'Pluma de F√©nix', price: 4200, type: 'Eranol', desc: 'Varita. +1 al ataque de hechizos de fuego. Ignora resistencia al fuego.', rarity: 'Rara', image: 'img/EL OJO DEL ARCANO/Pluma de F√©nix (Varita).png' },
                    { name: 'Foco "Doble Concentraci√≥n"', price: 6000, type: 'Eranol', desc: 'Objeto maldito/Riesgo. Permite concentrarse en 2 hechizos, pero si fallas la tirada de CON, recibes da√±o ps√≠quico y pierdes ambos.', rarity: 'Legendaria', image: 'img/EL OJO DEL ARCANO/Foco de Doble Concentraci√≥n.png' }
                ]
            },
            // ANILLO 3
            {
                id: 'armeria-sol',
                ring: 3,
                name: 'La Armer√≠a del Sol',
                subtitle: 'Armas de Prestigio',
                themeClass: 'theme-gold',
                icon: 'fa-sun', bgIcon: 'fa-sword',
                image: 'https://images.unsplash.com/photo-1544979590-37e9b47cd705?q=80&w=1374&auto=format&fit=crop',
                description: "Un sal√≥n de m√°rmol blanco donde las armas no se tocan.",
                items: [
                    { name: 'Espada "Justicia del Rey" (+2)', price: 15000, type: 'Arma', desc: 'Cr√≠tico: Curas a un aliado.', rarity: 'Muy Rara' },
                    { name: 'Martillo "Rompe-Asedios" (+2)', price: 18000, type: 'Arma', desc: 'Doble da√±o estructuras. 1/d√≠a derribas a todos en 20 pies (FUE CD 16).', rarity: 'Muy Rara' },
                    { name: 'Arco "Ojo del Halc√≥n Real" (+2)', price: 22000, type: 'Arma', desc: 'Ignora cobertura media/3/4. Si no te mueves, alcance duplicado.', rarity: 'Legendaria' },
                    { name: 'Lanza "Perforadora de Escamas" (+2)', price: 14000, type: 'Arma', desc: '+2 extra al ataque contra armadura natural (Dragones).', rarity: 'Muy Rara' },
                    { name: 'Daga "Corte de Vac√≠o" (+2)', price: 28000, type: 'Arma', desc: 'Da√±o de Fuerza. Corta muros de fuerza o barreras m√°gicas.', rarity: 'Legendaria' },
                    { name: 'Gran Hacha "Verdugo de Titanes" (+2)', price: 20000, type: 'Arma', desc: 'Dado de da√±o extra contra criaturas Grandes o mayores.', rarity: 'Legendaria' },
                    { name: 'Estoque "Danza de la Rosa" (+2)', price: 25000, type: 'Arma', desc: 'Reacci√≥n: Ataque oportunidad si un enemigo te ataca y falla.', rarity: 'Legendaria' },
                    { name: 'Ballesta "Repetidora Imperial" (+2)', price: 30000, type: 'Arma', desc: 'Sin recarga. Dispara 3 virotes/acci√≥n con -5 al acierto.', rarity: 'Nacional' }
                ]
            },
            {
                id: 'forja-mithral',
                ring: 3,
                name: 'La Forja de Mithral',
                subtitle: 'Armaduras de √âlite',
                themeClass: 'theme-gold',
                icon: 'fa-shield-alt', bgIcon: 'fa-hammer',
                image: 'https://images.unsplash.com/photo-1514539079130-25950c84af65?q=80&w=1469&auto=format&fit=crop',
                description: "Aqu√≠ no huele a humo, huele a ozono.",
                items: [
                    { name: 'Placas de "Luz S√≥lida"', price: 25000, type: 'Armadura', desc: 'Pesada (CA 19). No pesa nada.', rarity: 'Legendaria' },
                    { name: 'Escudo "Muralla de los Ca√≠dos" (+2)', price: 18000, type: 'Escudo', desc: 'Acci√≥n: Se clava y crea muro de cobertura total de 10 pies.', rarity: 'Muy Rara' },
                    { name: 'Coraza "Piel de Drag√≥n Sint√©tica"', price: 22000, type: 'Media', desc: 'Resistencia elemental cambiable tras descanso largo.', rarity: 'Legendaria' },
                    { name: 'Malla de "Evasi√≥n Arcana"', price: 15000, type: 'Ligera', desc: 'Ventaja en salvaci√≥n DEX contra hechizos de √°rea.', rarity: 'Muy Rara' },
                    { name: 'Yelmo del "Estratega Supremo"', price: 20000, type: 'Casco', desc: 'Telepat√≠a 6 aliados (1km). Inmune a Sorpresa.', rarity: 'Legendaria' },
                    { name: 'Brazales de la "Monta√±a"', price: 28000, type: 'Accesorio', desc: '+2 CA (sin armadura). Inmune a empujones/derribos.', rarity: 'Legendaria' },
                    { name: 'Escudo "Espejo de Eranol" (+1)', price: 16000, type: 'Escudo', desc: '1/d√≠a refleja ataque radiante/luz al atacante.', rarity: 'Muy Rara' }
                ]
            },
            {
                id: 'ateneo-archimagos',
                ring: 3,
                name: 'Ateneo de Archimagos',
                subtitle: 'Focos y Bastones',
                themeClass: 'theme-gold',
                icon: 'fa-university', bgIcon: 'fa-scroll',
                image: 'https://images.unsplash.com/photo-1549144365-c3c734919597?q=80&w=1374&auto=format&fit=crop',
                description: "Una torre de cristal flotante.",
                items: [
                    { name: 'Bast√≥n "Canalizador de Flujo" (+2)', price: 25000, type: 'Bast√≥n', desc: '1/d√≠a recuperas slot Nivel 4.', rarity: 'Legendaria' },
                    { name: 'Orbe de la "Mente Dual"', price: 20000, type: 'Foco', desc: '3/d√≠a repites tirada de Concentraci√≥n fallida.', rarity: 'Legendaria' },
                    { name: 'Varita del "Asedio Arcano"', price: 15000, type: 'Varita', desc: '+100 pies alcance hechizos da√±o. Ignora cobertura media.', rarity: 'Muy Rara' },
                    { name: 'Cristal de "Metamagia Pura"', price: 18000, type: 'Foco', desc: '3/d√≠a aplica Sutil o Potenciado sin ser hechicero.', rarity: 'Muy Rara' },
                    { name: 'Grimorio "Memoria Fotogr√°fica"', price: 22000, type: 'Libro', desc: 'Mitad coste/tiempo copiar. +1 hechizo preparado.', rarity: 'Legendaria' },
                    { name: 'Cetro del "Dominio Elemental"', price: 30000, type: 'Cetro', desc: 'Elige elemento. Ignora resistencia (no inmunidad).', rarity: 'Nacional' },
                    { name: 'Amuleto "Bater√≠a de Man√°"', price: 28000, type: 'Collar', desc: 'Almacena 5 niveles de hechizos para lanzar despu√©s.', rarity: 'Legendaria' }
                ]
            },
            {
                id: 'clinica-perfeccion',
                ring: 3,
                name: 'Cl√≠nica de la Perfecci√≥n',
                subtitle: 'Mejoras Corporales',
                themeClass: 'theme-gold',
                icon: 'fa-heartbeat', bgIcon: 'fa-dna',
                image: 'https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?q=80&w=1453&auto=format&fit=crop',
                description: "Un templo de sanaci√≥n avanzada.",
                items: [
                    { name: 'Tatuaje "Escudo de Man√°"', price: 15000, type: 'Tatuaje', desc: '1/d√≠a +30 HP temporales.', rarity: 'Muy Rara' },
                    { name: 'Injerto "Pulmones de Trit√≥n"', price: 10000, type: 'Injerto', desc: 'Respiraci√≥n acu√°tica permanente y voz bajo agua.', rarity: 'Rara' },
                    { name: 'Ojos "Cazador Nocturno"', price: 18000, type: 'Injerto', desc: 'Visi√≥n oscuridad 120ft. Ves a trav√©s de niebla m√°gica.', rarity: 'Muy Rara' },
                    { name: 'Coraz√≥n "Reforzado"', price: 20000, type: 'Injerto', desc: 'Ventaja salvaci√≥n Veneno/Enfermedad. Auto-estabilizar a 0 HP.', rarity: 'Legendaria' },
                    { name: 'Tatuaje "Alas de Energ√≠a"', price: 22000, type: 'Tatuaje', desc: '1/d√≠a Vuelo 40 pies por 10 min.', rarity: 'Legendaria' },
                    { name: 'Injerto "Gl√°ndula Adrenalina"', price: 25000, type: 'Injerto', desc: '+5 Iniciativa permanente.', rarity: 'Legendaria' },
                    { name: 'Sangre "Limpiadora"', price: 30000, type: 'Injerto', desc: 'Inmune a la condici√≥n de Paralizado.', rarity: 'Nacional' }
                ]
            },
            {
                id: 'establos-aereos',
                ring: 3,
                name: 'Los Establos A√©reos',
                subtitle: 'Monturas Ex√≥ticas',
                themeClass: 'theme-gold',
                icon: 'fa-feather-alt', bgIcon: 'fa-wind',
                image: 'https://images.unsplash.com/photo-1594935272634-934c204d0c96?q=80&w=1374&auto=format&fit=crop',
                description: "Plataformas en los tejados.",
                items: [
                    { name: 'Grifo de la Guardia', price: 12000, type: 'Montura', desc: 'Voladora leal.', rarity: 'Muy Rara' },
                    { name: 'Wyvern "Sin Aguij√≥n"', price: 18000, type: 'Montura', desc: 'M√°s r√°pido que grifo, carga peso. Sin veneno.', rarity: 'Legendaria' },
                    { name: 'Caballo Mec√°nico "Modelo V"', price: 15000, type: 'Constructo', desc: 'No come/duerme. Vel 80 pies. Inmune miedo.', rarity: 'Muy Rara' },
                    { name: 'Oso Lechuza Acorazado', price: 14000, type: 'Montura', desc: 'Tanque (AC 18). Ideal para cargas.', rarity: 'Muy Rara' },
                    { name: 'Alfombra Voladora (De Lujo)', price: 20000, type: 'Objeto', desc: 'Para 2 personas. Vuelo suave y silencioso.', rarity: 'Legendaria' },
                    { name: 'Carruaje Flotante', price: 25000, type: 'Veh√≠culo', desc: 'Tirado por caballos invisibles. Flota 5 pies.', rarity: 'Legendaria' },
                    { name: 'Esfera Transporte Gn√≥mica', price: 30000, type: 'Veh√≠culo', desc: 'Cerrado para 4. Rueda r√°pido y flota en agua.', rarity: 'Nacional' }
                ]
            },
            {
                id: 'boveda-reliquias',
                ring: 3,
                name: 'B√≥veda de Reliquias',
                subtitle: 'Artefactos de Utilidad',
                themeClass: 'theme-gold',
                icon: 'fa-landmark', bgIcon: 'fa-box-open',
                image: 'https://images.unsplash.com/photo-1566127444979-b3d2b654e3d7?q=80&w=1470&auto=format&fit=crop',
                description: "Un museo donde puedes comprar la historia.",
                items: [
                    { name: 'Cubo "Fortaleza Instant√°nea"', price: 20000, type: 'Maravilloso', desc: 'Torre piedra 20 pies con puerta.', rarity: 'Legendaria' },
                    { name: 'Estandarte "Valor Infinito"', price: 25000, type: 'Maravilloso', desc: 'Plantado: Aliados 30ft inmunes Miedo y +2 da√±o.', rarity: 'Legendaria' },
                    { name: 'Espejo "Comunicaci√≥n Real"', price: 15000, type: 'Maravilloso', desc: 'Pareja. Videollamada ilimitada con el otro.', rarity: 'Muy Rara' },
                    { name: 'Mapa "Explorador Divino"', price: 18000, type: 'Maravilloso', desc: 'Topograf√≠a 10 millas, incluye entradas secretas.', rarity: 'Legendaria' },
                    { name: 'Cuerno "Refuerzo Fantasma"', price: 28000, type: 'Maravilloso', desc: '1/semana invoca 4 guerreros espectrales 1 min.', rarity: 'Legendaria' },
                    { name: 'Llave "Maestra de Eranol"', price: 30000, type: 'Maravilloso', desc: 'Abre cualquier cerradura no m√°gica de la ciudad.', rarity: 'Nacional' },
                    { name: 'Brasero "Control Clim√°tico"', price: 22000, type: 'Maravilloso', desc: 'Cambia clima en 1 milla (10 min cast).', rarity: 'Legendaria' }
                ]
            },
            {
                id: 'joyeria-diamante',
                ring: 3,
                name: 'Joyer√≠a Alma de Diamante',
                subtitle: 'Accesorios',
                themeClass: 'theme-gold',
                icon: 'fa-gem', bgIcon: 'fa-ring',
                image: 'https://images.unsplash.com/photo-1601121141461-9d6647bca1ed?q=80&w=1463&auto=format&fit=crop',
                description: "La tienda m√°s cara por metro cuadrado.",
                items: [
                    { name: 'Anillo "Regeneraci√≥n Menor"', price: 30000, type: 'Anillo', desc: 'Recuperas 1 HP/minuto.', rarity: 'Nacional' },
                    { name: 'Amuleto "Protecci√≥n Muerte"', price: 25000, type: 'Collar', desc: '1¬™ vez a 0 HP/d√≠a, te quedas a 1 HP.', rarity: 'Legendaria' },
                    { name: 'Brazalete "Cazador Magos"', price: 22000, type: 'Accesorio', desc: 'Ventaja salvaci√≥n vs hechizos a 5 pies.', rarity: 'Legendaria' },
                    { name: 'Anillo de "Acci√≥n Libre"', price: 28000, type: 'Anillo', desc: 'Inmune Paralizado y Restringido por magia.', rarity: 'Legendaria' },
                    { name: 'Collar "Adaptaci√≥n Total"', price: 18000, type: 'Collar', desc: 'Respiras en cualquier entorno, inmune gases.', rarity: 'Muy Rara' },
                    { name: 'Anillo "Fuerza de Toro"', price: 20000, type: 'Anillo', desc: 'Fuerza +2 (m√°x 22).', rarity: 'Legendaria' },
                    { name: 'Tiara "Intelecto Despierto"', price: 20000, type: 'Casco', desc: 'Inteligencia +2 (m√°x 22).', rarity: 'Legendaria' }
                ]
            }
        ];

        // --- STATE ---
        let currentAdventurer = null;
        let currentUserMaxRing = 1; // Default access
        let cart = [];
        let activeShops = [];
        let currentShopIndex = 0;
        let currentItem = null;
        let activeDiscount = 0;
        let hasSpunWheel = false;
        let loginAttempts = 0;
        const MAX_ATTEMPTS = 3;

        // --- USER DATABASE ---
        const knownUsers = {
            "khan": { rank: "D", maxRing: 1, title: "Aventurero Novato" },
            "volibeer": { rank: "D", maxRing: 1, title: "Guerrero Oso" },
            "m": { rank: "D", maxRing: 1, title: "Misterioso" },
            "ulume": { rank: "D", maxRing: 1, title: "Erudito" }
        };

        // --- DOM ELEMENTS ---
        const adventurerLoginScreen = document.getElementById('adventurer-login');
        const landingScreen = document.getElementById('landing-screen');
        const appScreen = document.getElementById('app');
        const loginModal = document.getElementById('login-modal');
        const loginMsg = document.getElementById('login-msg');
        const penaltyOverlay = document.getElementById('penalty-overlay');
        const appRingTitle = document.getElementById('app-ring-title');
        const appRingSubtitle = document.getElementById('app-ring-subtitle');
        const navContainer = document.getElementById('shop-nav');
        const shopTitle = document.getElementById('shop-title');
        const shopDesc = document.getElementById('shop-desc');
        const shopIcon = document.getElementById('shop-icon');
        const bgIcon = document.getElementById('bg-icon');
        const inventoryGrid = document.getElementById('inventory-grid');
        const appContainer = document.getElementById('app');
        const emptyRingMsg = document.getElementById('empty-ring-msg');
        const displayUsername = document.getElementById('display-username');
        const advNameInput = document.getElementById('adv-name-input');

        // Modal Elements
        const itemModal = document.getElementById('item-modal');
        const itemModalContent = document.getElementById('item-modal-content');
        const modalTitle = document.getElementById('modal-title');
        const modalDesc = document.getElementById('modal-desc');
        const modalPrice = document.getElementById('modal-price');
        const modalType = document.getElementById('modal-type');
        const modalRarity = document.getElementById('modal-rarity');
        const modalAddBtn = document.getElementById('modal-add-btn');
        const modalHeaderBg = document.getElementById('modal-header-bg');
        const modalIcon = document.getElementById('modal-icon');

        // Patronage Modal
        const patronageModal = document.getElementById('patronage-modal');
        const patronageArea = document.getElementById('patronage-area');

        // Wheel Elements (Fortune)
        const wheelModal = document.getElementById('wheel-modal');
        const wheelContainer = document.getElementById('wheel');
        const wheelResult = document.getElementById('wheel-result');
        const spinBtn = document.getElementById('spin-btn');
        const wheelBtn = document.getElementById('wheel-btn');

        // Cart Elements
        const cartSidebar = document.getElementById('cart-sidebar');
        const cartCount = document.getElementById('cart-count');
        const cartItemsContainer = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        const discountRow = document.getElementById('discount-row');
        const discountAmount = document.getElementById('discount-amount');
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toast-msg');
        const goldDisplay = document.getElementById('gold-display');

        // --- RARITY COLORS MAP ---
        const rarityColors = {
            'Com√∫n': '#9ca3af', 'Poco Com√∫n': '#22c55e', 'Rara': '#3b82f6',
            'Muy Rara': '#a855f7', 'Legendaria': '#fbbf24', 'Ex√≥tica': '#f43f5e',
            'Consumible': '#2dd4bf', 'M√°gico': '#60a5fa', 'Ilegal': '#ef4444',
            'Prohibido': '#000000', 'Pacto': '#881337', 'Caos': '#7c3aed', 'Nacional': '#fbbf24'
        };

        // --- LOGIC: LOGIN & NAV ---
        function loginAdventurer() {
            const nameInput = advNameInput.value.trim();
            if (!nameInput) { alert("Por favor, introduce un nombre."); return; }

            // Normalize for lookup
            const lowerName = nameInput.toLowerCase();
            const userData = knownUsers[lowerName];

            currentAdventurer = nameInput; // Keep original casing for display
            displayUsername.innerText = nameInput;

            if (userData) {
                currentUserMaxRing = userData.maxRing;
                showToast(`Identificado: ${userData.title} (Rango ${userData.rank})`);
            } else {
                currentUserMaxRing = 1; // Default for strangers
                // showToast(`Identificado: Viajero Desconocido`);
            }

            updateGoldDisplay();
            adventurerLoginScreen.classList.add('animate-fade-out');
            setTimeout(() => {
                adventurerLoginScreen.classList.add('hidden');
                landingScreen.classList.remove('hidden');
                landingScreen.classList.remove('opacity-0', 'scale-95');
                landingScreen.classList.add('animate-fade-in');
            }, 500);
        }

        function enterMarket(ringLevel) {
            // Access Control Check
            if (ringLevel !== 0 && ringLevel > currentUserMaxRing) {
                showToast("‚õî ACCESO DENEGADO: Rango Insuficiente");
                // Optional: Shake animation or sound
                return;
            }

            activeShops = allShops.filter(s => s.ring === ringLevel);
            let ringName = "", ringSub = "";
            if (ringLevel === 1) { ringName = "El Mercado de Hierro"; ringSub = "Anillo 1 (Rangos E-D)"; }
            if (ringLevel === 2) { ringName = "La Plaza de Plata"; ringSub = "Anillo 2 (Rangos C-B)"; }
            if (ringLevel === 3) { ringName = "La Cumbre Dorada"; ringSub = "Anillo 3 (Rangos A-S)"; }
            if (ringLevel === 0) { ringName = "Mercado Negro"; ringSub = "Anillo 0 (Sin Ley)"; }

            appRingTitle.innerText = ringName;
            appRingSubtitle.innerText = ringSub;
            if (ringLevel === 0) patronageArea.classList.remove('hidden'); else patronageArea.classList.add('hidden');

            landingScreen.classList.add('animate-fade-out');
            setTimeout(() => {
                landingScreen.classList.add('hidden');
                appScreen.classList.remove('hidden');
                void appScreen.offsetWidth;
                appScreen.classList.remove('opacity-0', 'scale-95');
                appScreen.classList.add('animate-fade-in');
                if (activeShops.length > 0) {
                    emptyRingMsg.classList.add('hidden');
                    navContainer.classList.remove('hidden');
                    renderNav();
                    loadShop(0);
                } else {
                    navContainer.innerHTML = '';
                    shopTitle.innerText = "";
                    inventoryGrid.innerHTML = "";
                    emptyRingMsg.classList.remove('hidden');
                }
            }, 500);
        }

        function exitMarket() {
            appScreen.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                appScreen.classList.add('hidden');
                landingScreen.classList.remove('hidden', 'animate-fade-out');
                landingScreen.classList.add('animate-fade-in');
            }, 500);
        }

        // --- AUTH ---
        function openLoginModal() { loginModal.classList.remove('hidden'); document.getElementById('login-user').value = ''; document.getElementById('login-pass').value = ''; loginMsg.innerText = ''; }
        function closeLoginModal() { loginModal.classList.add('hidden'); }
        function attemptLogin() {
            const user = document.getElementById('login-user').value.trim();
            const pass = document.getElementById('login-pass').value.trim();
            if ((user === "Sombra" && pass === "1234") || (user === "Asolador" && pass === "Asolador")) {
                closeLoginModal();
                showToast(`Bienvenido, ${user}.`);
                loginAttempts = 0;
                enterMarket(0);
            } else {
                loginAttempts++;
                if (loginAttempts >= MAX_ATTEMPTS) {
                    loginMsg.innerText = "¬°BLOQUEO M√ÅGICO!";
                    penaltyOverlay.classList.remove('hidden');
                    document.body.classList.add('animate-glitch');
                    setTimeout(() => {
                        penaltyOverlay.classList.add('hidden');
                        document.body.classList.remove('animate-glitch');
                        loginAttempts = 0;
                        closeLoginModal();
                    }, 3000);
                } else loginMsg.innerText = `Acceso denegado.`;
            }
        }

        // --- RENDER NAV ---
        function renderNav() {
            navContainer.innerHTML = '';
            const isRingZero = activeShops.length > 0 && activeShops[0].ring === 0;
            if (isRingZero) navContainer.className = "flex-1 overflow-y-auto p-6 ring0-bg-pattern space-y-6 overflow-x-hidden";
            else navContainer.className = "flex-1 overflow-y-auto p-4 space-y-4";

            activeShops.forEach((shop, index) => {
                const btn = document.createElement('button');
                const isActive = index === currentShopIndex;
                if (isRingZero) {
                    const randomRot = (index % 2 === 0 ? 1 : -1) * (2 + (index % 3));
                    btn.className = `w-full h-24 ring0-card relative rounded group text-left overflow-hidden ${isActive ? 'active' : ''}`;
                    btn.style.transform = isActive ? 'scale(1.1) rotate(0deg)' : `rotate(${randomRot}deg)`;
                    btn.innerHTML = `<div class="absolute inset-0 bg-black/80 group-hover:bg-black/40 transition-colors duration-300"></div><div class="relative z-10 h-full p-3 flex flex-col justify-between"><div class="flex justify-between items-start"><div class="bg-black/80 backdrop-blur text-red-500 border border-red-900/50 px-2 py-1 text-[10px] font-mono uppercase tracking-widest flex items-center gap-2"><i class="fas ${shop.icon}"></i> CLASIFICADO</div>${isActive ? '<div class="w-2 h-2 bg-red-500 rounded-full animate-ping"></div>' : ''}</div><div class="bg-black/90 p-2 border-l-2 border-red-600 transform translate-y-2 group-hover:translate-y-0 transition-transform"><div class="font-bold text-gray-200 text-sm leading-none font-mono uppercase truncate">${shop.name}</div><div class="text-[9px] text-red-400/70 mt-1 truncate font-mono">ID: ${shop.id.toUpperCase()}</div></div></div>`;
                } else {
                    btn.className = `relative w-full h-28 rounded-xl overflow-hidden text-left flex items-end p-4 transition-all duration-500 group border border-transparent ${isActive ? 'shadow-[0_0_25px_rgba(255,255,255,0.15)] scale-105 ring-1 ring-white/50 z-10' : 'hover:scale-[1.02] hover:shadow-lg opacity-80 hover:opacity-100'}`;
                    btn.innerHTML = `<div class="absolute inset-0 bg-gradient-to-t from-black via-black/60 to-transparent transition-opacity duration-300 ${isActive ? 'opacity-90' : 'opacity-80 group-hover:opacity-70'}"></div><div class="absolute top-3 right-3 w-8 h-8 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/10 group-hover:bg-white/20 transition-all"><i class="fas ${shop.icon} text-xs text-white/80"></i></div><div class="relative z-10 w-full"><div class="text-[9px] font-bold uppercase tracking-[0.2em] text-white/60 mb-1 border-l-2 border-white/30 pl-2 group-hover:border-white/80 transition-colors">${shop.subtitle}</div><div class="font-cinzel font-bold text-lg text-white leading-none drop-shadow-md">${shop.name}</div></div>${isActive ? '<div class="absolute inset-0 border-2 border-white/20 rounded-xl pointer-events-none"></div>' : ''}`;
                }
                if (shop.image) { btn.style.backgroundImage = `url('${shop.image}')`; btn.style.backgroundSize = 'cover'; btn.style.backgroundPosition = 'center'; }
                btn.onclick = () => loadShop(index);
                navContainer.appendChild(btn);
            });
        }

        function loadShop(index) {
            currentShopIndex = index;
            const shop = activeShops[index];
            if (!shop) return;

            if (shop.specialType === 'casino') {
                inventoryGrid.parentElement.classList.add('hidden');
                document.getElementById('casino-view').classList.remove('hidden');
                shopTitle.innerText = shop.name;
                shopDesc.innerHTML = `<span class="accent-text font-bold block mb-1 text-lg">${shop.subtitle}</span>${shop.description}`;
                shopIcon.innerHTML = `<i class="fas ${shop.icon} accent-text"></i>`;
                bgIcon.innerHTML = `<i class="fas ${shop.bgIcon}"></i>`;
                appContainer.className = `relative z-10 flex flex-col md:flex-row h-full transition-colors duration-500 ${shop.themeClass}`;
                renderNav();
                // Init wheel if needed
                drawRouletteWheel();
                return;
            }

            document.getElementById('casino-view').classList.add('hidden');
            inventoryGrid.parentElement.classList.remove('hidden');
            appContainer.className = `relative z-10 flex flex-col md:flex-row h-full transition-colors duration-500 ${shop.themeClass}`;
            renderNav();

            shopTitle.innerText = shop.name;
            shopDesc.innerHTML = `<span class="accent-text font-bold block mb-1 text-lg">${shop.subtitle}</span>${shop.description}`;
            shopIcon.innerHTML = `<i class="fas ${shop.icon} accent-text"></i>`;
            bgIcon.innerHTML = `<i class="fas ${shop.bgIcon}"></i>`;

            inventoryGrid.innerHTML = '';
            shop.items.forEach((item, i) => {
                const card = document.createElement('div');
                card.className = `glass-panel p-5 rounded-xl border-t border-white/10 relative overflow-hidden item-card group animate-fade-in`;
                card.style.animationDelay = `${i * 0.05}s`;
                const rarityColor = rarityColors[item.rarity] || rarityColors['M√°gico'];
                card.style.setProperty('--rarity-color', rarityColor);
                if (item.image) { card.style.backgroundImage = `url('${item.image}')`; card.classList.add('has-image'); }
                card.innerHTML = `<div class="absolute top-0 right-0 p-2 opacity-50 group-hover:opacity-100 transition-opacity"><i class="fas fa-sparkles text-xs" style="color: ${rarityColor}"></i></div><div class="flex justify-between items-start mb-2"><span class="text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded bg-black/40 text-gray-400 border border-white/5">${item.type}</span><span class="text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded shadow-lg" style="color: ${rarityColor}; background: ${rarityColor}20; border: 1px solid ${rarityColor}40">${item.rarity || 'M√°gico'}</span></div><h3 class="font-cinzel text-lg font-bold text-white mb-1 group-hover:brightness-125 transition-all leading-tight drop-shadow-md">${item.name}</h3><div class="flex items-baseline gap-1 mb-3"><i class="fas fa-coins text-yellow-500 text-xs"></i><span class="text-yellow-400 font-mono font-bold">${item.price.toLocaleString()}</span></div><p class="text-sm text-gray-400 leading-relaxed border-t border-white/10 pt-2 group-hover:text-gray-300 line-clamp-3">${item.desc}</p><button class="item-details-btn w-full mt-4 py-2 rounded border border-white/20 hover:bg-white/10 hover:border-white/40 text-xs uppercase tracking-widest transition-all flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 cursor-pointer backdrop-blur-md"><i class="fas fa-scroll"></i> Detalles</button>`;
                card.querySelector('.item-details-btn').onclick = () => openItemModal(item);
                inventoryGrid.appendChild(card);
            });
        }

        // --- MODAL ---
        function openItemModal(item) {
            currentItem = item;
            const rarityColor = rarityColors[item.rarity] || rarityColors['M√°gico'];
            modalTitle.textContent = item.name; modalDesc.textContent = item.desc; modalPrice.textContent = item.price.toLocaleString(); modalType.textContent = item.type; modalRarity.textContent = item.rarity || 'M√°gico';
            modalRarity.style.color = rarityColor; modalRarity.style.background = `${rarityColor}20`; modalRarity.style.borderColor = `${rarityColor}40`;
            itemModalContent.style.border = `1px solid ${rarityColor}`;
            if (item.image) { modalHeaderBg.style.backgroundImage = `url('${item.image}')`; modalIcon.style.opacity = '0'; } else { modalHeaderBg.style.backgroundImage = 'none'; modalHeaderBg.style.backgroundColor = `${rarityColor}40`; modalIcon.style.opacity = '1'; }
            itemModal.classList.remove('hidden'); setTimeout(() => { itemModal.classList.remove('opacity-0'); itemModalContent.classList.add('scale-100'); }, 10);
            modalAddBtn.onclick = () => { addToCart(item); closeModal(); };
        }
        function closeModal() { itemModal.classList.add('opacity-0'); itemModalContent.classList.remove('scale-100'); setTimeout(() => itemModal.classList.add('hidden'), 300); }

        // --- CART ---
        function addToCart(item) { cart.push(item); updateCartUI(); showToast(`"${item.name}" a√±adido.`); }
        function removeFromCart(index) { cart.splice(index, 1); updateCartUI(); }
        function toggleCart() { cartSidebar.classList.toggle('translate-x-full'); }
        function updateCartUI() {
            cartCount.innerText = cart.length; if (cart.length > 0) cartCount.classList.remove('hidden'); else cartCount.classList.add('hidden');
            let total = cart.reduce((sum, i) => sum + i.price, 0);
            if (activeDiscount > 0) { discountRow.classList.remove('hidden'); discountAmount.innerText = `-${(activeDiscount * 100)}%`; total = total * (1 - activeDiscount); } else discountRow.classList.add('hidden');
            cartTotal.innerText = Math.round(total).toLocaleString();
            cartItemsContainer.innerHTML = '';
            cart.forEach((item, index) => {
                const el = document.createElement('div');
                el.className = 'flex justify-between items-center bg-white/5 p-3 rounded-lg border border-white/5';
                el.innerHTML = `<div><div class="text-sm font-bold text-gray-200">${item.name}</div><div class="text-xs text-yellow-500">${item.price.toLocaleString()} mo</div></div><button onclick="removeFromCart(${index})" class="text-red-400 hover:text-red-300"><i class="fas fa-trash-alt"></i></button>`;
                cartItemsContainer.appendChild(el);
            });
        }
        function checkout() { if (cart.length === 0) return; let total = Math.round(cart.reduce((s, i) => s + i.price, 0) * (1 - activeDiscount)); if (userGold >= total) { userGold -= total; updateGoldDisplay(); alert('¬°Compra realizada!'); cart = []; updateCartUI(); toggleCart(); } else alert('No tienes suficiente oro.'); }
        function updateGoldDisplay() { goldDisplay.innerText = userGold.toLocaleString(); }
        function showToast(msg) { toastMsg.innerText = msg; toast.classList.remove('translate-y-20'); setTimeout(() => toast.classList.add('translate-y-20'), 3000); }

        // --- CASINO LOGIC ---
        let currentCasinoGame = null;
        function loadGame(game) { document.getElementById('casino-menu').classList.add('hidden'); document.getElementById(`game-${game}`).classList.remove('hidden'); currentCasinoGame = game; if (game === 'roulette') initRouletteGrid(); }
        function exitGame() { if (currentCasinoGame) document.getElementById(`game-${currentCasinoGame}`).classList.add('hidden'); document.getElementById('casino-menu').classList.remove('hidden'); currentCasinoGame = null; }

        // --- REAL EUROPEAN ROULETTE LOGIC (CANVAS) ---
        const rouletteNumbers = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const colors = { 0: '#35654d' }; // Green
        // Fill Reds
        [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36].forEach(n => colors[n] = '#991b1b');
        // Fill Blacks (Default for others)
        for (let i = 1; i <= 36; i++) { if (!colors[i]) colors[i] = '#171717'; }

        let startAngle = 0;
        let arc = Math.PI / (rouletteNumbers.length / 2);
        let spinTimeout = null;
        let spinArcStart = 10;
        let spinTime = 0;
        let spinTimeTotal = 0;
        let ctxRoulette;

        // --- MULTIPLE BETS STATE ---
        let activeRouletteBets = []; // Array de apuestas: { type, value, amount }

        function drawRouletteWheel() {
            const canvas = document.getElementById("rouletteCanvas");
            if (!canvas || !canvas.getContext) return;
            ctxRoulette = canvas.getContext("2d");

            const outsideRadius = 240;
            const textRadius = 190;
            const insideRadius = 120;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            ctxRoulette.clearRect(0, 0, canvas.width, canvas.height);

            // Borde exterior
            ctxRoulette.beginPath();
            ctxRoulette.arc(centerX, centerY, outsideRadius + 10, 0, Math.PI * 2);
            ctxRoulette.fillStyle = "#daa520"; // Gold
            ctxRoulette.fill();

            for (let i = 0; i < rouletteNumbers.length; i++) {
                const angle = startAngle + i * arc;
                const number = rouletteNumbers[i];

                // Segmento
                ctxRoulette.fillStyle = colors[number];
                ctxRoulette.beginPath();
                ctxRoulette.arc(centerX, centerY, outsideRadius, angle, angle + arc, false);
                ctxRoulette.arc(centerX, centerY, insideRadius, angle + arc, angle, true);
                ctxRoulette.fill();
                ctxRoulette.save();

                // Separadores
                ctxRoulette.strokeStyle = "#b8860b";
                ctxRoulette.lineWidth = 2;
                ctxRoulette.stroke();

                // Texto
                ctxRoulette.shadowColor = "black";
                ctxRoulette.shadowBlur = 4;
                ctxRoulette.fillStyle = "white"; // BLANCO PURO
                ctxRoulette.font = 'bold 24px Cinzel'; // Fuente grande
                ctxRoulette.translate(centerX + Math.cos(angle + arc / 2) * textRadius, centerY + Math.sin(angle + arc / 2) * textRadius);
                ctxRoulette.rotate(angle + arc / 2 + Math.PI / 2);
                const text = number.toString();
                ctxRoulette.fillText(text, -ctxRoulette.measureText(text).width / 2, 0);
                ctxRoulette.restore();
            }
        }

        function spinRouletteReal() {
            if (activeRouletteBets.length === 0) { alert("¬°Debes colocar al menos una apuesta!"); return; }

            // Bloqueamos controles
            document.getElementById('btn-spin-roulette').disabled = true;

            spinArcStart = Math.random() * 10 + 10;
            spinTime = 0;
            spinTimeTotal = Math.random() * 3000 + 4 * 1000;
            rotateWheel();
        }

        function rotateWheel() {
            spinTime += 30;
            if (spinTime >= spinTimeTotal) {
                stopRotateWheel();
                return;
            }
            const spinAngle = spinArcStart - easeOut(spinTime, 0, spinArcStart, spinTimeTotal);
            startAngle += (spinAngle * Math.PI / 180);
            drawRouletteWheel();
            spinTimeout = requestAnimationFrame(rotateWheel);
        }

        function stopRotateWheel() {
            cancelAnimationFrame(spinTimeout);
            const degrees = startAngle * 180 / Math.PI + 90;
            const arcd = 360 / rouletteNumbers.length;
            const index = Math.floor((360 - degrees % 360) / arcd);
            const winningNumber = rouletteNumbers[index];
            checkRouletteWin(winningNumber);
        }

        function easeOut(t, b, c, d) {
            const ts = (t /= d) * t;
            const tc = ts * t;
            return b + c * (tc + -3 * ts + 3 * t);
        }

        function initRouletteGrid() {
            const grid = document.getElementById('roulette-grid');
            grid.innerHTML = '';
            activeRouletteBets = []; // Reset bets on init
            updateRouletteUI();

            for (let i = 1; i <= 36; i++) {
                const colorClass = colors[i] === '#991b1b' ? 'bg-red-600 hover:bg-red-500' : 'bg-gray-800 hover:bg-gray-700';
                const btn = document.createElement('button');
                btn.id = `btn-bet-number-${i}`; // ID √∫nico para las fichas
                btn.className = `${colorClass} relative text-white font-bold text-xs h-8 rounded border border-white/10 transition-transform active:scale-95 group`;
                // Estructura interna con badge para la ficha
                btn.innerHTML = `${i}<div class="hidden absolute -top-2 -right-2 bg-yellow-500 text-black text-[9px] font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg border border-white chip-badge z-10"></div>`;
                btn.onclick = () => placeRouletteBet('number', i);
                grid.appendChild(btn);
            }
            drawRouletteWheel();
        }

        function placeRouletteBet(type, value) {
            const amountInput = document.getElementById('roulette-amount');
            const amount = parseInt(amountInput.value);

            if (userGold < amount) { alert("No tienes suficiente oro."); return; }
            if (amount <= 0) return;

            // Deducir oro inmediatamente
            userGold -= amount;
            updateGoldDisplay();

            // Buscar si ya existe apuesta para sumar
            const existingBet = activeRouletteBets.find(b => b.type === type && b.value === value);
            if (existingBet) {
                existingBet.amount += amount;
            } else {
                activeRouletteBets.push({ type, value, amount });
            }

            updateRouletteUI();
        }

        function clearRouletteBets() {
            if (activeRouletteBets.length === 0) return;
            // Reembolsar
            const totalRefund = activeRouletteBets.reduce((sum, b) => sum + b.amount, 0);
            userGold += totalRefund;
            updateGoldDisplay();
            activeRouletteBets = [];
            updateRouletteUI();
        }

        function updateRouletteUI() {
            // Ocultar todos los badges
            document.querySelectorAll('.chip-badge').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('flex');
            });

            let totalBet = 0;

            // Mostrar badges activos
            activeRouletteBets.forEach(bet => {
                totalBet += bet.amount;
                const btnId = `btn-bet-${bet.type}-${bet.value}`;
                const btn = document.getElementById(btnId);
                if (btn) {
                    const badge = btn.querySelector('.chip-badge');
                    if (badge) {
                        badge.innerText = bet.amount >= 1000 ? (bet.amount / 1000).toFixed(1) + 'k' : bet.amount;
                        badge.classList.remove('hidden');
                        badge.classList.add('flex');
                    }
                }
            });

            document.getElementById('total-bet-display').innerText = totalBet.toLocaleString();
        }

        function checkRouletteWin(winner) {
            const resEl = document.getElementById('roulette-last-result');
            const winnerColor = colors[winner] === '#991b1b' ? 'red' : (winner === 0 ? 'green' : 'black');
            resEl.innerText = winner;
            resEl.className = `text-4xl font-bold ${winnerColor === 'red' ? 'text-red-500' : (winnerColor === 'black' ? 'text-white' : 'text-green-500')}`;

            let totalWon = 0;

            activeRouletteBets.forEach(bet => {
                let won = false;
                let mult = 0;

                if (bet.type === 'number' && bet.value === winner) { won = true; mult = 36; } // Pleno paga 35:1 + apuesta = x36
                else if (bet.type === 'color' && bet.value === winnerColor) { won = true; mult = 2; }
                else if (bet.type === 'parity' && winner !== 0) {
                    if (bet.value === 'even' && winner % 2 === 0) { won = true; mult = 2; }
                    if (bet.value === 'odd' && winner % 2 !== 0) { won = true; mult = 2; }
                }

                if (won) totalWon += bet.amount * mult;
            });

            if (totalWon > 0) {
                userGold += totalWon;
                showToast(`¬°GANASTE UN TOTAL DE ${totalWon.toLocaleString()} mo!`);
            } else {
                showToast(`La casa gana. Sali√≥ ${winner} (${winnerColor === 'red' ? 'Rojo' : (winnerColor === 'green' ? 'Verde' : 'Negro')})`);
            }

            // Limpiar mesa tras resultado
            activeRouletteBets = [];
            updateRouletteUI();
            updateGoldDisplay();
            document.getElementById('btn-spin-roulette').disabled = false;
        }

        // --- CANVAS BACKGROUND ---
        const canvas = document.getElementById('starfield');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        class Particle {
            constructor() { this.reset(); }
            reset() { this.x = Math.random() * width; this.y = Math.random() * height; this.size = Math.random() * 2; this.opacity = Math.random() * 0.5 + 0.1; }
            draw() { ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
        }
        function initParticles() { particles = []; for (let i = 0; i < 100; i++) particles.push(new Particle()); }
        function animate() { ctx.clearRect(0, 0, width, height); particles.forEach(p => p.draw()); requestAnimationFrame(animate); }
        window.addEventListener('resize', resize); resize(); initParticles(); animate();

        // Fortune Wheel Logic (Simple)
        const segments = [{ text: '5%', color: '#9ca3af', value: 0.05, type: 'discount' }, { text: '10%', color: '#22c55e', value: 0.10, type: 'discount' }, { text: '15%', color: '#3b82f6', value: 0.15, type: 'discount' }, { text: '20%', color: '#a855f7', value: 0.20, type: 'discount' }, { text: '25%', color: '#fbbf24', value: 0.25, type: 'discount' }, { text: 'üéÅ', color: '#f43f5e', value: 'item', type: 'item' }];
        function initWheel() { wheelContainer.innerHTML = ''; let gradientStr = ''; const segmentSize = 100 / segments.length; segments.forEach((seg, i) => { const start = i * segmentSize; const end = (i + 1) * segmentSize; gradientStr += `${seg.color} ${start}% ${end}%, `; }); wheelContainer.style.background = `conic-gradient(${gradientStr.slice(0, -2)})`; segments.forEach((seg, i) => { const label = document.createElement('div'); label.className = 'wheel-text'; label.innerText = seg.text; const angle = (i * 60) + 30; const radius = 100; const radians = (angle - 90) * (Math.PI / 180); const x = 150 + (radius * Math.cos(radians)); const y = 150 + (radius * Math.sin(radians)); label.style.left = `${x}px`; label.style.top = `${y}px`; label.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`; wheelContainer.appendChild(label); }); }
        function openWheelModal() { if (hasSpunWheel) { alert("Solo un giro al d√≠a."); return; } wheelModal.classList.remove('hidden'); setTimeout(() => wheelModal.classList.remove('opacity-0'), 10); initWheel(); }
        function closeWheelModal() { wheelModal.classList.add('opacity-0'); setTimeout(() => wheelModal.classList.add('hidden'), 300); }
        function spinWheel() { if (hasSpunWheel) return; hasSpunWheel = true; spinBtn.disabled = true; spinBtn.classList.add('opacity-50'); const spins = 5 + Math.random() * 5; const degrees = spins * 360; const randomOffset = Math.floor(Math.random() * 360); const totalRotation = degrees + randomOffset; wheelContainer.style.transform = `rotate(-${totalRotation}deg)`; setTimeout(() => { const actualDeg = totalRotation % 360; const index = Math.floor(actualDeg / 60) % 6; handleWheelResult(segments[index]); }, 4000); }
        function handleWheelResult(result) { if (result.type === 'discount') { activeDiscount = result.value; wheelResult.innerHTML = `¬°Descuento del <span class="text-green-400">${result.text}</span>!`; showToast(`Descuento activado.`); } else { wheelResult.innerHTML = `¬°Objeto Misterioso!`; addToCart({ name: "Caja Misteriosa", price: 0, type: "Evento", desc: "Regalo del destino.", rarity: "Ex√≥tica" }); } }
        // Patronage
        function openPatronageModal() { patronageModal.classList.remove('hidden'); setTimeout(() => patronageModal.classList.remove('opacity-0'), 10); }
        function closePatronageModal() { patronageModal.classList.add('opacity-0'); setTimeout(() => patronageModal.classList.add('hidden'), 300); }
        function requestLoan(amount) { userGold += amount; updateGoldDisplay(); showToast(`Has recibido ${amount} mo.`); closePatronageModal(); }
        // Slots
        function spinSlots() { const cost = 50; if (userGold < cost) { alert("Sin oro."); return; } userGold -= cost; updateGoldDisplay(); const s = ["üçí", "üçã", "üîî", "üíé", "üíÄ", "7Ô∏è‚É£"]; const s1 = document.getElementById('slot1'), s2 = document.getElementById('slot2'), s3 = document.getElementById('slot3'), msg = document.getElementById('slot-msg'), btn = document.getElementById('btn-slots'); btn.disabled = true; msg.innerText = "Girando..."; let spins = 0; const i = setInterval(() => { s1.innerText = s[Math.floor(Math.random() * 6)]; s2.innerText = s[Math.floor(Math.random() * 6)]; s3.innerText = s[Math.floor(Math.random() * 6)]; spins++; if (spins > 20) { clearInterval(i); btn.disabled = false; checkSlotWin(s1.innerText, s2.innerText, s3.innerText, msg); } }, 100); }
        function checkSlotWin(v1, v2, v3, m) { if (v1 === v2 && v2 === v3) { let p = v1 === "üíÄ" ? 6666 : v1 === "7Ô∏è‚É£" ? 5000 : 250; userGold += p; m.innerText = `¬°Premio! +${p}`; } else if (v1 === v2 || v2 === v3 || v1 === v3) { userGold += 20; m.innerText = "+20 recuperados"; } else m.innerText = "Pierdes."; updateGoldDisplay(); }
        // Blackjack (Simple)
        let bjDeck = [], bjD = [], bjP = [];
        function startBlackjack() { const bet = parseInt(document.getElementById('bj-bet').value); if (userGold < bet) return; userGold -= bet; updateGoldDisplay(); document.getElementById('btn-bj-deal').classList.add('hidden'); document.getElementById('bj-controls').classList.remove('hidden'); document.getElementById('bj-msg').innerText = ""; const s = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'], v = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A']; bjDeck = []; for (let su of s) for (let va of v) bjDeck.push({ s: su, v: va }); bjDeck.sort(() => Math.random() - 0.5); bjP = [bjDeck.pop(), bjDeck.pop()]; bjD = [bjDeck.pop(), bjDeck.pop()]; renderBJ(); if (getBJScore(bjP) === 21) bjStand(); }
        function getBJScore(h) { let sc = 0, aces = 0; for (let c of h) { if (['J', 'Q', 'K'].includes(c.v)) sc += 10; else if (c.v === 'A') { sc += 11; aces++ } else sc += parseInt(c.v); } while (sc > 21 && aces > 0) { sc -= 10; aces-- } return sc; }
        function renderBJ(show = false) { const dH = c => `<div class="bg-white text-black w-12 h-16 rounded flex items-center justify-center font-bold border border-gray-400 ${['‚ô•', '‚ô¶'].includes(c.s) ? 'text-red-600' : ''}">${c.v}${c.s}</div>`; document.getElementById('player-cards').innerHTML = bjP.map(dH).join(''); document.getElementById('player-score').innerText = getBJScore(bjP); if (show) { document.getElementById('dealer-cards').innerHTML = bjD.map(dH).join(''); document.getElementById('dealer-score').innerText = getBJScore(bjD); } else { document.getElementById('dealer-cards').innerHTML = dH(bjD[0]) + `<div class="bg-red-900 w-12 h-16 rounded border border-white/20"></div>`; document.getElementById('dealer-score').innerText = "?"; } }
        function bjHit() { bjP.push(bjDeck.pop()); renderBJ(); if (getBJScore(bjP) > 21) endBJ(false, "Te pasaste."); }
        function bjStand() { renderBJ(true); let d = getBJScore(bjD); const t = setInterval(() => { if (d < 17) { bjD.push(bjDeck.pop()); d = getBJScore(bjD); renderBJ(true); } else { clearInterval(t); const p = getBJScore(bjP); if (d > 21) endBJ(true, "Dealer se pas√≥."); else if (p > d) endBJ(true, "Ganas."); else if (p < d) endBJ(false, "Pierdes."); else { userGold += parseInt(document.getElementById('bj-bet').value); endBJ(null, "Empate."); } } }, 800); }
        function endBJ(w, m) { document.getElementById('bj-controls').classList.add('hidden'); document.getElementById('btn-bj-deal').classList.remove('hidden'); document.getElementById('bj-msg').innerText = m; if (w === true) userGold += parseInt(document.getElementById('bj-bet').value) * 2; updateGoldDisplay(); }

    </script>
</body>

</html>